function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}var _extends=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};define("site.funcs",["simplr","dpz.config"],function(a,b){var c={queues:{loading:[],block1:[],block2:[],generic:[]},timers:{queue:null}},d={trigger:{onPage:function(b){var c=$.extend(!0,{path:location.protocol+"//"+location.host+location.pathname,route:{route:[],url:"",base:"",resources:{},action:"",parameters:{}}},b);jsDPZ.topic("site.onPage").publish(c),a.trigger.mOnPage({data:c})},onEvent:function(b){var c=$.extend(!0,{breadcrumb:["UNKNOWN"],data:{}},b);a.trigger.mOnEvent({data:c})},onTransaction:function(b){var c=$.extend(!0,{},jsDPZ.config.dataModel.ORDER,b);a.trigger.mOnTransaction({data:c})}},format:{formatPhone:function(a){var b=d.format.phoneNumber,c=dpz.config.getMarketProperty("phoneFormat");return{phone:b({number:a.phone,format:c.phone}),phonePrefix:b({number:a.phonePrefix,format:c.phonePrefix}),phoneExtension:b({number:a.phoneExtension,format:c.Extension})}},phoneNumber:function(a){for(var b=$.extend({number:"",format:dpz.config.getMarketProperty("phoneFormat").phone},a),c=b.number.replace(/\D/g,""),d=b.format,e="",f=c.length-1,g=d.length-1;g>=0;g--)"#"==d.charAt(g)&&f>=0?(e=c.charAt(f)+e,f--):"#"!=d.charAt(g)&&(e=d.charAt(g)+e);return e=e.replace("()","")}},func:{loadWam:function(){return $.Deferred(function(a){var b=function(b){dpz.market.marketConfig.home.tiles=$.extend(!0,{},dpz.market.marketConfig.home.tiles,b.homeTiles.tiles),dpz.market.marketConfig.home.tileBlocks=$.extend(!0,{},dpz.market.marketConfig.home.tileBlocks,b.homeTiles.tileBlocks),a.resolve()};killConfig.isMarketEnabled("wamActive")?require(["dpz.wam"],b,function(a){jsDPZ.topic("wam.error").publish({error:a}),b({homeTiles:{tiles:{},tileBlocks:{}}})}):a.resolve()})},shouldUseObscuredCreditCardField:function(){return dpz.kiosk.isActive&&dpz.kiosk.getConfig().isCreditCardAccepted&&!dpz.kiosk.getConfig().isPaymentTerminal},prefixTree:function(a){function b(a){}return b.prototype.insert=function(a){var c=rootNode=this;return a.split("").map(function(a,d,e){c=c[a]||(c[a]=new b(a))},this),c.value=a,rootNode},b.prototype.getWords=function(){var a,b,c=this,d=[];c.value&&d.push(c.value);for(a in c)1==a.length&&(b=c[a],d=d.concat(b.getWords(a)));return d},b.prototype.getPlacePredictions=function(a,b,c){var d=this,e=!1,f="object"===(void 0===a?"undefined":_typeof(a))?a.input:a;return c&&(f=c(f)),("string"==typeof f?f.split("").filter(function(a,b,c){if(d[a])return d=d[a],a;e=!0},d):[]).length&&!e?d.getWords():[]},a.reduce(function(a,b,c,d){return a.insert(b)},new b)},autocompleteService:function(b,c,d){var e,f={},g={},h="",i="",c=c;if($.extend(!0,f,b),!(f.searchBox instanceof jQuery))throw new TypeError("Must pass jQuery wrapped DOM node to dpz.googleMapsPlaces AutocompleteService");if(!f.searchBox.length)throw new Error("Non-existant DOM node passed to dpz.googleMapsPlaces AutocompleteService");return f.selector===window&&DEBUG&&console.warn("Prefer passing in a selector.  For now, window used as default delegate selector."),$.extend(!0,g,{startPredictions:function(){$(this).one("keydown",function(){e=setInterval(function(){(h=$(this).val())&&h!==i&&!$(".js-addressPrediction").filter(function(){return $(this).text()===h}).length&&(i=h,killConfig.isMarketEnabled("googleMapsAddressAutocomplete")?c.getPlacePredictions($.extend({},f.predictionRequestOptions,{input:h}),g.displaySuggestions):g.displaySuggestions(c.getPlacePredictions(h,0,d)))}.bind($(this)),f.interval)})},stopPredictions:function(a){clearInterval(e)},displaySuggestions:function(a,b){if(b&&b!=google.maps.places.PlacesServiceStatus.OK)return void(DEBUG&&console.error(b));jsDPZ.topic("address.predictions.update").publish(a)},setEvents:function(){f.searchBox.off("focus",g.startPredictions).on("focus",g.startPredictions).off("blur",g.stopPredictions).on("blur",g.stopPredictions)}}),a.view.mRender({name:"address_predictions",data:{searchBox:f.searchBox},selector:".js-predictionsContainer"}),g},eventScrollY:function(a){function b(c){var d="up"===c?"-="+a.speed+"px":"+="+a.speed+"px";$(a.scrollContent).animate({scrollTop:d},1,function(){b(c)})}var c={},d=!1;return $.extend(c,{stopAnimation:function(b){$(a.scrollContent).stop(!0),void 0!==b&&(d=b)},isScrolling:function(){return d}}),a.down&&$(a.down.actionTrigger).bind(a.down.startAction,function(a){c.stopAnimation(!0),b("down"),d=!0}).bind(a.down.stopAction,function(a){c.stopAnimation()}),a.up&&$(a.up.actionTrigger).bind(a.up.startAction,function(a){c.stopAnimation(!0),b("up"),d=!0}).bind(a.up.stopAction,function(a){c.stopAnimation()}),c},getSignInData:function(a){return{routeAfter:a.attr("data-route-after")||"",claimRewards:a.attr("data-claim-rewards")||""}},processPowerOrderResponse:function(b,c){function e(a){return"AutoAddedOrderId"!==a.Code&&dpz.utag.fire.link(void 0,{event_name:a.Code,event_action:"error",event_category:"Error",event_label:"Error Code"}),"ServiceMethodNotAllowed"==a.Code||"PosOrderSubmitError"==a.Code&&"Out of Delivery Area"==a.PulseText?"eServiceMethodChanged":"StoreInWarningTimeForCarryout"==a.Code&&jsDPZ.util.empty(d.storage.load("hasShownCarryoutWarning"))?"_ServiceMethodCarryoutWarning":"StoreInWarningTimeForDelivery"==a.Code&&jsDPZ.util.empty(d.storage.load("hasShownDeliveryWarning"))?"iStoreClosingWarning":"StoreClosedForCarryout"==a.Code?"eLobbyClosed":"StoreClosedForFutureTime"==a.Code||"PosUnknownError"==a.Code&&"Advance Order Date is more than 30 days from now"==a.PulseText||"PosUnknownError"==a.Code&&"Advance Order Time is too soon"==a.PulseText?"eOrderDateTimeInvalid":"MissingStreetNumberAndName"==a.Code||"MissingNeighborhood"==a.Code?"eMissingStreetNumberAndName":"StoreInWarningTimeForDelivery"==a.Code||"StoreInWarningTimeForCarryout"==a.Code||"AutoAddedOrderId"==a.Code||"CashLimitExceeded"==a.Code||"PosOrderIncomplete"==a.Code&&"No Items In Order"==a.PulseText||"BelowMinimumDeliveryAmount"==a.Code?"":"StoreClosed"==a.Code?"StoreClosed":"Unauthorized"===a.Code&&"Fail"===b.Order.Loyalty.Status?"eLoyaltyDown":"UnableToProcessLoyalty"===a.Code||"UnableToProcessLoyaltyAtThisTime"===status.ItemCode?"eLoyaltyDown":"UnableToRedeem"===a.Code?"eLoyaltyInsufficientPoints":"UnableToProcessLoyaltyNonParticipatingStore"===a.Code?"eLoyaltyUnsupported":"eGenericPointOfServiceError"}function f(a){return"UsageCountViolation"==a.Code?"eCouponUsageCountViolation":"InvalidServiceMethodForCoupon"==a.Code?"eCouponServiceMethodChanged":"CouponExclusivityViolation"==a.Code?"eCouponDuplicate":"BelowMinimumOrderAmount"==a.Code?"eCouponBelowMinimumOrderAmount":""}var g=(c.indexOf("rewardsRedemption"),null),h=d.func.getParameterByName("couponCode",c),i=d.func.getParameterByName("suppressWizard",c),j=!0,k=function(a){site.data.suppressToggle=!0,d.func.toggleLoading(!0),$(document).one("checkout.view.rendered",function(){d.func.overlayToggle(!0,"codeOverlay",{},{code:a}),site.data.suppressToggle=!1,d.func.toggleLoading(!1)})};jsDPZ.app.order.updateOrderFromPower(b),jsDPZ.util.empty(b.Order.StatusItems)||$.each(b.Order.StatusItems,function(b,c){var f=e(c);if("eServiceMethodChanged"==f){var h=jsDPZ.app.customer.getCustomer().getSessionData(),i=h.ServiceMethod;d.func.changeServiceMethod("Delivery"==i?"Carryout":"Delivery",{noWarnSubstitute:!0}),"Delivery"==i&&dpz.util.isEmpty(h.Address.Street)&&(d.storage.save("ServiceType","Delivery"),f="eAddressIncompleteError"),site.func.renderProfileInColumn(),dpz.loyalty.renderSmallWidget({selector:".js-myLoyaltyWidget"}),g=f}else if("_ServiceMethodCarryoutWarning"==f)d.func.overlayToggle(!0,"serviceMethodCarryoutWarningOverlay",{},{}),d.storage.save("hasShownCarryoutWarning","true");else if("iStoreClosingWarning"==f){var j=jsDPZ.app.store.getStore(),k=dpz.config.getMarketProperty("date").format.SERVER_DATE_TIME,l=jsDPZ.obj.dateTime(j.data.StoreAsOfTime.split(" ")[0]+" "+j.getServiceMethodBusinessDayTimes({serviceMethod:"Delivery"}).CloseTime,k).getDisplayFormat(dpz.config.getMarketProperty("date").format.TIME);d.func.overlayToggle(!0,"codeOverlay",{},{label:[l,l],code:f,success:!0}),d.storage.save("hasShownDeliveryWarning","true")}else"eLobbyClosed"==f?(a.controller.mRouteAndExecute("/customer/store/delete"),d.func.overlayToggle(!0,"codeOverlay",{},{code:f})):"eOrderDateTimeInvalid"==f||"StoreClosed"==f?a.controller.mRouteAndExecute(site.func.buildURL({url:"#/order/time/view",parameters:{code:"eOrderDateTimeInvalid"}})):"eGenericPointOfServiceError"==f?(d.trigger.onEvent({breadcrumb:["Order","PointOfServiceError",(dpz.util.isEmpty(c.Code)?"":"Code:"+c.Code)+(dpz.util.isEmpty(c.PulseCode)?"":" - PulseCode:"+c.PulseCode)+(dpz.util.isEmpty(c.PulseText)?"":" - PulseText:"+c.PulseText)]}),d.func.overlayToggle(!0,"codeOverlay",{},{code:"eGenericPointOfServiceError",label:d.format.phoneNumber({number:jsDPZ.app.store.getStore().data.Phone})})):"eMissingStreetNumberAndName"==f?d.func.overlayToggle(!0,"codeOverlay",{},{code:f},function(){$("#genericOverlay .js-closeButton").on("click",function(a){a.preventDefault(),window.location=urlConfig.root+"/pages/order/"+window.location.search.replace(/\?locations=1$|&locations=1|locations=1&/,"")+"#/locations/search/"})}):"eLoyaltyDown"!==f&&"eLoyaltyInsufficientPoints"!==f&&"eLoyaltyUnsupported"!==f&&"eLoyaltyFailed"!==f||(dpz.loyalty.updateLoyaltyStatus(!1),d.func.overlayToggle(!0,"codeOverlay",{},{code:f}))}),jsDPZ.util.empty(b.Order.Coupons)||$.each(b.Order.Coupons,function(a,b){b.StatusItems&&$.each(b.StatusItems,function(a,c){var e=f(c);if("eCouponUsageCountViolation"==e||"eCouponServiceMethodChanged"==e||"eCouponDuplicate"==e&&!d.func.isGroupOrdering()){var g=jsDPZ.app.order.getOrder().data.Details.ServiceMethod,h=function(){var a=jsDPZ.app.catalog.getCatalog().getCoupon(b.Code).data;return a.Tags&&a.Tags.ServiceMethods?a.Tags.ServiceMethods:"Delivery"},i=[h(),g];d.func.overlayToggle(!0,"couponCodeWithRemoveOverlay",{},{code:e,CouponID:b.ID,suggestedServiceMethod:"Carryout",label:i})}else if("eCouponBelowMinimumOrderAmount"==e){var j=jsDPZ.app.catalog.getCatalog().getCoupon(b.Code).data;d.func.overlayToggle(!0,"codeOverlay",{},{code:e,label:j.Tags.MinimumOrderAmount})}})}),dpz.loyalty.loyaltyIsOk()&&dpz.loyalty.isEnrolled()&&-1===b.Status&&1===b.Status&&(null!==b.Order.Loyalty&&void 0!==b.Order.Loyalty||(dpz.loyalty.updateLoyaltyStatus(!1),d.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyDown"}))),"reload"===jsDPZ.app.customer.getCustomer().data.Session.RouteAndShowCouponWizard&&(i="0"),d.func.changeInOrder();var l=h?jsDPZ.app.catalog.getCatalog().getCoupon(h):"";j=b.Order.Coupons.filter(function(a){return a.Code==h}).length>0,h&&(-1==window.location.hash.indexOf("GroupOrdering")||l.isLoyaltyCoupon())&&(!d.func.isGroupOrdering()||l.isLoyaltyCoupon())&&b.Status>-1&&h&&j&&"1"!=i?dpz.fulfillerWizard.showWizard(h):g&&(c.indexOf("checkout=1")>-1?k(g):d.func.overlayToggle(!0,"codeOverlay",{},{code:g}),jsDPZ.app.order.getOrder().orderChanged(),a.controller.mRouteAndExecute(c)),0!==b.Status&&1!==b.Status||dpz.util.isEmpty(site.data.serviceMethodChangedCouponCode)||!site.data.serviceMethodChangedCouponCode[b.Order.ServiceMethod]||(a.controller.mRouteAndExecute("/order/coupons/new?code="+site.data.serviceMethodChangedCouponCode[b.Order.ServiceMethod]+"&qty=1"),site.data.serviceMethodChangedCouponCode={})},getParameterByName:function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(b);if(d)return decodeURIComponent(d[1].replace(/\+/g," "))},changeInOrder:function(){site.isPaymentPage||a.view.mRender({name:"order_column",data:{},selector:orderInColumnSelector}),jsDPZ.app.customer.getCustomer().data.Session.WatchEasyOrder&&(jsDPZ.app.customer.getCustomer().data.Session.OrderModified=!0),d.sessionTools.save()},isOnCheckoutPage:function(){return"#/checkout/"==location.hash},showFull:function(){window.scroll(0,0),$("#js-splitFrame").hide(),$("#js-fullFrame").show()},changeServiceMethod:function(a,b){var c=jsDPZ.app.order.getOrder().data;b=b||{},jsDPZ.app.customer.getCustomer().getSessionData().ServiceMethod=a,c.Details.ServiceMethod=a,"Carryout"==a&&(c.Customer.Address.DeliveryInstructions="",!b.noWarnSubstitute&&jsDPZ.app.order.getOrder().data.Details.SubstitutedStore&&d.func.overlayToggle(!0,"codeOverlay",{},{code:"iCarryoutStoreSubstitute",label:jsDPZ.app.store.getStore().getAddress().getDisplayAddress(dpz.config.getMarketProperty("addressFormat").displayAddress).join("<br/>"),success:!0})),d.storage.save("ServiceType",a),jsDPZ.app.order.getOrder().orderChanged()},futureOrderSection:function(c){function e(a){var c,e=site.catalogTools.getStoreTimeArr({date:a,minTime:"00:00",maxTime:"23:59"}),f=moment(a,o),g=f.isSame(s,"day")||f.isSame(r,"day");A&&g?e=e.filter(function(a){return moment(a.data).isAfter(u)}):B&&g&&(e=e.filter(function(a){return moment(a.data).isAfter(y)})),c=e.map(function(a){return{value:a.getDisplayFormat("HH:mm:00"),label:a.getDisplayFormat(dpz.market.marketConfig.date.format.TIME)}}),$(".js-future-time").each(function(){$("option",$(this)).not(":first").remove(),$("option:first",$(this)).val(""),$(this).append(d.func.buildOptionList({listValues:c,defaultValue:v.format(b.getMarketProperty("date").format.SERVER_TIME_POWER)}))})}var f,g,h,i,j,k,l,m,n,o=b.getMarketProperty("date").format.SERVER_DATE_POWER,p=jsDPZ.app.order.getOrder(),q=jsDPZ.app.store.getStore(),r=moment(q.data.StoreAsOfTime,b.getMarketProperty("date").format.SERVER_DATE_TIME_POWER),s=r.clone().add(1,"days"),t=moment(q.data.BusinessDate,o),u=moment(q.data.StoreEndTimeEvenSpansToNextBusinessDay,b.getMarketProperty("date").format.SERVER_DATE_TIME_POWER),v=moment(p.data.Details.OrderDateTime,b.getMarketProperty("date").format.SERVER_DATE_TIME_POWER),w=moment(q.data.FutureOrderBlackoutBusinessDate,o),x=q.data.FutureOrderDelayInHours,y=r.clone().add(x,"hours"),z="",A=-1===x&&w.isSame(t,"day"),B=x>0&&w.isSame(t,"day");if(""!==q.data.StoreID){f=dpz.util.isEmpty(p.data.Details.OrderDateTime),g=f?jsDPZ.obj.dateTime(q.data.StoreAsOfTime):jsDPZ.obj.dateTime(p.data.Details.OrderDateTime),h=g.getDayOfWeek(),i=[],j=q.data.ServiceHours.Carryout[h]||[],0===j.length&&(j=[{OpenTime:"23:58",CloseTime:"23:59"}]),n=parseInt(j.map(function(a){return a.CloseTime}).sort().pop().replace(":",""),10),"Delivery"!==p.data.Details.ServiceMethod&&parseInt(g.getDisplayFormat("HHmm"),10)>n&&(i.push(g.getDisplayFormat(b.getMarketProperty("date").format.SERVER_DATE_POWER)),g=s.toDate().getDateTimeObject()),A&&(i.push(w.format(b.getMarketProperty("date").format.SERVER_DATE_POWER)),v.isValid()&&!w.isSame(v,"day")||(g=s.toDate().getDateTimeObject())),k=dpz.config.getMarketProperty("date"),m=k.format.DATE.replace(/\//g,"-"),l=g.getDisplayFormat(m),e(g.getDisplayFormat("YYYY-MM-DD")),$(".date_input",c).val(l),$.extend(DateInput.DEFAULT_OPTS,{stringToDate:function(a){var b=moment(a,m);return b.isValid()?b._d:null},dateToString:function(a){return jsDPZ.obj.dateTime(a).getDisplayFormat(m)},moveMonthBy:function(a){a="RTL"===$("html").attr("dir")?-a:a;var b=new Date(this.currentMonth.getFullYear(),this.currentMonth.getMonth()+a,this.currentMonth.getDate());this.selectMonth(b)},month_names:k.months,short_month_names:k.monthsShort,short_day_names:k.weekdaysShort}),$(".date_input",c).date_input({future_date_only:!0,unorderable_dates:i,show:function(){this.rootLayers.css("display","block"),$([window,document.body]).click(this.hideIfClickOutside),this.input.unbind("focus",this.show),$(document.body).keydown(this.keydownHandler),this.setPosition(),this.adjustPadding(!0)},hide:function(){this.rootLayers.css("display","none"),$([window,document.body]).unbind("click",this.hideIfClickOutside),this.input.focus(this.show),$(document.body).unbind("keydown",this.keydownHandler),this.adjustPadding(!1)},adjustPadding:function(a){var b=$(".js-orderDetailsInColumn").parent();"handheld"===d.func.getCurrentBreakpoint()&&(b.css("padding-bottom",a?"11em":"1em"),a&&$(".js-siteMainNavigation").parent().animate({scrollTop:b.prop("scrollHeight")},500,function(){$(window).trigger("scroll.simplr.widget.trackableScrollingElement.done")}))}},function(){e(moment($(this.input).val(),m).format("YYYY-MM-DD"))}),$("a.js-viewRestrictions",c).click(function(a){a.preventDefault(),d.func.overlayToggle(!0,"orderTimingRestrictions",{},{})}),$(".js-future-time, .js-future-date",c).on("change",function(){$(".js-orderNow").prop("checked")&&$(".js-orderLater").prop("checked",!0),$(this).hasClass("js-future-date")?$(".js-future-date").val($(this).val()):$(this).hasClass("js-future-time")&&$(".js-future-time").val($(this).val()),$(this).closest("form").submit()});var C=function(a){$(".future-order-controls")[a?"removeClass":"addClass"]("is-hidden")};$(".js-orderTimingToggle",c).on("change",function(b){if($(".js-orderTimingToggle:visible").length>1){"Now"===$(this).val()?($(".js-orderNow").prop("checked",!0),C(!1),a.controller.mRouteAndExecute("/order/time/update")):($(".js-orderLater").prop("checked",!0),C(!0),d.trigger.onEvent({uri:window.location.hash.split("#")[1],group:"FutureOrder",subGroup:"DivShown",title:"FutureOrder-DivShown"}),$(this).closest("form").submit())}}),q.isOpenRightNow()?($(".js-storeClosed",c).remove(),-1!==$.inArray(p.data.Details.ServiceMethod,q.getAvailableServiceMethods({dtString:q.data.StoreAsOfTime}))?$(".js-storeOpen",c).remove():($(".js-orderNow",c).closest("li").remove(),$(".js-orderLater",c).trigger("click"))):($(".js-orderNow",c).closest("li").remove(),$(".js-orderLater",c).trigger("click"),$(".js-storeOpen",c).remove(),$(".js-orderTimingForm .js-orderNow",c).hide()),A?$(".js-futureOrderWarning").text(dpz.template.translate("locations.order_timing_all_day_delay",{date:w.format(dpz.market.marketConfig.date.format.DATE)})):B?(z=site.catalogTools.getStoreTimeArr({date:y.format(b.getMarketProperty("date").format.SERVER_DATE_POWER),minTime:y.format(b.getMarketProperty("date").format.SERVER_TIME_POWER),maxTime:"23:59"}),$(".js-futureOrderWarning").text(dpz.template.translate("locations.order_timing_delayed",{time:z[0].getDisplayFormat(b.getMarketProperty("date").format.TIME),date:w.format(dpz.market.marketConfig.date.format.DATE)}))):$(".js-futureOrderWarning").empty(),$(".js-orderTimingForm",c).validate({rules:{Future_Date:{required:!0},Future_Time:{required:!0}},submitHandler:function(b){C(!0),d.func.overlayToggle(!1),a.controller.mRouteAndExecute(d.func.buildURL({url:b.action,parameters:{date:moment(b.Future_Date.value,m).format("YYYY-MM-DD"),time:b.Future_Time.value}}))},errorPlacement:function(a,b){a.appendTo(b.siblings(".js-error"))}}),$(window).on("scroll.simplr.widget.trackableScrollingElement.done",function(){var a=$(".date_selector:visible"),b=$(".js-future-date:visible");a.length>0&&b.length>0&&a.offset({top:b.offset().top+b.outerHeight()+10})})}},stackAttack:function(a){$(".stackAttack",a).each(function(){var a=$(this).text();$(this).text("");var b=document.createElement("span");b.setAttribute("class","sa1"),b.textContent=a;var c=document.createElement("span");c.setAttribute("class","sa2"),c.textContent=a,b.appendChild(c),$(this)[0].appendChild(b)})},unhideDelayedABTiles:function(){$(".ABDelayedTile").removeClass("ABDelayedTile")},isTrackerPage:function(){return~window.location.href.indexOf("/pages/tracker/")},toggleTrackerTile:function(a,b){for(var c=0,d=site.data.trackerTiles.length;c<d;c++)site.data.trackerTiles[c].tilePromoName===a&&(site.data.trackerTiles[c].isActive=function(){return b})},toggleMixAndMatchUpgradeOverlay:function(a,b,c){var d=jsDPZ.app.order.getOrder().data.Details.Coupons.filter(function(a){return"9193"===a.Code||"8682"===a.Code});site.func.overlayToggle(!0,"upsellProductOverlayTriple",{keepCentered:!0},{recoverable:!0,panelNumber:b,panelName:c,defaultCoupon:"9193",upsellCoupon:"8682",couponPrice:"2.00",hasUpsell:d.length>0&&"8682"===d[0].Code,hasDefault:d.length>0&&"9193"===d[0].Code})},getValidTrackerTiles:function(a){for(var b=[],c=0,e=a.length;c<e;c++)a[c].isActive()&&d.func.isTimedContent(a[c].startDate,a[c].endDate,function(d){b.push(a[c])});return b},isTimedContent:function(a,b,c){var d=new Date,e=a,f=b;d>=e&&d<=f&&c(d)},inDateRange:function(a,b){if(!jsDPZ.util.empty(a)){var c=jsDPZ.obj.dateTime(a).data;if(!jsDPZ.util.empty(b)&&c>=jsDPZ.obj.dateTime(b).data)return!1}return!0},isFriToSun:function(a){var b={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},c=a||new Date,d=c.getDay(),e=c.getHours();return!(d==b.MON&&e>=3)&&(d!=b.TUE&&d!=b.WED&&d!=b.THU&&!(d==b.FRI&&e<3))},setFeaturedCoupon:function(a){var b,c=moment().format("YYYY-MM-DD HH:mm:ss");for(i=0;i<a.length&&a[i];i++)if("default"!==a[i].expires){if(d.func.inDateRange(c,a[i].expires))return a[i]}else b=a[i];return b},isPromoActive:function(a,b){var c=new Date;return c>=a&&c<b},processOverlayQueues:function(a){var b=$.extend({delay:350},a);clearTimeout(c.timers.queue),c.timers.queue=setTimeout(function(){c.queues.generic.length>0&&(c.queues.generic[c.queues.generic.length-1](),c.queues.generic=[]),c.queues.loading.length>0&&(c.queues.loading[c.queues.loading.length-1](),c.queues.loading=[]),c.queues.block1.length>0&&(c.queues.block1[c.queues.block1.length-1](),c.queues.block1=[]),c.queues.block2.length>0&&(c.queues.block2[c.queues.block2.length-1](),c.queues.block2=[])},b.delay)},doOverlay:function(a,b,c,d){a?b.push(function(){$.layer.create($.extend(d,{id:c}))}):b.push(function(){$.layer.destroy({id:c})})},overlayToggle:function(b,e,f,g,h){function i(b){var i={defaultContent:b,callback:function(){a.view.mData().Views[e].callback("#genericOverlay",g),"function"==typeof h&&h(),$(document).trigger("render.view","#genericOverlay")}},j=$.extend({id:"genericOverlay",className:"genericOverlay",keepCentered:!1,xPos:0,yPos:0,defaultContent:"",callback:function(){}},i,f);c.queues.block=[],d.func.doOverlay(!0,c.queues.generic,"genericOverlay",j),d.func.doOverlay(!0,c.queues.block1,"overlayUIBlock1",{id:"overlayUIBlock1",isOverlay:!0}),d.func.processOverlayQueues({delay:1})}if(f&&f.viewComponent&&(g.viewComponent=f.viewComponent),d.func.toggleLoading(!1),b){if(!jsDPZ.util.empty(a.view.mData().Views[e])){var j=a.view.mData().Views[e].html(g);a.util.mIsPromise(j)?j.done(function(a){i(a)}):i(j)}$("#genericOverlay").scrollTop()>0&&$("#genericOverlay").scrollTop(0),$("html").addClass("is-overlay-active")}else d.func.doOverlay(!1,c.queues.generic,"genericOverlay"),d.func.doOverlay(!1,c.queues.block1,"overlayUIBlock1"),d.func.bubbleOverlayToggle(!1),d.func.processOverlayQueues({delay:1}),$("html").removeClass("is-overlay-active")},toggleLoading:function(a,b){a?(d.func.doOverlay(!0,c.queues.loading,"loadingOverlay",{id:"loadingOverlay",keepCentered:!0}),d.func.doOverlay(!0,c.queues.block2,"overlayUIBlock2",{id:"overlayUIBlock2",isOverlay:!0})):(d.func.doOverlay(!1,c.queues.loading,"loadingOverlay"),d.func.doOverlay(!1,c.queues.block2,"overlayUIBlock2")),d.func.processOverlayQueues(b)},setupContentPopups:function(a,b){$(".js-isContentPopup",a).on("click",function(a){a.preventDefault(),d.func.overlayToggle(!0,"contentOverlay",{},{url:$(this).attr("href")})})},setupExecuteURL:function(){$(document).on("click",".js-mExecute",function(b){var c=$(this).attr("href");b.preventDefault(),a.controller.mRouteAndExecute(d.func.buildURL({url:c}))})},setupTemplatePopups:function(a,b){var c=b&&b.klass?b.klass:"";$(a).on("click",".js-isTemplatePopup",function(a){a.preventDefault(),d.func.overlayToggle(!0,"contentOverlay",{},{template:$(this).attr("data-template-popup"),klass:c})})},bubbleOverlayToggle:function(b,c,e){function f(a){return!isNaN(parseFloat(a))}var g=$.extend(!0,{},c);if(b){if(d.trigger.onEvent({uri:"/error/"+e.code,title:"Error or Alert "+e.code,group:"Error",subGroup:e.code,eventType:"error"}),g.xPos&&g.xPos.calculate){var h=g.xPos.calculate,i=f(h.base)?parseFloat(h.base):0,j=f(h.plus)?parseFloat(h.plus):0;g.xPos=(i<0?0:i)+j}if(g.yPos&&g.yPos.calculate){var h=g.yPos.calculate,i=f(h.base)?parseFloat(h.base):0;j=f(h.plus)?parseFloat(h.plus):0,g.yPos=(i<0?0:i)+j}var k={defaultContent:a.view.mData().Views.bubbleCodeOverlay.html(e),callback:function(){a.view.mData().Views.bubbleCodeOverlay.callback("#bubbleOverlay",e),"RTL"===$("html").attr("dir")&&!1!==g.calculateRTL&&($("#bubbleOverlay").css({right:g.xPos+"px"}),g.xPos=$("#bubbleOverlay").offset().left),g.yPos+$("#bubbleOverlay").outerHeight()>$(window).height()+$(window).scrollTop()&&(g.yPos=$(window).height()-$("#bubbleOverlay").outerHeight()+$(window).scrollTop(),$("#bubbleOverlay").css({top:g.yPos+"px"})),(g.xPos<0||g.xPos+$("#bubbleOverlay").outerWidth()>$(window).width())&&(g.xPos<0?g.xPos=$(window).scrollLeft()>=0?$(window).scrollLeft():$(document).width()-$(window).width():g.xPos=$(window).width()-$("#bubbleOverlay").outerWidth(),$("#bubbleOverlay").css({left:g.xPos+"px"}))}},c=$.extend({id:"bubbleOverlay",keepCentered:!1,defaultContent:"",callback:function(){}},k,g);1===$(".js-builderPizzaVisual").length?($(".js-builderPizzaVisual").prepend('<div class="js-pizzaBuilderbubbleOverlay pizzaBuilderbubbleOverlay"></div>'),a.view.mRender({name:"bubbleCodeOverlay",data:e,selector:".js-pizzaBuilderbubbleOverlay"}),$(".js-pizzaBuilderbubbleOverlay").attr("id","bubbleOverlay")):a.ui.layer.mCreate(c)}else $("#bubbleOverlay").fadeOut(function(){a.ui.layer.mDestroy({id:"bubbleOverlay"})})},visualPizzaBubbleOverlayToggle:function(b,c){b?a.view.mRender({name:"visualPizzaBubbleOverlay",data:c,selector:".js-visualPizzaBubbleOverlay"}):$("#visualPizzaBubbleOverlay").fadeOut(function(){a.ui.layer.mDestroy({id:"visualPizzaBubbleOverlay"})})},hideOverlayCloseButton:function(){$(".js-closeButton").remove()},homepageWeekPopupConfig:{active:!0,dateRange:{start:moment("11/27/2017, 3:00:00"),end:moment("12/08/2017, 3:00:00")},friendlyDate:function(){return this.dateRange.start.format("M/D")+"-"+this.dateRange.end.clone().subtract(1,"d").format("M/D")},isActive:function(){if(d.storage.load("testingDate")&&-1===envConfig.indexOf("prod")){var a=new Date(d.storage.load("testingDate")),b=new Date;return a.setHours(b.getHours()),moment(a).isAfter(this.dateRange.start)&&moment(a).isBefore(this.dateRange.end)}return this.active&&moment().isAfter(this.dateRange.start)&&moment().isBefore(this.dateRange.end)}},delayedOverlay:function(a){var b=$.extend({show:!0,viewName:"genericOverlay",selector:"#genericOverlay",overlaySettings:{},UIBlockID:"overlayUIBlock1",data:{},showDelay:2e3,fadeOutDelay:null,hoverPause:2e3,setSeenFlag:!0,callback:function(){function a(a){return setTimeout(function(){e.fadeOut(),d.func.genericOverlayToggle({show:!1})},a)}var b,c=this,e=$("#"+c.viewName);c.fadeOutDelay&&(b=a(c.fadeOutDelay),e.mouseenter(function(){clearTimeout(b)}).mouseleave(function(){b=a(c.fadeOutDelay)})),c.setSeenFlag&&(jsDPZ.app.customer.getCustomer().data.Session.hasSeenWeekSpecialPopup=!0,d.sessionTools.save())}},a);setTimeout(function(){d.func.genericOverlayToggle(b)},a.showDelay)},signInPopup:function(a){jsDPZ.app.customer.getCustomer().data.Session.signInDisplayed=!0,d.sessionTools.save();var b,c=$(".js-sign-in--pop-up");setTimeout(function(){c.fadeIn("fast"),b=setTimeout(function(){c.fadeOut("slow")},a&&a.duration||4e3)},a&&a.initialWait||1e3),c.on("mouseover",function(){clearTimeout(b)}),c.on("mouseleave",function(){b=setTimeout(function(){c.fadeOut("slow")},a&&a.mouseLeaveWait||2e3)}),c.on("click",".js-login--pop-up",function(a){a.preventDefault(),d.func.doLoginRedirectAndShowPopup(a,{trigger:{group:"Account",subGroup:"Sign In Overlay",title:"Sign In Overlay – Sign In",uri:"/account/signin"}})}),c.on("click",".js-close-button",function(a){a.preventDefault(),c.fadeOut("slow"),d.trigger.onEvent({group:"Account",subGroup:"Sign In Overlay",title:"Sign In Overlay – X to Close",uri:"/account/signin"})}),c.on("click",".js-create-profile--pop-up",function(){d.trigger.onEvent({group:"Account",subGroup:"Sign In Overlay",title:"Sign In Overlay – Create One",uri:"/account/signin"})}),$(".home-touts").click(function(){c.hide()})},genericOverlayToggle:function(b){var e=$.extend({show:!0,viewName:"genericOverlay",selector:"#genericOverlay",overlaySettings:{},UIBlockID:"overlayUIBlock1",data:{},callback:$.noop},b);if(d.func.toggleLoading(!1),e.show){var f={};jsDPZ.util.empty(a.view.mData().Views[e.viewName])||(f={defaultContent:a.view.mData().Views[e.viewName].html(e.data),callback:function(){a.view.mData().Views[e.viewName].callback(e.selector,e.data),e.callback(e)}});var g=$.extend({id:e.viewName,keepCentered:!1,defaultContent:"",callback:function(){}},f,e.overlaySettings);c.queues.block=[],d.func.doOverlay(!0,c.queues.generic,e.viewName,g),d.func.doOverlay(!0,c.queues.block1,e.UIBlockID,{id:e.UIBlockID,isOverlay:!0})}else d.func.doOverlay(!1,c.queues.generic,e.viewName,e.callback()),d.func.doOverlay(!1,c.queues.block1,e.UIBlockID),d.func.bubbleOverlayToggle(!1);d.func.processOverlayQueues({delay:1})},setupLayerCloseEvents:function(a){var b=$.extend({closeSelector:".js-closeButton",layerSelector:"#_layer",callback:function(){}},a);$(b.closeSelector,b.layerSelector).click(function(a){a.preventDefault(),d.func.overlayToggle(!1),b.callback(this)})},doLoginRedirectAndShowPopup:function(a,b){var c=$.extend({evt:a,forceRedirect:!1},b);c.forceRedirect?(dpz.util.cookies.setItem("homepageRedirect","true",{sDomain:".dominos.com",sPath:"/"}),window.location=urlConfig.localRoot+"/index.jsp"):d.func.showLoginPopup(c)},showLoginPopup:function(a){var b={group:"Account",subGroup:"Sign In",title:"Account - Sign In",uri:"/account/signin"};a&&a.trigger&&$.extend(b,a.trigger),d.trigger.onEvent(b),d.func.overlayToggle(!0,site.data.customerLoginOverlay,{},$.extend(!0,{},a))},powerCommunicationError:function(a){var b=$.extend({type:"error",location:"kiosk-power-communication-fail",status:404,description:"Not Found"},a);dpz.kiosk.isActive&&dpz.kiosk.callWrapperApp(b),d.func.overlayToggle(!0,"codeOverlay",{},{code:"ePowerCommunication"})},buildOptionList:function(a){var b=$.extend({listValues:[],defaultValue:0},a),c="";return $.each(b.listValues,function(a,d){c+="<option "+(d.value==b.defaultValue?"selected ":"")+'value="'+d.value+'">'+d.label+"</option>"}),c},buildQtyOptionList:function(a){for(var b=[],c=1;c<=jsDPZ.config.app.MAX_QUANTITY;c++)b.push({value:c,label:c});return d.func.buildOptionList({listValues:b,defaultValue:a})},buildSideOptionList:function(a){for(var b=[],c=0;c<=jsDPZ.config.app.MAX_SIDE_QTY;c++)b.push({value:c,label:c});return d.func.buildOptionList({listValues:b,defaultValue:a})},buildURL:function(a){var b=$.extend({url:"",parameters:""},a),c="";if(b.url){"/"!=b.url.charAt(0)&&(c=b.url.slice(b.url.indexOf("#")+1));var d=b.parameters;for(var e in d)if(void 0!==d[e]&&d.hasOwnProperty(e)){var f=-1!=c.indexOf("?")?"&":"?";c+=f+e+"="+encodeURIComponent(d[e])}}return c},doWhenVisible:function(a,b,c){var d,e=$(a),f=!1,g="event"+Math.floor(10000001*Math.random());scrollEvent="scroll."+g,visibleEvent="visible."+g;var h=function(a){return $(a).offset().top+$(a).outerHeight()<$(window).innerHeight()+$(window).scrollTop()},i=function(){$(document).off(scrollEvent),$(document).off(visibleEvent)};return $(document).on(visibleEvent,function(){b(),f=!0,c&&(clearTimeout(d),i())}),h(e)&&$(document).trigger(visibleEvent),c&&f||$(document).on(scrollEvent,function(){d&&clearTimeout(d),d=setTimeout(function(){h(e)&&$(document).trigger(visibleEvent)},200)}),{events:{scroll:scrollEvent,visible:visibleEvent},eventNameSpace:g,unbind:i}},customerLoggedIn:function(){return jsDPZ.util.oauth.fallBackToBasicAuth()?dpz.basicauth.customerLoggedIn():dpz.oauth.customerLoggedIn()},customerSemiLoggedIn:function(){return!(d.func.customerLoggedIn()||!d.storage.load("CID"))},isLoggedInAndNotNewUser:function(){return(d.func.customerLoggedIn()||d.func.customerSemiLoggedIn())&&!d.func.customerCreatedProfile()},hasFirstVisitCookie:function(){return dpz.util.cookies.getItem("DPZUserFirstVisit")&&"true"===dpz.util.cookies.getItem("DPZUserFirstVisit")},customerCreatedProfile:function(){return!!jsDPZ.app.customer.getCustomer().data.Session.customerCreatedProfile},isGroupOrderingAvailable:function(){var a=dpz.util.getQueryParameters("groupOrder")||!1;return(killConfig.isActive("groupOrdering")||a)&&d.func.hasGroupOrderingProducts()},hasGroupOrderingProducts:function(){var a=jsDPZ.app.catalog.getCatalog().data;return!jsDPZ.util.empty(a.PreconfiguredProducts)},hasGroupOrderingCoupons:function(){var a=jsDPZ.app.catalog.getCatalog().data,b=!jsDPZ.util.empty(a.CouponTiers.MultiplePizza),c=!1;return b&&(c=!jsDPZ.util.empty(a.CouponTiers.MultiplePizza.Coupons)),c},isUsingGroupOrderingCoupons:function(){return!jsDPZ.util.empty(jsDPZ.app.order.getOrder().data.Tags)&&jsDPZ.app.order.getOrder().data.Tags.usingGroupOrderingCoupons},isGroupOrdering:function(){return!jsDPZ.util.empty(jsDPZ.app.order.getOrder().data.Tags)&&jsDPZ.app.order.getOrder().data.Tags.GroupOrdering},showDiscountDashboard:function(b){var c=dpz.util.getQueryParameters("groupOrder")||!1;d.func.hasGroupOrderingCoupons()&&d.func.isGroupOrdering()&&!$("#discountDashboard").is(":visible")&&(killConfig.isActive("groupOrdering")||c)?($(".pageLeftColumn").addClass("discountDashboard"),a.view.mRender({name:"discountDashboard",data:b,selector:"#js-discountDashboard"}),d.func.isHandheld()||(d.func.positionDiscountDashboard(),$(document).scroll(function(){var a=$("#dashboardContent").is(":visible")?10:0;$("#discountDashboard").addClass("animation"),$("#discountDashboard").css("bottom",function(b){var c=$("#pageContent"),d=c.offset().top+c.height(),e=d-window.innerHeight-window.pageYOffset+20;return e<0?0+a:e})}))):d.func.setDiscountDashboardNavButtons(b)},setDiscountDashboardNavButtons:function(a){$(".content-nextButtons .btn").hide(),jsDPZ.util.empty(a.categoryParams)?($(".content-nextButtons .btn.js-gOBtn, .js-returnTo").show(),$(".js-nextStep").hide()):"Pizza"==a.categoryParams.category&&"GroupOrdering"==a.categoryParams.section?($(".content-nextButtons .btn.js-pizza, .js-nextStep").show(),$(".js-returnTo").hide()):"Sides"==a.categoryParams.category&&"GroupOrdering"==a.categoryParams.section?($(".content-nextButtons .btn.js-sides, .js-nextStep").show(),$(".js-returnTo").hide()):($(".content-nextButtons .btn.js-gOBtn, .js-returnTo").show(),$(".js-nextStep").hide())},positionDiscountDashboard:function(){if(!d.func.isHandheld()){var a=$("#dashboardContent").is(":visible")?10:0;$("#discountDashboard").removeClass("animation"),$("#discountDashboard").css("bottom",0),$("#discountDashboard").css("bottom",function(b){var c=$("#pageContent"),d=c.offset().top+c.height(),e=d-window.innerHeight-window.pageYOffset+20;return e<0?0+a:e})}$("#js-discountDashboard").show()},hasAllSpecialtyChicken:function(a){for(var b=jsDPZ.app.order.getOrder().data.Details.Variants,c=[],d=[],e=0,f=b.length;e<f;e++)c.push(b[e].Code);for(var e=0,f=a.length;e<f;e++)-1==$.inArray(a[e],c)&&d.push(a[e]);return d.length>0},hasAnySpecialtyChicken:function(a){for(var b=jsDPZ.app.order.getOrder().data.Details.Variants,c=[],d=[],e=0,f=b.length;e<f;e++)c.push(b[e].Code);for(var e=0,f=a.length;e<f;e++)$.inArray(a[e],c)>-1&&d.push(a[e]);return d.length>0},hasNationalCoupons:function(a){var b=["9193","9194"],c=!1;if(0==a.length)c=!0;else for(var d=0,e=a.length;d<e;d++)$.inArray(a[d].Code,b)>-1&&(c=!0);return c},buildBirthDates:function(a){for(var b="",c=1,d=moment(a,"MM").daysInMonth();c<=d;c++)b+='<option value="'+c+'">'+c+"</option>";return b},buildExpirationDropdown:function(a){var b="number"==typeof a?a:0;void 0===a&&(b=17);for(var c=(new Date).getFullYear(),d="",e=0;e<b;e++)d+='<option value="20'+(c+e).toString().slice(2,4)+'">'+(c+e)+"</option>";return d},setCreditCardType:function(a,b){var c=dpz.config.getMarketProperty("mask"),d="",e=c&&c.creditCardFourDigits?c.creditCardFourDigits:{mask:"0000-0000-0000-0000",properties:{}},f=c&&c.creditCodeThreeDigits?c.creditCodeThreeDigits:{mask:"999",properties:{}};return/^5[1-5]/.test(a)?d="MASTERCARD":/^6(?:011|5)/.test(a)?d="DISCOVER":/^5[06-9]|^6\d/.test(a)?(d="MAESTRO",e={mask:"0000-0000-0000-9999-999",properties:{}}):/^4/.test(a)?d="VISA":/^3746-22/.test(a)?(d="OPTIMA",e=c&&c.creditCardFiveDigits?c.creditCardFiveDigits:{mask:"9999-999999-99999",properties:{}},f=c&&c.creditCodeFourDigits?c.creditCodeFourDigits:{mask:"9999",properties:{}}):/^3[47]/.test(a)?(d="AMEX",e=c&&c.creditCardFiveDigits?c.creditCardFiveDigits:{mask:"9999-999999-99999",properties:{}},f=c&&c.creditCodeFourDigits?c.creditCodeFourDigits:{mask:"9999",properties:{}}):/^(?:2131|1800|35)/.test(a)?d="JCB":/^3(?:0[0-5]|[68])/.test(a)&&(d="DINERS",e=c&&c.creditCardFiveDigits?c.creditCardFiveDigits:{mask:"9999-999999-99999",properties:{}}),killConfig.isMarketEnabled("masksEnabled")&&$(".js-creditCardType",b).val()!==d&&($(".js-creditCardNumber",b).mask(e.mask,e.properties),$(".js-obscuredCreditCardNumber",b).mask(e.mask.replace(/\-/g,""),e.properties),$(".js-securityCode",b).mask(f.mask,f.properties)),$(".js-creditCardType",b).val(d),d?$(".cardType .form__input--icon, .js-cardType .form__input--icon",b).filter("."+d).removeClass("nomatch").siblings(".form__input--icon").addClass("nomatch"):($(".js-cardType label[data-available='true']").removeClass("nomatch"),$(".js-cardType label[data-available!='true']").addClass("nomatch")),d},saveAccountData:function(a,b){var b=b||!1;d.storage.save("customerFirstName",a.data.FirstName,90);var a=$.extend({},{success:function(){},error:function(){},complete:function(){},data:{},statusCode:{}},a);b||d.func.toggleLoading(!0),jsDPZ.ajax.customerSave({data:a.data,success:function(b){var c=$.extend(!0,{},b);jsDPZ.app.customer.setCustomerFromPower(b),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=$.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),d.sessionTools.save(),d.func.updateMinorNavigation(),site.data.profile&&(site.data.profile.profileUpdated=!0),a.success(c)},error:function(b){d.trigger.onEvent({breadcrumb:["Customer","Save Error",b.status+" - "+b.statusText]});var c=b.responseText,e=c.StatusItems?d.func.getCustomerErrorKey(c.StatusItems[0].Field):"powerCustomerGenericError";d.func.overlayToggle(!0,"codeOverlay",{},{code:e}),a.error(b)},statusCode:a.statusCode,complete:function(c){b||d.func.toggleLoading(!1),a.complete(c)}})},getCustomerErrorKey:function(a){var b="";switch(a){case"EmailAlreadyUsed":b="powerCustomerEmailUsed";break;case"NotAuthorized":b="powerCustomer";break;case"EmailAlreadyUsedInOtherMarket":b="powerCustomerMarketEmailUsed";break;case"CustomerPhoneUsedTooManyTimes":b="powerCustomerPhoneUsedTooManyTimes"}return b},updateMainNavigation:function(b){var b=$.extend({main:"",sub:"",isContentPage:!1},b),c=$(".js-cart-icon");$("#discountDashboard").is(":visible")&&d.func.positionDiscountDashboard(),b&&(0===$(".js-headerContainer").children().length?a.view.mRender({name:"header",data:{options:b},selector:".js-headerContainer"}):(a.view.mRender({name:"mainNavigation",data:{main:b.main,sub:b.sub,isContentPage:b.isContentPage},selector:".js-siteMainNavigation"}),"home"!=b.main&&a.view.mRender({name:"main_sub_navigation",data:{main:b.main,sub:b.sub,isContentPage:b.isContentPage},selector:"#js-subNavigationPage"}),d.func.updateMinorNavigation(b.responsiveNav),site.isPaymentPage||site.isConfirmationPage||d.func.notifyCartUpdate()),~window.location.hash.indexOf("checkout")?c.addClass("is-hidden"):c.removeClass("is-hidden"),a.view.mRender({name:"mainFooter",data:{main:b.main,sub:b.sub},selector:".js-mainFooter"}))},needToUpdateMinorNavigation:function(){if(0===$("#headerProfileContainer").length||(d.func.customerLoggedIn()||d.func.customerSemiLoggedIn())&&""===jsDPZ.app.customer.getCustomer().data.FirstName&&jsDPZ.util.empty(d.storage.load("customerFirstName")))return!1;var a=[d.func.customerSemiLoggedIn(),d.func.customerLoggedIn(),jsDPZ.app.customer.getCustomer().data.FirstName,dpz.loyalty.loyaltyIsOk(),"handheld"===d.func.getCurrentBreakpoint()&&location.hash].join("");return(!site.data.minorNavigationHash||site.data.minorNavigationHash!==a)&&(site.data.minorNavigationHash=a,!0)},updateMinorNavigation:function(b,c){if(c||d.func.needToUpdateMinorNavigation()){if(d.func.updateMiniNavView(b),a.view.mRender({name:"headerProfile",data:jsDPZ.app.customer.getCustomer().data,selector:"#headerProfileContainer"}),d.func.customerLoggedIn()||d.func.customerSemiLoggedIn()){$(".js-loginStateLoggedIn").removeClass("is-hidden"),$(".js-loginStateLoggedOut").addClass("is-hidden"),$.each($("header.is-anon"),function(a,b){$(this).removeClass("is-anon").addClass("is-profiled")});var e=~window.location.hash.indexOf("#/content/"),f=~window.location.hash.indexOf("#/customer/claim-rewards"),g=0===window.location.hash.indexOf("#/section/Food/category/")&&-1===window.location.hash.indexOf("AllEntrees/");e||!(site.isHomepage||f||g)?$(".js-contentWrap").removeClass("content-wrap--full-header"):$(".js-contentWrap").addClass("content-wrap--full-header")}else $(".js-loginStateLoggedIn").addClass("is-hidden"),$(".js-loginStateLoggedOut").removeClass("is-hidden"),$(".js-contentWrap").addClass("content-wrap--full-header");~window.location.hash.indexOf("/content/")&&($(".js-headerContainer").removeClass("homepage"),$(".js-contentWrap").removeClass("homepage")),site.data.ABData.minorNavigationRendered=!0,$(document).trigger("minorNavigationRendered"),jsDPZ.topic("minor.nav.update").publish({})}},updateMiniNavView:function(b){if(site.isHomepage){var c=~window.location.hash.indexOf("#/content/");a.view.mRender({name:"miniNav_view",data:{isContentPage:c},selector:".js-miniNavContainer"})}else{var d=site.isPaymentPage?"payment.or_create_one_below":"";a.view.mRender({name:"customerResponsiveLogin",data:$.extend({message:d,showBackButton:!0},b),selector:".js-miniNavContainer"})}},printRemote:function(a,b){var c=a.currentTarget.href;0==$("#"+b).length?$("body:first").append('<iframe style="position:fixed;top:100;left:100;height:1px;width:1px;border:none;" id="'+b+'" name="'+b+'" src="'+c+'"></iframe>'):window.frames[b].window.location.reload(!0)},imageExists:function(a){var b=new Image;return b.src=a,0!==b.naturalWidth},fixMissingImages:function(a){var b="placeholder.jpg",c=!1,e="localhost"==envConfig||"nolo-us-dev1"==envConfig||"nolo-us-qa1"==envConfig||"nolo-us-dev2"==envConfig||"nolo-us-qa2"==envConfig||"nolo-us-dev3"==envConfig||"nolo-us-qa3"==envConfig||"nolo-us-dev4"==envConfig||"nolo-us-qa4"==envConfig||"nolo-us-preprod"==envConfig;$.each(a,function(){this.onerror=function(){if(void 0===this.hasErrored){var a=this.src;a=a.substring(0,a.lastIndexOf("/")+1)+b,this.src=a,this.hasErrored=!0}else if(e&&!c)throw c=!0,Error('[WARNING] - MISSING PLACEHOLDER IMAGE\n\nThe following directory is missing a "'+b+'" image:\n'+this.src.substring(0,this.src.lastIndexOf("/")+1)+'\n\nPlease add an appropriately sized "'+b+'" image to the above directory.');$("#discountDashboard").is(":visible")&&d.func.positionDiscountDashboard()}})},formFocus:function(){$("input, select").not("[type='checkbox'],[type='radio']").on("focus",function(){$(this).addClass("focus")}).on("blur",function(){$(this).removeClass("focus")})},setRedirect:function(a,b){d.storage.save("dpz_redirect_url",a||window.location.href),jsDPZ.app.customer.getCustomer().data.Session.displayCouponRoutingMessage=!1,site.oloTools&&site.oloTools.config&&site.oloTools.config.status&&"NO_OLO_RDY"===site.oloTools.config.status&&b&&b.section&&b.category&&"Coupons"===b.section&&"All"===b.category&&(jsDPZ.app.customer.getCustomer().data.Session.displayCouponRoutingMessage=!0),d.sessionTools.save()},tryRedirect:function(a){var b=d.storage.load("dpz_redirect_url");if(b?d.storage.remove("dpz_redirect_url"):window.location.hash=a,b){var c=document.createElement("a");if(c.href=b,c.search){var e=c.search.split("?")[1].split("&").filter(function(a){return!a.match(/^clear/)});c.search=e.join("&")}window.location.href=c.href}},initTileRotator:function(a,b){var c,d=$(a),e=d.length,f=0;return d.eq(0).show(),e>1&&(c=setInterval(function(){d.eq(f).fadeOut(),f=++f%e,d.eq(f).fadeIn()},8e3)),b&&$(document).on("/breakpoint/change/handheld/ /breakpoint/change/desktop/",function(a){clearInterval(c)}),c},isHandheld:function(){var a="screen and (max-width: "+site.data.breakpoint.handheldMaxSize+"px)";return window.matchMedia&&window.matchMedia(a)&&window.matchMedia(a).matches},getCurrentBreakpoint:function(){return window.getComputedStyle&&document.body&&window.getComputedStyle(document.body,":after")?window.getComputedStyle(document.body,":after").getPropertyValue("content").replace(/'|"/g,""):""},toggleOffCanvasNav:function(){$body=$("body"),$body.toggleClass("is-handheld-nav-visible"),$body.hasClass("is-handheld-nav-visible")&&d.trigger.onPage({title:"Handheld Navigation",savePreviousState:!0})},abtest:{force:function(a){d.storage.save("forcedABtestParam",a)},clear:function(){d.storage.remove("forcedABtestParam")},getParam:function(){return d.storage.load("forcedABtestParam")}},hideOffCanvasPanels:function(){d.func.isHandheld()&&$("body").removeClass("is-handheld-nav-visible is-handheld-cart-visible")},animateScroll:function(a,b,c,e){var f,g;(d.func.isHandheld()||!0===c)&&(a=a||"html, body",f=c?30:90,g=b?$(b).offset().top-$(a).offset().top-f:0,$(a).animate({scrollTop:g},400).promise().then(e))},notifyCartUpdate:function(){for(var a=jsDPZ.app.order.getOrder().data.Details.Variants,b=0,c=a.length,d=0;b<c;b++)a[b].hasOwnProperty("AutoRemove")&&a[b].AutoRemove||(d+=a[b].Qty);if($jsCartIcon=$(".js-cart-icon"),$jsCartIcon.attr("data-order-qty",d),d>0){$jsCartIcon.attr("data-has-order-qty","true"),$jsCartIcon.removeAttr("data-has-order-qty"),$(".js-checkout-cta--handheld").removeClass("is-hidden"),$(".js-easyOrderButton-cta--handheld").removeClass("is-hidden"),$(".js-icon-separator").removeClass("is-hidden");setTimeout(function(){$jsCartIcon.attr("data-has-order-qty","true"),$(".js-checkout-cta--handheld").removeClass("is-hidden")},0)}else $jsCartIcon.removeAttr("data-has-order-qty")},profileReorder:function(b,c,e,f){var g=$(b).data("orderid"),h={},i=["CreditCard","Adyen","Fnb"],j={},k=!1,l=!0;if(f?(l=!1,j=f):!jsDPZ.util.empty(c)||jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink?(j=c,k=!0,l=!1):$(b).hasClass("js-easyOrder")||jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink||$.each(e,function(a,b){b.id==g&&(j=b)}),j){d.func.setOrder(j.order),1===j.order.Payments.length?(h.Type=j.order.Payments[0].Type,i.includes(h.Type)&&(jsDPZ.util.empty(j.cards)?"Fnb"===h.Type?h.CardID=j.order.Payments[0].CardID:h.CardID=null:h.CardID=j.cards[0].id)):h.Type="Multiple";var m={metaData:{originatedFrom:"",originalOrderID:$(b).data("orderid")}};$(b).parent().parent().hasClass("easyOrder")?m.metaData.originatedFrom="easyOrder":m.metaData.originatedFrom="historicalOrder",$.extend(jsDPZ.app.order.getOrder().data,m);var n=$.extend(!0,jsDPZ.app.customer.getCustomer().data,{Session:{Address:$.extend(!0,jsDPZ.config.dataModel.ADDRESS,j.order.Address),ServiceMethod:j.order.ServiceMethod,StoreID:j.order.StoreID,PaymentInfo:h,IsEasyOrder:k,IsRecentOrder:l,Reorder:!!jsDPZ.app.order.getOrder().data.Details.Variants.length,IsReordering:!0,IsRecentItemsOrder:!!f,newOrderProductsCount:j?j.order.Products.length:null}});if(n.Session.Address.UnitNumber&&(n.Session.Address.AddressLine2=n.Session.Address.UnitNumber),jsDPZ.app.customer.setCustomer(n),d.storage.save("ServiceType",j.order.ServiceMethod),"Carryout"==j.order.ServiceMethod){var o=jsDPZ.app.customer.getCustomer().data.Session.Address;jsDPZ.util.empty(o.Street)&&jsDPZ.util.empty(o.City)&&jsDPZ.util.empty(o.Region)&&jsDPZ.util.empty(o.PostalCode)&&(jsDPZ.app.customer.getCustomer().data.Session.Address.City=j.store.address.City,jsDPZ.app.customer.getCustomer().data.Session.Address.Region=j.store.address.Region,jsDPZ.app.customer.getCustomer().data.Session.Address.PostalCode=j.store.address.PostalCode)}}d.storage.save("dpz_customer_address",a.conversion.mObjectToJSONString(jsDPZ.app.customer.getCustomer().data.Session.Address));var p=void 0;p=0===jsDPZ.app.order.getOrder().data.Details.Variants.length?jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink?"/":"/pages/order/#/section/Food/category/AllEntrees/":"/pages/order/#/locate-store/",jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink=!1,d.sessionTools.save().then(function(){window.location.href=urlConfig.root+p})},easyOrderDeepLink:function(){var a=$("html").attr("lang")||"en";jsDPZ.app.customer.getCustomer().fetchOrderHistory({customerID:d.storage.load("CID"),loggedIn:d.func.customerLoggedIn(),loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),lang:a,success:function(a){var b=a.easyOrder;jsDPZ.ajax.menu({StoreID:a.easyOrder.order.StoreID,success:function(a){jsDPZ.app.catalog.setCatalog(a),d.func.profileReorder(null,b,null)},error:function(a){function b(b){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){error=!0,d.func.powerCommunicationError()})})}})},setOrder:function(a){function b(a){for(var b={},c=jsDPZ.app.catalog.getCatalog().getDefaultVariantToppingsData(a),d=0,e=c.length;d<e;d++){var f=c[d];b[f.Code]={"1/1":f.Availability[0]}}return b}jsDPZ.app.order.setOrder({Details:{ServiceMethod:a.ServiceMethod,StoreID:a.StoreID},Customer:{Address:a.Address}});for(var c=jsDPZ.app.order.getOrder(),d=jsDPZ.app.catalog.getCatalog().data,e=0,f=a.Products.length;e<f;e++){var g=a.Products[e],h=jsDPZ.app.catalog.getCatalog().getVariant(g.Code),i={Code:g.Code,Qty:g.Qty,ID:-1,Sides:{},Toppings:{},Instructions:g.Instructions},j=g.Options,k=g.CategoryCode;if(!jsDPZ.util.empty(h)){if($.each(j,function(a,b){d.Sides[k]&&d.Sides[k].hasOwnProperty(a)?i.Sides[a]=b:d.Toppings[k]&&d.Toppings[k].hasOwnProperty(a)&&(i.Toppings[a]=b)}),h.data.Tags.DefaultSides){var l=h.data.Tags.DefaultSides.split("="),m={};m[l[0]]=l[1],i.Sides=$.extend(m,i.Sides)}var n=b(g.Code);if(jsDPZ.util.empty(i.Sides)||$.each(i.Sides,function(a,b){b=$.isPlainObject(b)?b:$.makeArray(b),$.each(b,function(b,c){c>0?i.Sides[a]=parseInt(c):delete i.Sides[a]})}),!jsDPZ.util.empty(i.Toppings)||!jsDPZ.util.empty(n)){var o=$.extend(!0,n,i.Toppings);for(var p in o){var q=n[p]["1/1"];for(var r in o[p])o[p][r]=parseFloat(o[p][r]),"1/2"!==r&&"2/2"!==r||(delete o[p]["1/1"],"2/2"!==r||o[p].hasOwnProperty("1/2")?"1/2"!==r||o[p].hasOwnProperty("2/2")||(o[p]["2/2"]=q):o[p]["1/2"]=q)}i.Toppings=o}}c.addVariant(i)}a.Coupons.forEach(function(a){c.addCoupon({Code:a.Code,Qty:a.Qty||1})})},getOrderForPowerData:function(a){var b=$.Deferred(),c=$.extend(!0,{orderInfo:dpz.config.getMarketProperty("orderInfoCollection").taxidFields},a);return dpz.loyalty.loyaltyIsOk()&&!c.calculatePotentialPoints?jsDPZ.app.order.getOrder().filterCoupons({filterFailure:!0,successFilter:function(a,b){return b.isLoyaltyCoupon()}}).done(function(a){c.calculatePotentialPoints=a.length>0,b.resolve(jsDPZ.app.order.getOrderForPowerData(c))}):(dpz.loyalty.loyaltyIsOk()||void 0===c.calculatePotentialPoints||delete a.calculatePotentialPoints,b.resolve(jsDPZ.app.order.getOrderForPowerData(c))),b},createEasyOrder:function(){function b(){function b(){var b=!d.func.isHandheld(),c=jsDPZ.app.customer.getCustomer();c.setEasyOrder({data:{orderID:$(".btn.saveEasyOrder").attr("data-orderid"),easyOrderNickName:$("#Easy_Order_Nickname").val()==$("#Easy_Order_Nickname").attr("placeholder")?"":$("#Easy_Order_Nickname").val()},success:function(e){jsDPZ.app.customer.getCustomer().data.Session.EasyOrder=e,d.sessionTools.save(),dpz.util.cookies.removeItem("missingProducts"),d.trigger.onEvent({uri:"/account/saveeasyorder",title:"Account - Save Easy order",group:"Account",subGroup:"Save Easy Order"});var f=$("html").attr("lang")||"en";c.fetchOrderHistory({loggedIn:d.func.customerLoggedIn(),lang:f,loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),success:function(b){var c=b.customerOrders[0];$.each(b.customerOrders,function(a,b){if(b.easyOrder)return c=b,!1});var d=killConfig.isMarketEnabled("recentOrderItems")&&site.func.isHandheld();a.view.mRender({name:"order_history_view",data:{customerOrders:b,showRecentOrderItems:d},selector:"#orderHistory"})}}),d.func.animateScroll("html, body",".js-easyOrderContainer",b)},complete:function(){d.func.toggleLoading(!1)}})}$(".js-recentOrderReorder a").addClass("red-to-blue"),$(".js-createEasyOrder").off("click"),$(".saveEasyOrder").removeClass("js-createEasyOrder").addClass("blue-to-red js-saveEasyOrder"),$(".save-easy-order-container").slideDown("slow"),$(".js-orderHistorySection .note.default").hide(),$(".js-orderHistorySection .save-easy-order .note").show(),$(".js-recentOrders .ribbon").removeClass("grid__cell--1/2@desktop").addClass("grid__cell--4/5"),$(".js-ribbonRecentOrders").fadeOut("fast",function(){$(".js-recentOrders .double-stripes").removeClass("double-stripes--quarter-edge").addClass("double-stripes--eighth-edge"),$(".js-ribbonSaveEasyOrder").fadeIn("slow")}),$(".js-createEasyOrder, .js-createEasyOrderMain").on("click",function(a){a.preventDefault(),d.func.customerSemiLoggedIn()?d.func.showLoginPopup({setEasyOrder:$(this).attr("data-orderid"),selector:"js-createEasyOrder"}):(d.func.createEasyOrder("js-createEasyOrder"),d.func.isHandheld()&&($(".orderHistoryOrder").is(":visible")||$(".js-recentOrders .card__title").click()))}),$(".js-saveEasyOrder").on("click",function(a){a.preventDefault(),d.func.toggleLoading(!0),b()}),$("#Easy_Order_Nickname").focus(function(){$("#Easy_Order_Nickname").keypress(function(a){"13"==a.keyCode&&b()})})}var c=!site.func.isHandheld();site.func.animateScroll("html, body",".js-recentOrders.js-recentOrderEasyOrder",c,b)},hasCanvasSupport:function(){return!!window.HTMLCanvasElement&&!!window.CanvasRenderingContext2D},getPhoneGridSizes:function(a){var b=$.extend({isCallbackPhone:!1,isAlternatePhone:!1,isContactForm:!1,isMobilePhone:!1},a),c={phoneExtension:"",phoneNumber:"grid__cell--1",phonePrefix:"",mobilePhoneNumber:""};return b.isCallbackPhone?(c.PhonePrefix="grid__cell--1/4@desktop grid__cell--1/5",c.PhoneExtension=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--1/5":"grid__cell--1/4@desktop grid__cell--1/5",c.ErrorLabel=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--3/4@desktop grid__cell--offset-1/4@desktop grid__cell--4/5 grid__cell--offset-1/5":"grid__cell--1",killConfig.isMarketEnabled("phonePrefix")?killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--2/5@desktop grid__cell--1/2":c.PhoneNumber="grid__cell--3/5@desktop grid__cell--2/3":killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--3/5@desktop grid__cell--5/8":c.PhoneNumber="grid__cell--7/8"):b.isAlternatePhone?(c.PhonePrefix="grid__cell--1/3@desktop grid__cell--1/5",c.PhoneExtension=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--1/3@desktop grid__cell--1/5":"grid__cell--1/3",c.ErrorLabel=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--2/3@desktop grid__cell--offset-1/3@desktop grid__cell--4/5 grid__cell--offset-1/5":"grid__cell--1",killConfig.isMarketEnabled("phonePrefix")?killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--1/3@desktop grid__cell--3/5":c.PhoneNumber="grid__cell--2/3@desktop grid__cell--4/5":killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--2/3":c.PhoneNumber="grid__cell--1"):b.isContactForm?(c.PhonePrefix="grid__cell--1/6@desktop grid__cell--1/4",c.PhoneExtension=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--1/6@desktop grid__cell--1/4":"grid__cell--1/3",c.ErrorLabel=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--5/6@desktop grid__cell--offset-1/6@desktop grid__cell--3/4 grid__cell--offset-1/4":"grid__cell--1",killConfig.isMarketEnabled("phonePrefix")?killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--1/3@desktop grid__cell--1/2":c.PhoneNumber="grid__cell--1/2@desktop grid__cell--3/4":killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--2/3":c.PhoneNumber="grid__cell--1"):(c.PhonePrefix="grid__cell--1/4@desktop grid__cell--1/5",c.PhoneExtension=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--1/4@desktop grid__cell--1/5":"grid__cell--2/5",c.ErrorLabel=killConfig.isMarketEnabled("phonePrefix")?"grid__cell--3/4@desktop grid__cell--offset-1/4@desktop grid__cell--4/5 grid__cell--offset-1/5":"grid__cell--1",killConfig.isMarketEnabled("phonePrefix")?killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--1/2@desktop grid__cell--3/5":c.PhoneNumber="grid__cell--3/4@desktop grid__cell--4/5":killConfig.isMarketEnabled("phoneExtension")?c.PhoneNumber="grid__cell--3/5":c.PhoneNumber="grid__cell--1"),b.isMobilePhone&&(c.mobilePhoneNumber="grid__cell--1"),c},wasDeepLinked:function(){return"1"===dpz.util.getQueryParameters("route")||site.data.deepLink.wasDeepLinked},toggleDataValidation:function(a,b){$(b).data("error-code",a),$(b).valid(),$(b).data("error-code","")},checkForImage:function(a){var b=$.Deferred(),c=document.createElement("img");return c.onload=b.resolve,c.onerror=b.reject,c.src=a,b},buildEscapedUrl:function(a){var b=document.createElement("a");return b.href=a,b.href},generatePageSEO:function(){require(["marketconfig/dpz.lang"],function(a){var b=[],c=void 0,d="";$("link[rel=canonical],link[rel=alternative]").remove();var e=document.createElement("link");if(e.rel="canonical",e.href=site.func.buildEscapedUrl(document.location.origin+document.location.pathname.replace("index.jsp","")+(dpz.market.primaryLanguageCode!==dpz.market.activeLanguageCode?"?lang="+dpz.market.activeLanguageCode:"")+document.location.hash),b.push(e),Object.keys(dpz.market.languages).forEach(function(a){if(a!==dpz.market.activeLanguageCode&&(!document.location.pathname.includes("/about-pizza/")||"US/_en"!==dpz.market.folderName)){var c=document.createElement("link");c.rel="alternate",c.hreflang=a,"US"!==dpz.market.marketCode&&(c.hreflang+="-"+dpz.market.marketCode),c.href=site.func.buildEscapedUrl(document.location.origin+document.location.pathname+"?lang="+a+document.location.hash),b.push(c)}}),c=location.pathname.replace("/"+dpz.market.activeLanguageCode+"/","/").replace("index.jsp","")+location.hash,"/pages/services/"===c&&(c+=location.search),d=a["seo."+c]||a["seo./"],d.metaDescription&&d.metaKeywords&&($("meta[name=description],meta[name=keywords]").remove(),b.push('<meta name="description" content="'+(d.metaDescription?d.metaDescription():"")+'"><meta name="keywords" content="'+(d.metaKeywords?d.metaKeywords():"")+'"">')),d.title&&killConfig.isMarketEnabled("bypassTitleTag"))if($("head title").length)$("head title").text(d.title);else{var f=$("<title></title>").text(d.title);$("head").append(f)}$("head").append(b)})},localizeFlash:function(a){"string"==typeof a&&(a={file:a});var b=$.extend(!0,{file:"",lang:dpz.market.activeLanguageCode},a);if("string"!=typeof b.file||dpz.util.isEmpty(b.file))return"file is either empty or not a string";switch(b.lang.toLowerCase()){case"es":return b.file.replace(/_EN/,"_"+b.lang.toUpperCase()).replace(/_en/,"_"+b.lang.toLowerCase());default:return b.file}},loadHashFromFlash:function(b){a.controller.mRouteAndExecute(d.func.buildURL({url:b}))},loadRouteFromFlash:function(a){window.location.href=a},canDisplayDomButton:function(){return $.Deferred(function(a){require(["dpz.history"],function(b){!killConfig.isMarketEnabled("domChat")||dpz.kiosk.isActive||!site.isHomepage&&JSON.stringify(dpz.history.getStates()[0])!==JSON.stringify(dpz.history.getStates()[dpz.history.getStates().length-1])||null!==dpz.util.getQueryParameters("couponCode")||null!==dpz.util.getQueryParameters("variantCode")||null!==dpz.util.getQueryParameters("productCode")||null!==dpz.util.getQueryParameters("promocode")?a.reject():a.resolve()})})}},dataTools:{dataForLayout:function(a){if(jsDPZ.util.empty(a))return{};var b=$.extend(!0,{},a),c={};return $.each(b,function(a,b){var d=(a.charAt(0).toLowerCase()+a.slice(1)).replace(/_/g,"");jsDPZ.util.empty(b)?c[d]=b:$.isPlainObject(b)?c[d]=site.dataTools.dataForLayout(b):c[d]="boolean"==typeof b?b?"true":"false":b}),c},dataForDPZ:function(a){if(jsDPZ.util.empty(a))return{};var b=$.extend(!0,{},a),c={};return $.each(b,function(a,b){var d=a.charAt(0).toUpperCase()+a.slice(1);jsDPZ.util.empty(b)?c[d]=b:$.isPlainObject(b)?c[d]=site.dataTools.dataForDPZ(b):c[d]="true"==b||"false"==b?"true"==b:b}),c}},storage:{save:function(b,c,d){var e=864e5*(d||1);return a.browser.mLocalStorageCapable()?a.cache.mSet({key:b,data:c,freshness:e}):dpz.util.cookies.setItem(b,c)},load:function(b){var c=a.browser.mLocalStorageCapable()?a.cache.mGet({key:b}):dpz.util.cookies.getItem(b);return"null"===c&&(c=null),c},remove:function(b){return a.browser.mLocalStorageCapable()?a.cache.mExpire(b):dpz.util.cookies.removeItem(b)}},sessionTools:{sessionTimeout:setTimeout(function(){if(d.func.customerLoggedIn()){var b={doRedirect:"true"};-1==window.location.href.indexOf("confirmation.jsp")&&-1==window.location.href.indexOf("/pages/tracker/")||(b.doRedirect="false"),a.controller.mRouteAndExecute(d.func.buildURL({url:"#/customer/semilogout/",parameters:b}))}},18e5),resetTimeout:function(){clearTimeout(d.sessionTools.sessionTimeout),d.sessionTools.sessionTimeout=setTimeout(function(){if(d.func.customerLoggedIn()){var b={doRedirect:"true"};-1==window.location.href.indexOf("confirmation.jsp")&&-1==window.location.href.indexOf("/pages/tracker/")||(b.doRedirect="false"),a.controller.mRouteAndExecute(d.func.buildURL({url:"#/customer/semilogout/",parameters:b}))}},18e5)},load:function(b){var c;if(Modernizr.localstorage){c=$.Deferred();try{sessionStorage.Customer&&jsDPZ.app.customer.setCustomer(a.conversion.mJSONStringToObject(sessionStorage.Customer)),sessionStorage.Order&&jsDPZ.app.order.setOrder(a.conversion.mJSONStringToObject(sessionStorage.Order)),sessionStorage.LastOrder&&(site.data.lastOrder=a.conversion.mJSONStringToObject(sessionStorage.LastOrder)),sessionStorage.Store&&jsDPZ.app.store.setStore(a.conversion.mJSONStringToObject(sessionStorage.Store)),c.resolve()}catch(a){c.reject(a)}}else{var e=d.storage.load("sessionID");null!=e?c=jsDPZ.ajax.sessionLoad({id:e,async:!0,success:function(a){jsDPZ.app.customer.setCustomer(a.Customer),jsDPZ.app.order.setOrder(a.Order),site.data.lastOrder=a.LastOrder,jsDPZ.app.store.setStore(a.Store)},error:function(a,b,c){d.trigger.onEvent({title:"Error Page",group:"Error",subGroup:"Session Load Error "+a.status+" - "+a.statusText,eventType:"error"}),c&&d.storage.remove("sessionID")}}):(c=$.Deferred(),c.resolve())}return c},save:function(b){var c;if(Modernizr.localstorage){c=$.Deferred();try{sessionStorage.Customer=a.conversion.mObjectToJSONString(jsDPZ.app.customer.getCustomer().data),sessionStorage.Order=a.conversion.mObjectToJSONString(jsDPZ.app.order.getOrder().data),sessionStorage.LastOrder=a.conversion.mObjectToJSONString(site.data.lastOrder),sessionStorage.Store=a.conversion.mObjectToJSONString(jsDPZ.app.store.getStore().data),c.resolve()}catch(a){c.reject(a)}}else{var e=null==d.storage.load("sessionID")?"":d.storage.load("sessionID"),f={Customer:jsDPZ.app.customer.getCustomer().data,Order:jsDPZ.app.order.getOrder().data,LastOrder:site.data.lastOrder,Store:jsDPZ.app.store.getStore().data};c=jsDPZ.ajax.sessionSave({id:e,data:f,async:!0,success:function(a){d.storage.save("sessionID",a)},error:function(a,b,c){d.trigger.onEvent({title:"Error Page",group:"Error",subGroup:"Session Save Error "+a.status+" - "+a.statusText,eventType:"error"}),c&&d.storage.remove("sessionID")}})}return c},remove:function(a){if(Modernizr.localstorage)sessionStorage.clear();else{var b=$.extend({callback:function(){}},a);d.storage.remove("sessionID"),d.storage.remove("testingDate"),b.callback()}}},breakpoint:{startListener:function(){site.data.breakpoint.previousBreakpoint=d.func.getCurrentBreakpoint(),$(window).resize(function(){clearTimeout(site.data.breakpoint.resizeTimer),site.data.breakpoint.resizeTimer=setTimeout(function(){var a=d.func.getCurrentBreakpoint();a!=site.data.breakpoint.previousBreakpoint&&($(document).trigger("/breakpoint/change/"+a+"/"),site.data.breakpoint.previousBreakpoint=a)},35)})}}};return $.extend(!0,window.site,d),d}),window.site={},window.killConfig={globalData:{},localData:{},loadDependency:function(a){require(["simplr"],function(){var b,c=$.extend(!0,{key:"",ajax:{url:"",dataType:"script",timeout:3e3,success:function(){},error:function(){},complete:function(){}},write:"",append:"",appendTo:"body"},a),d={jsonld:{type:"script",parent:document.head,props:{type:"application/ld+json"}},js:{type:"script",parent:document.body,urlProp:"src",props:{type:"text/javascript",charset:"utf-8",async:!0}},css:{type:"link",parent:document.head,urlProp:"href",props:{rel:"stylesheet",type:"text/css",charset:"utf-8"}}};dpz.util.isEmpty(c.key)||(dpz.util.isEmpty(c.ajax.url)?dpz.util.isEmpty(c.append)?dpz.util.isEmpty(c.appendScriptTags)||Object.keys(d).forEach(function(a){$.makeArray(c.appendScriptTags[a]).forEach(function(b){var c=d[a],e=document.createElement(c.type);$.each(c.props,function(a,b){e[a]=b}),e[c.urlProp||"innerText"]=b,c.parent.appendChild(e)})}):$(function(){$(c.appendTo).append(c.append)}):(b=$.extend(!0,{},c.ajax,{success:function(a){c.ajax.success(a)},error:function(){killConfig.globalData[c.key]=!1,c.ajax.error()},complete:function(){c.ajax.complete()}}),$.ajax(b)))})}},function(a,b){function c(b,c,d){var e=[];if(b.inset&&e.push("inset"),void 0!==c.left&&e.push(parseInt(b.left+d*(c.left-b.left),10)+"px "+parseInt(b.top+d*(c.top-b.top),10)+"px"),void 0!==c.blur&&e.push(parseInt(b.blur+d*(c.blur-b.blur),10)+"px"),void 0!==c.spread&&e.push(parseInt(b.spread+d*(c.spread-b.spread),10)+"px"),void 0!==c.color){var f="rgb"+(a.support.rgba?"a":"")+"("+parseInt(b.color[0]+d*(c.color[0]-b.color[0]),10)+","+parseInt(b.color[1]+d*(c.color[1]-b.color[1]),10)+","+parseInt(b.color[2]+d*(c.color[2]-b.color[2]),10);a.support.rgba&&(f+=","+parseFloat(b.color[3]+d*(c.color[3]-b.color[3]))),f+=")",e.push(f)}return e.join(" ")}function d(a){var b,c,d={};return(b=/#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/.exec(a))?c=[parseInt(b[1],16),parseInt(b[2],16),parseInt(b[3],16),1]:(b=/#([0-9a-fA-F])([0-9a-fA-F])([0-9a-fA-F])/.exec(a))?c=[17*parseInt(b[1],16),17*parseInt(b[2],16),17*parseInt(b[3],16),1]:(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a))?c=[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10),1]:(b=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9\.]*)\s*\)/.exec(a))&&(c=[parseInt(b[1],10),parseInt(b[2],10),parseInt(b[3],10),parseFloat(b[4])]),d=(b=/(-?[0-9]+)(?:px)?\s+(-?[0-9]+)(?:px)?(?:\s+(-?[0-9]+)(?:px)?)?(?:\s+(-?[0-9]+)(?:px)?)?/.exec(a))?{left:parseInt(b[1],10),top:parseInt(b[2],10),blur:b[3]?parseInt(b[3],10):0,spread:b[4]?parseInt(b[4],10):0}:{left:0,top:0,blur:0,spread:0},d.inset=/inset/.test(a),d.color=c,d}var e,f={begin:"#FF0000",end:"#E5EDF3",duration:1e3,fps:20},g={init:function(b){b&&a.extend(f,b),this.each(function(){var b=a(this);6==f.begin.length&&(f.begin="#"+f.begin),6==f.end.length&&(f.end="#"+f.end),f.duration||(f.duration=1e3),f.fps||(f.fps=20),f.duration=parseFloat(f.duration),f.fps=parseFloat(f.fps);var c=Math.ceil(1e3/f.fps),d=Math.ceil(f.duration/c);for(i=1;i<=d;i++)!function(){function a(){var a=g.ease(e,h[0],k,d),c=g.ease(e,h[1],l,d),f=g.ease(e,h[2],m,d),i="rgb("+parseInt(a)+","+parseInt(c)+","+parseInt(f)+")";b.css({"background-color":i})}var e=i,h=g.cssColor2rgb(f.begin),j=g.cssColor2rgb(f.end),k=j[0]-h[0],l=j[1]-h[1],m=j[2]-h[2];timer=setTimeout(a,c*e)}()})},d2h:function(a){return a.toString(16)},h2d:function(a){return parseInt(a,16)},rgb2h:function(a,b,c){return[g.d2h(a),g.d2h(b),g.d2h(c)]},h2rgb:function(a,b,c){return[g.h2d(a),g.h2d(b),g.h2d(c)]},cssColor2rgb:function(a){return a.indexOf("rgb")<=-1?g.h2rgb(a.substring(1,3),a.substring(3,5),a.substring(5,7)):a.substring(4,a.length-1).split(",")},ease:function(a,b,c,d){return b+c*(a/d)}};a.extend(!0,a,{fn:{animateColor:function(b,c){var d=b||"init";if(g[d]?g[d].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==(void 0===d?"undefined":_typeof(d))&&d?a.error("Method "+d+" does not exist on jQuery.animateColor"):g.init.apply(this,arguments),"function"==typeof c)return setTimeout(c,f.duration)}},support:{rgba:function(){var b=a("script:first"),c=b.css("color"),d=!1;if(/^rgba/.test(c))d=!0;else try{d=c!==b.css("color","rgba(0, 0, 0, 0.5)").css("color"),b.css("color",c)}catch(a){return!1}return d}}}),a.each(["boxShadow","MozBoxShadow","WebkitBoxShadow"],function(b,c){var d=a("html").css(c);if("string"==typeof d&&""!=d)return e=c,!1}),e&&(a.extend(!0,a,{step:{boxShadow:function(f){f.init||(f.begin=d(a(f.elem).get(0).style[e]||a(f.elem).css(e)),f.end=a.extend({},f.begin,d(f.end)),f.begin.color==b&&(f.begin.color=f.end.color||[0,0,0]),f.init=!0),f.elem.style[e]=c(f.begin,f.end,f.pos)}}}),a.fx.step.boxShadow=function(f){f.init||(f.begin=d(a(f.elem).get(0).style[e]||a(f.elem).css(e)),f.end=a.extend({},f.begin,d(f.end)),f.begin.color==b&&(f.begin.color=f.end.color||[0,0,0]),f.init=!0),f.elem.style[e]=c(f.begin,f.end,f.pos)}),a(function(){a("#pageFooter a").on("click",function(b){var c=""!=a(b.target).text()?a(b.target).text():a(b.target).attr("alt"),d="/footer/"+c.toLowerCase().replace(/ /g,"_").replace(/\./g,"");site.trigger.onEvent({title:"Footer "+c,uri:d,group:"Footer Buttons",subGroup:c})}),a("header[role='banner'] .site-nav__main a").add("header[role='banner'] .logo").on("click",function(b){var c=""!=a(b.target).text()?a(b.target).text():a(b.target).attr("alt"),d="/header/"+c.toLowerCase().replace(/ /g,"_").replace(/\./g,"");site.trigger.onEvent({title:"Header "+c,uri:d,group:"Header Buttons",subGroup:c})})})}(jQuery);var orderInColumnSelector="#js-myOrderPage",fullPageSelector="#js-pageFull";$.extend(!0,window.site,{data:{hash:{wait:!1,init:""},uiConfig:{AVAILABLE_LOCATIONS_ARRAY:[],AVAILABLE_LOCATIONS_HASH:{},AVAILABLE_PARTS_CLASS_ARRAY:[],AVAILABLE_WEIGHTS_ARRAY:[],AVAILABLE_WEIGHTS_HASH:{},AVAILABLE_FEEDSIZE_HASH:{},AVAILABLE_TITLETAGS:{},ADJUSTMENT_THRESHOLD:0},lastOrder:{},transactionRecords:[],tmpOrder:{},noCheeseUpSell:!1,ui:{hidePromoField:!1},noScroll:!1,ABData:{upsellAtHomepage:!1,upsellAtBasket:!1,savingsHeader:!1,productUpsellHeader:"",priceMyOrder:{},hideDippingCups:!1,keepMeSignedIn:{},specialtyChicken:{},showBuilder:!1,moveGOBYO:!1,newCouponWizard:!0,experience:"",youSaved:"",fiftyOffExperience:""},customerLoginOverlay:"pizzaProfileLoginOverlay",breakpoint:{previousBreakpoint:null,resizeTimer:null,handheldMaxSize:640},specialtyChickenCodes:["CKRGCBT","CKRGHTB","CKRGSJP","CKRGSBQ"],breadTwistsCodes:["B8PCPT","B8PCGT","B8PCCT"],deepLink:{wasDeepLinked:!1},OWtest:"",productDefaults:{S_BUILD:{DefaultToppings:"Xf=1"}}}}),require(["simplr","dpz.config","dpz.template","dpz.kiosk","site.funcs"],function(a,b,c){a.trigger.mSetEnvironment(envConfig),site.initPage||$.extend(!0,window.site,{initPage:function(){}}),require(["dpz.deepLink","dpz.history","siteViews"],function(a,d){window.dpz.config=window.dpz.config||b,window.dpz.template=window.dpz.template||c,window.dpz.history=window.dpz.history||d,$(function(){require(["dependencies"],function(){var c=dpz.market.activeLanguageCode,d="LTR";switch($("html").attr("lang",c),c){case"ar":d="RTL",$("html").attr("dir",d);break;default:$("html").attr("dir",d)}a.then(function(a){site.func.updateMinorNavigation(),site.func.setupExecuteURL();var c=window.location;site.data.deepLink=a,a.wasDeepLinked&&c.pathname!==a.pageRoute?a.doRedirect():(site.initPage(),$.when(site.data.hash.wait).then(function(){a.hashRoute?dpz.history.replaceWithHash(a.hashRoute):""!=c.hash||jsDPZ.util.empty(site.data.hash.init)?""===c.hash&&jsDPZ.util.empty(site.data.hash.init)||$(window).trigger("hashchange"):dpz.history.replaceWithHash(site.data.hash.init)})),$("#discountDashboard").is(":visible")&&site.func.positionDiscountDashboard(),site.data.uiConfig.AVAILABLE_LOCATIONS_HASH=b.getMarketProperty("pizzaBuilder").locationsHash,site.data.uiConfig.AVAILABLE_LOCATIONS_ARRAY=b.getMarketProperty("pizzaBuilder").locationsArray,site.data.uiConfig.AVAILABLE_PARTS_CLASS_ARRAY=b.getMarketProperty("pizzaBuilder").partsClassArray,site.data.uiConfig.AVAILABLE_WEIGHTS_HASH=b.getMarketProperty("pizzaBuilder").weightsHash,site.data.uiConfig.AVAILABLE_WEIGHTS_ARRAY=b.getMarketProperty("pizzaBuilder").weightsArray,site.data.uiConfig.AVAILABLE_FEEDSIZE_HASH=b.getMarketProperty("pizzaBuilder").feedSizeHash});var e=function(){var a=dpz.market.marketConfig.nationalMenu.dataDriven||"";if(a.enabled&&""===jsDPZ.app.catalog.getCatalog().data.NationalStoreID){var b=b=a[envConfig]||a.dev||a.allEnv;jsDPZ.app.catalog.getCatalog().setNationalStoreID(b)}};e(),jsDPZ.topic("catalog.set").subscribe(function(){e()})})}),site.breakpoint.startListener()}),$(document).on("click",".js-trackedClick",function(){$(document).trigger("trackedClick",$(this))}),$(document).on("click",".js-toggleLang",function(a){var b,c=dpz.util.getQueryParameters();a.preventDefault(),site.storage.remove("dpz_store_data"),c&&delete c.marketUrl,b={lang:$(this).attr("href")},-1!==window.location.href.indexOf("content.jsp")&&(b.m=dpz.market.marketCode+"/_"+dpz.market.inactiveLanguageCode),window.location.search=$.param($.extend({},c,b))}),a.validation.mAddCodes(b.getMarketProperty("errors")),site.data.messages={},$("ul.message-template li").each(function(){var a=$(this).attr("id").split("-")[1];site.data.messages[a]={},$(this).children().each(function(){site.data.messages[a][$(this).attr("data-role")]=$(this).text()})}).parent().remove(),site.func.generatePageSEO(),window.addEventListener&&(window.addEventListener("hashchange",site.func.hideOffCanvasPanels,!1),window.addEventListener("hashchange",site.func.generatePageSEO,!1)),$(document).on("/order/validate/ /order/variant/update/ /order/variant/delete/",function(){site.func.notifyCartUpdate()}),$(document).on("/order/variant/new/",function(){site.data.noScroll||site.func.animateScroll()}),$.validator.setDefaults({onfocusout:!1,groups:{birthDate:"Birth_Month Birth_Day",expirationDate:"Expiration_Month Expiration_Year"},invalidHandler:function(a,b){var c,d;for(c=0,d=b.errorList.length;c<d;c++)dpz.utag.fire.link(void 0,{event_name:$(b.errorList[c].element).attr("id"),event_action:"validation",event_category:"form",event_label:"error"})},errorPlacement:function(a,b){var c,d,e,f,g=b.prev(),h=[],i="grid__cell grid__cell--form-error label",j=!1;"Region"===b.attr("name")&&a.appendTo("input[name='Region']"),b.data("error-classes")?i+=" "+b.data("error-classes"):(b.attr("class")&&(c=b.is('[type="checkbox"], [type="radio"]')?b.parent().attr("class").split(/\s+/):b.attr("class").split(/\s+/),$.each(c,function(a,b){b.match(/grid__cell--/)&&(h.push(b),b.match(/--offset-/)&&(j=!0),b.match(/--custom-form-error--/)&&h.push(b.replace(/--custom-form-error--/,"--form-error--")))})),!j&&g.length&&g.attr("class")&&(c=b.prev().attr("class").split(/\s+/),$.each(c,function(a,b){b.match(/grid__cell--/)&&!b.match(/--offset-/)&&(d=b.split(/--/),e=d.length-1,f=b.split(/@/)[1],d[e]=d[e].split(/@/)[0],"1"===d[e]?d[e]=f?"offset-0@"+f:"offset-0":d[e]="offset-"+d[e]+(f?"@"+f:""),h.push(d.join("--")))}))),h.length&&(i+=" "+h.join(" ")),b.siblings("input, select").length>0?-1!==b.attr("class").indexOf("grid__cell")?a.appendTo(b.parent()).wrap("<div class='"+i+"'></div>"):a.appendTo(b.parent()):b.is('[type="radio"], [type="checkbox"]')?a.insertAfter(b.parent()).wrap("<div class='"+i+"'></div>"):-1!==b.attr("class").indexOf("grid__cell")?a.insertAfter(b).wrap("<div class='"+i+"'></div>"):(b.data("error-classes")&&a.addClass(b.data("error-classes")),a.insertAfter(b))}});var d=new RegExp(b.getMarketProperty("mask").phone.regex),e=new RegExp(b.getMarketProperty("mask").zip.regex);$.validator.addMethod("phone",function(a,b){return this.optional(b)||a.match(d)}),jQuery.validator.addMethod("postalcode",function(a,b){return this.optional(b)||a.match(e)}),$.validator.addMethod("expirationdate",function(a,b,c){return c}),$.validator.addMethod("uniqueAddress",function(a,b,c){var d=jsDPZ.app.customer.getCustomer().data.Addresses,e="Name";a=a.toLowerCase(),c="boolean"==typeof c?"":c.toLowerCase();for(var f=0,g=d.length;f<g;f++){var h=d[f][e].toLowerCase();if(h===a&&h!==c)return!1}return!0}),$.validator.addMethod("uniqueCard",function(a,b,c){var d=jsDPZ.app.customer.getCustomer().data.CreditCards,e="nickName";a=a.toLowerCase(),c="boolean"==typeof c?"":c.toLowerCase();for(var f=0,g=d.length;f<g;f++){var h=d[f][e].toLowerCase();if(h===a&&h!==c)return!1}return!0}),$.validator.addMethod("equalToCI",function(a,b,c){return a.toLowerCase()===c.toLowerCase()}),$.validator.addMethod("showOptional",function(a,b){return!0}),$.validator.addMethod("inactive",function(a,b){return!0}),$.validator.addMethod("persist",function(a,b){return!0}),$.validator.addMethod("dataCode",function(a,b,c){var d=$(b);return!d.data("error-code")||""===d.data("error-code")},function(a,b){return dpz.template.translate("errors."+$(b).data("error-code"))}),$.validator.updateDisplay=function(a){$(a).is("form")&&$("input, select",a).each(function(){var b=$(this).rules(),c=$("label[for='"+$(this).attr("name")+"']",a),d=$(this).closest(".form__control-group");0!==d.length&&(!0===b.required?($(c).removeClass("optional"),d.show()):!1===b.required?($(c).addClass("optional"),!0===b.showOptional?d.show():d.hide()):($(c).addClass("optional"),!1===b.showOptional?d.hide():d.show()))})},$.extend($.fn,{renderFields:function(a){function b(a){var b,c,d=a.closest(".form__control-group"),e=$('label[for="'+a.attr("name")+'"]',d),f=a.rules();f&&(f.required||f.showOptional)?(d.hasClass("is-hidden")?d.removeClass("is-hidden"):d.show(),e.toggleClass("optional",!f.required),f.inactive&&a.is(":visible")?(d.addClass("is-inactive"),a.hide().siblings(".hint").hide(),b="phone"===a.data("span-format")?site.format.phoneNumber({number:a.val()}):a.val(),killConfig.isMarketEnabled("staticPhonePrefix")&&"phoneprefix"===a.data("span-format")&&(b=a.attr("placeholder")),c=$("<span />").attr("data-name",a.attr("name")).text(b),a.after(c)):!1===f.inactive&&(a.show().siblings(".hint").show(),$('span[data-name="'+a.attr("name")+'"]',d).remove())):(d.hide(),a.is(":hidden")&&!f.persist&&(a.is("[type='radio']")?a.prop("checked",!1):a.is("[type='hidden']")||a.hasClass("js-clearOnRender")&&a.val("")))}return this.is("form")&&(a?$("input, select, textarea",this).each(function(){var a=$(this);setTimeout(function(){b(a)})}):$("input, select, textarea",this).each(function(){b($(this))})),this},focusClass:function(){return this.is("form")&&($("input, select",this).not("[type='checkbox'],[type='radio']").on("focus",function(){$(this).addClass("focus")}).on("blur",function(){$(this).removeClass("focus")}),$('input:not([type="radio"]):visible:first',this).focus(),$("select",this).not(".skip-first-opt-clear").each(function(){$("option:first",this).val("")})),this},serializeObject:function(){var a={},b=this.serializeArray();return $.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]="on"===this.value||(this.value||"")}),a}}),$.extend(!0,jsDPZ,{app:{nutritionalOrder:{}},config:{app:{LANGUAGE_CODE:dpz.market.activeLanguageCode,MAX_PAST_ITEMS:10},dataModel:{ADDITIONAL_PIZZA_CATEGORIES:[{Code:"Legend",Name:"Domino's American Legends&reg;"},{Code:"Feast",Name:"Feast Pizzas"},{Code:"BuildYourOwn",Name:"Build Your Own"}],CUSTOMER:{EmailOptIn:!0},DATE_FORMAT:"MM/DD/YYYY _h:mm a_p",ORDER_REQUEST:{SourceOrganizationURI:site.func.isHandheld()?"resp-order.dominos.com":"order.dominos.com"},ALLERGEN:{Name:"",Type:""},INGREDIENT:{Name:"",Ingredients:[],Allergens:[]},COMPOSITION:{NutritionalInfo:{GramWeight:"",Calories:"",Protein:"",Carbohydrates:"",DietaryFiber:"",TotalSugar:"",SaturatedFat:"",TransFat:"",Cholesterol:"",VitaminA:"",VitaminC:"",Calcium:"",Sodium:"",CaloriesFromFat:"",CalorieTotal:"",Iron:"",ServingSize:""},Ingredients:[]}}}})}),function(){var a=jsDPZ.app.customer.getCustomer().data.Session;a.ReturnUser||("true"===dpz.util.cookies.getItem("DPZUser")?a.ReturnUser=!dpz.util.cookies.getItem("DPZUserFirstVisit"):(dpz.util.cookies.setItem("DPZUser","true",{sDomain:"."+document.domain,vEnd:365}),dpz.util.cookies.setItem("DPZUserFirstVisit","true",{sDomain:"."+document.domain}),a.ReturnUser=!1))}(),killConfig.localData.googleAnalytics=!0,killConfig.localData.webtrendsAnalytics=!0,killConfig.localData.twitterFollow=!0,killConfig.localData.googlePlus=!0,killConfig.localData.facebookLike=!0,killConfig.localData.stJude=!1,killConfig.localData.webtrendsAnalytics=!0,killConfig.localData.mBox=!0,killConfig.localData.tealium=!0,killConfig.localData.driverTracker=!0,define("dpz.layout",function(){function a(a){var b={};return b.compiledFunc=a,b.assembleWith=function(a){var b="";return a instanceof Array?b=a.reduce(function(a,b){return a+this.compiledFunc(b)},b):b+=this.compiledFunc(a),b},b}var b={};return $.extend(b,{create:function(b){return new a(b)}}),b}),define("dpz.template",["simplr","handlebars.runtime","dpz.config","dpz.layout","dpz.JST","marketconfig/override.templates"],function(a,b,c,d,e,f){function g(a){var b,c=$.extend({url:"",target:""},a&&a.hash);return!c.target&&c.url?(b=document.createElement("a"),b.href=c.url,""===b.hostname||window.location.hostname===b.hostname?"":"_blank"):c.target}function h(a){return function(b,c){var d=jsDPZ.app.order.getOrder().data.Details.ServiceMethod;return c[a===(b===d)?"fn":"inverse"](this)}}function i(a){return function(b,c){return c[a===killConfig.isMarketEnabled(b)?"fn":"inverse"](this)}}function j(a){return function(b,c){return c[a===n.isTranslationStringEmpty(b)?"fn":"inverse"](this).replace(/^\s+$/,"")}}var k={},l=c.getMarketProperty("numbers"),m=c.getLanguageStrings(),n={};return b.registerHelper("t",function(a,c){return c.hash.untrusted?n.translate(a,c):new b.SafeString(n.translate(a,c))}),b.registerHelper("tt",function(a,c,d){return new b.SafeString(n.transformAndTranslate(a,c,d))}),b.registerHelper("market",function(a){return dpz.market[a]||""}),b.registerHelper("makeLink",function(a){return 0===a.indexOf("/")&&0!==a.indexOf("//")?urlConfig.root+a:a}),b.registerHelper("ifUseLinkTarget",function(a){var b=g(a);return b&&b.length>0?a.fn(this):a.inverse(this)}),b.registerHelper("chooseLinkTarget",function(a){return g(a)}),b.registerHelper("ifServiceMethod",h(!0)),b.registerHelper("unlessServiceMethod",h(!1)),b.registerHelper("ifKillSwitch",i(!0)),b.registerHelper("unlessKillSwitch",i(!1)),b.registerHelper("prt",function(a,c){var d=n.get(a)||n.get(a.toLowerCase()),e=null;return d?($.extend(!0,c.data.root,c.hash),e=new b.SafeString(d.compiledFunc(c.data.root?c.data.root:n.contextFixed))):jsDPZ.topic("hbs.partial.error").publish({error:"requested hbs not found",partial:a}),e}),b.registerHelper("ifStringEmpty",j(!1)),b.registerHelper("unlessStringEmpty",j(!0)),b.registerHelper("money",function(a){return n.translateMoney(a)}),b.registerHelper("unencode",function(a){return jsDPZ.util.htmlUnEncode(a)}),b.registerHelper("breaklines",function(a){return a=b.Utils.escapeExpression(a),a=a.replace(/(\r\n|\n|\r)/gm,"<br>"),new b.SafeString(a)}),$.extend(n,{get:function(a){return k[a]||(k[a]=d.create(n.getJST(a))),"function"==typeof k[a].compiledFunc&&k[a]},getJST:function(a){return f&&f[a]||e&&e[a]},isTemplateObj:function(a){return a&&"object"===(void 0===a?"undefined":_typeof(a))&&a.component&&a.tokens},transformAndTranslate:function(a,b,c){return n.translate([a,b.split(/\W+/).join("_").toLowerCase()].join("."),c)},translate:function(a,b){try{return m[a](b&&b.data&&b.data.root||b||{})}catch(b){DEBUG&&console.log('DEBUG : TEMPLATES : TRANSLATE ERROR "'+a+'".',b.message,b.stack)}return DEBUG&&'<span style="text-shadow: 1px 1px 1px purple; color: limegreen; font-weight: bold">Translation Missing:'+a+"</span>"||a},isTranslationStringEmpty:function(a){try{return 0!==m[a]().length}catch(b){DEBUG&&console.log('DEBUG : TEMPLATES : TRANSLATE ERROR "'+a+'".',b.message,b.stack)}},setValidator:function(a){var b,d=c.getMarketProperty("errorsValidator");for(b in d)a.messages[b]=d[b]},translateError:function(a,b){var c,d,e=dpz.template.contextFixed,f="errors."+a;if(b=$.isArray(b)?b:[b],m[f]){for(d=0,c=b.length;d<c;d++)e["val"+(d+1)]=b[d];return n.translate(f,e)}return a},translateMoney:function(a){return"Free"===a?n.translate("confirmation.free"):n.formatMoney(a,l)},formatMoney:function(a,b){var c,d,e,f,g,h,i,j,k=null;return a&&(a=parseFloat(a.toString().replace(",","")),c=b.currency_symbol||"$",b.money_digits_after_decimal=Math.abs(b.money_digits_after_decimal),d=isNaN(b.money_digits_after_decimal)?2:b.money_digits_after_decimal,e=b.decimal_separator||".",f=b.thousands_separator||",",g=a<0?"-":"",h=isNaN(a)?NaN:parseInt(a=Math.abs(+a||0).toFixed(d),10)+"",i=h.length>3?h.length%3:0,isNaN(a)?k="":(j=(i?h.substr(0,i)+f:"")+h.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+f)+(d?e+Math.abs(a-h).toFixed(d).slice(2):""),b.currency_symbol_right?j+=c:j=c+j,k=g+j)),k},countryPhoneCode:function(a){var b=dpz.config.getMarketProperty("mask"),c=b.phoneMultipleMask,d=c[a]||b.phone,e=d.regex,f=new RegExp(e);return $.validator.addMethod("phone",function(a,b){return this.optional(b)||a.match(f)}),d},contextFixed:{ctx:urlConfig.root,assets_ctx:urlConfig.assets,market_assets_ctx:dpz.market.directory,primary_market_assets_ctx:dpz.market.primaryDirectory},assembleLayout:function(b){return a.layout.mAssembleLayout(b,this)}}),n.setValidator($.validator),n}),define("dpz.dom",function(){var a="body",b={},c={};return{$inputs:function(a){if(b[a])return b[a];throw new Error('Invalid input name "'+a+'".  Please check dpz.dom')},$labels:function(a){if(c[a])return c[a];throw new Error('Invalid label name "'+a+'".  Please check dpz.dom')},set$labels:function(b){a=b||a,c={StreetNumber:$('label[for="StreetNumber"] span',a),Property_Number:$('label[for="PropertyNumber"] span',a),Unit_Number:$('label[for="UnitNumber"] span',a),Address_Line_2:$('label[for="Address_Line_2"] span',a),Street_Field_1:$('label[for="StreetField1"] span',a),Street_Field_2:$('label[for="StreetField2"] span',a),Location_Name:$('label[for="Location_Name"] span',a),StreetName:$('label[for="StreetName"] span',a),Location_Name_first_option:$("#Location_Name option:first-of-type",a),BuildingID:$('label[for="BuildingID"] span',a),Note:$('label[for="Note"] span',a)}},set$inputs:function(c){a=c||a,b={address:$(".js-address",a),addressType:$("[name='Address_Type_Select']",a),addressTypeLabels:$(".js-changeAddressType label",a),addressSelection:$(".js-addressSelection",a),formattedAddress:$(".js-formattedAddress",a),streetName:$(".js-streetName",a),streetNumber:$(".js-streetNumber",a),postalCode:$(".js-postalCode",a),city:$(".js-city",a),sector:$(".js-neighborhood",a),neighborhood:$(".js-neighborhood",a),neighborhoodSelect:$(".js-neighborhood-select",a),neighborhoodToggle:$(".js-neighborhood-toggle",a),streetRange:$(".js-streetRange",a),category:$(".js-category",a),locationName:$(".js-locationName",a),locationNameSelect:$(".js-locationName-select",a),locationNameToggle:$(".js-locationName-toggle",a),addressLine2:$(".js-addressLine2",a),region:$(".js-region",a),campusRegion:$(".js-campusRegion",a),campusCampus:$(".js-campusCampus",a),campusDorm:$(".js-campusDorm",a),streetField1:$(".js-streetField1",a),streetField2:$(".js-streetField2",a),streetField3:$(".js-streetField3",a),streetField4:$(".js-streetField4",a),unitType:$(".js-unitType",a),unitNumber:$(".js-unitNumber",a),propertyType:$(".js-propertyType",a),propertyNumber:$(".js-propertyNumber",a),deliveryInstructions:$(".js-deliveryInstructions",a),hospitalName:$(".js-hospitalName",a)}}}}),define("adobeTarget",["dpz.config","dpz.customer"],function(){return{load:function(a,b,c,d){var e,f,g,h,i,j=jsDPZ.app.customer.getCustomer().data.Session,k=function(a){var b=a||{},c=b.market||"us",d=b.lang||"en";return dpz.market.marketCode.toLowerCase()===c.toLowerCase()&&dpz.market.activeLanguageCode.toLowerCase()===d.toLowerCase()}(d);(function(){return!(navigator.appVersion.indexOf("MSIE")>-1)||parseFloat(navigator.appVersion.split("MSIE")[1])>=10})()&&!dpz.kiosk.isActive&&killConfig.isMarketEnabled("mBox")&&k?(e=$.Deferred(function(b){"undefined"!=typeof adobe?adobe.target.getOffer({mbox:a,params:this.includeDefaultData(),success:function(a){var c;try{f=a.find(function(a){return"setContent"===a.action}),f=f&&f.content.includes("<script")?JSON.parse(f.content.slice(0,f.content.indexOf("<script"))):f?JSON.parse(f.content):{},f.testGroup&&(h=j.tnt=j.tnt||{},h.testGroups=h.testGroups||[],~$.inArray(f.testGroup,h.testGroups)||h.testGroups.push(f.testGroup),dpz.util.getQueryParameters("abtest")&&-1===envConfig.indexOf("-prod")&&(j.forcedExperiences=dpz.util.getQueryParameters("abtest")),j.forcedExperiences&&(c=j.forcedExperiences.split(",").find(function(a){return f.testExperiences&&f.testExperiences.includes(a)}),f.experience=c||f.experience),site.sessionTools.save().then(function(){dpz.utag.updateAbTest(),dpz.utag.fire.link(void 0,{event_name:"test_side_selected",event_action:"validation",event_category:"abtest",event_label:"abtest"})})),b.resolve(f)}catch(a){b.resolve({error:a})}},error:function(a){function b(b,c){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a,c){b.resolve({error:c})}),timeout:1e3}):b.resolve({error:""})}.bind(this)),g=$.Deferred(function(c){b(["abtests/"+a],function(a){c.resolve(a)})}),i=function(b,c){this.trackEvent(a,b,c)}.bind(this),$.when(e,g).then(function(a,b){var d=$.extend({inTest:!!a.testGroup,trackEvent:i,inExperience:function(b){var c=$.makeArray(b||this.validExperiences);return this.inTest&&c.length?c.includes(a.experience):this.inTest&&a.experience&&"control"!==a.experience}},b,a);c(d)})):c({inTest:!1,fullyExcluded:!0,inExperience:function(){return!1}})},trackEvent:function(a,b,c){var d={mbox:a,params:this.includeDefaultData(c)};b&&(d.event=b),b&&b.orderTotal&&b.orderId&&b.productPurchasedId&&(d.params.orderTotal=b.orderTotal,d.params.orderId=b.orderId,d.params.productPurchasedId=b.productPurchasedId),"undefined"!=typeof adobe&&adobe.target.trackEvent(d)},includeDefaultData:function(a){return $.extend({},a,{abtest:site.func.abtest.getParam(),environment:location.hostname.split(".dominos")[0],loggedin:dpz.customer.getStatus(),returnuser:window.utag_data&&window.utag_data.return_user||"",storeid:jsDPZ.app.order.getOrder().data.Details.StoreID,hascoupon:!!jsDPZ.app.order.getOrder().data.Details.Coupons.length,isGroupOrder:site.func.isGroupOrdering(),serviceMethod:jsDPZ.app.order.getOrder().data.Details.ServiceMethod,activeMarket:dpz.market.activeLanguageCode+"_"+dpz.market.marketCode})}}}),define("dpz.stjude",["simplr"],function(a){var b=function(b,c,d){return d(c).on("confirmationPage.load",function(){dpz.stjude.updateTrackerTileEligibility()}),d(c).on("trackerLookup.load",function(a,b){dpz.stjude.updateTrackerLookupPageTileEligibility(b)}),{config:{openFieldABExperience:"",trackerTiles:{thankYou:!1,notTooLate:!0},productCodes:["STJUDE","STJUDE1","STJUDE2","STJUDE5","STJUDE10"],couponCodes:["9186"]},stjudeIsActive:function(){return killConfig.isMarketEnabled("stJude")},stjudeUpsellIsActive:function(){return!!this.stjudeIsActive()&&killConfig.isMarketEnabled("stJudeUpsell")},deleteStJudeRoundUpVariantFromCart:function(){var b=jsDPZ.app.order.getOrder().data.Details.Variants.filter(function(a){return"STJUDERU"===a.Code});b.length>0&&d.isNumeric(b[0].ID)&&a.controller.mRouteAndExecute("/order/variant/"+b[0].ID+"/delete")},donationInCart:function(){if(site.func.isTrackerPage()){var a=RealtimeProxy.Data.Orders[0];return["stjude","st. jude"].filter(function(b){return~a.OrderDescription.toLowerCase().indexOf(b)}).length>0}return(site.isConfirmationPage?site.data.lastOrder.Details:jsDPZ.app.order.getOrder().data.Details).Variants.some(function(a){return~a.Code.indexOf("STJUDE")})},roundUpInCart:function(){return(site.isConfirmationPage?site.data.lastOrder.Details:jsDPZ.app.order.getOrder().data.Details).Variants.some(function(a){return~a.Code.indexOf("STJUDERU")})},couponInCart:function(a){return jsDPZ.app.order.getOrder().data.Details.Coupons.filter(function(b){return b.Code===a}).length>0},renderRoundUp2016:function(){var b=this.roundUpTotal(),c=this.roundUpTotalAsCents();!this.donationInCart()&&this.roundUpDonationEligible()&&0!==b&&jsDPZ.app.catalog.getCatalog().getVariant("STJUDERU").data&&(a.view.mRender({name:"stJudeRoundUp",data:{stJudeRoundupAmount:c},selector:".st-jude-roundup__ledger__td"}),d(".js-orderSummaryTable").addClass("st-jude-roundup"),d(".st-jude-roundup__ledger").removeClass("is-hidden").addClass("st-jude-roundup--button"))},roundUpTotal:function(){var a=jsDPZ.app.order.getOrder().data.Details.Amounts&&jsDPZ.app.order.getOrder().data.Details.Amounts.Customer,b=0;if(a){var c=jsDPZ.obj.price(a).data;b=(Math.ceil(c)-c).toFixed(2)}return b.toString()},roundUpTotalAsCents:function(a){var b=a&&a.split(".")||this.roundUpTotal().split(".");return b.length>1?b[1]:b[0]},roundUpDonationEligible:function(a){return(a=a||this.roundUpTotal())>0},updateTrackerTileEligibility:function(){for(var a=site.data.lastOrder.Details.Promotions.Experiences||[],b=0,c=a.length;b<c;b++)"ContainsStJudeDonation"===a[b].Code&&(this.config.trackerTiles.thankYou=!0,this.config.trackerTiles.notTooLate=!1)},updateTrackerLookupPageTileEligibility:function(a){a.Order.OrderDescription.indexOf("St. Jude")>-1&&(this.config.trackerTiles.thankYou=!0,this.config.trackerTiles.notTooLate=!1)},getStats:function(){function a(b){function c(a,b){g[a]?(g[a].constructor!=Array&&(g[a]=[g[a]]),g[a][g[a].length]=b):g[a]=b}var e,f,g={};for(e=0;f=b.attributes[e];e++)c(f.name,f.value);for(e=0;f=b.childNodes[e];e++)1==f.nodeType&&(1==f.childNodes.length&&3==f.firstChild.nodeType?c(f.nodeName,f.firstChild.nodeValue):c(f.nodeName,a(f)));return d.isEmptyObject(g)?void 0:g}var b=d.Deferred();return d.ajax({url:"https://cache.dominos.com/stjude/2017/StJudeDonations.xml",cache:!1}).done(function(c){try{b.resolve(a(c.childNodes[0]))}catch(a){b.resolve(a)}}).fail(function(a){b.resolve(a)}),b.promise()},injectThermometer:function(a){var b,c,e,f,g;if(d(".js-stjude-thermometer").length>0){if(b=75e5,c=0,e=a.StJudeStatistics){var h=Math.round(+e.TOTALRAISED)||0;c=Math.round(h/b*100)}f=Math.min(95,c),g=dpz.template.assembleLayout({component:"stJudeThermometer",tokens:{percentage:f}}),d(".js-stjude-thermometer").append(g),d(".js-st-jude-status-progress-bar").animate({width:f+"%"},2e3)}},renameStJudeDonations:function(a){return"STJUDE2"===a.code&&(a.name="$2 St. Jude Donation"),"STJUDE5"===a.code&&(a.name="$5 St. Jude Donation"),"STJUDE10"===a.code&&(a.name="$10 St. Jude Donation"),"STJUDE"===a.code&&(a.name="$1 St. Jude Donation"),a},renameStJudeDonationsUsingURL:function(a,b){return a.indexOf("STJUDE2")>=0?b="$2 St. Jude Donation":a.indexOf("STJUDE5")>=0?b="$5 St. Jude Donation":a.indexOf("STJUDE10")>=0?b="$10 St. Jude Donation":a.indexOf("STJUDE")>=0&&(b="$1 St. Jude Donation"),b},hasSubscriptionRoundUp:function(){return this.stjudeIsActive()&&killConfig.isMarketEnabled("stJudeSubscription")&&jsDPZ.app.customer.getCustomer().data.StJudeRoundUp&&jsDPZ.app.catalog.getCatalog().data.Variants.STJUDERU},subscriptionRoundUp:function(){var b=this;return d.Deferred(function(e){b.hasSubscriptionRoundUp()&&a.controller.mData().Commands.order_variant_new&&!dpz.stjude.donationInCart()&&!jsDPZ.app.customer.getCustomer().data.Session.removedStJudeAutoRoundUp?(site.data.stJudeRoundUpSuppressToggle=!0,d(c).one("/order/validate/complete /order/price/complete",function(){jsDPZ.app.customer.getCustomer().data.Session.At821Experience&&delete jsDPZ.app.customer.getCustomer().data.Session.At821Experience,e.resolve(),b.roundUpInCart()&&dpz.utag.fire.link(void 0,{event_name:"St. Jude Round Up Opt In",event_category:"abtest",event_action:"validation",event_label:"abtest"})}),stjude.couponInCart("SJRD")||jsDPZ.app.order.getOrder().data.Details.Coupons.push(d.extend({},jsDPZ.config.dataModel.ORDER_COUPON,{Code:"SJRD",Qty:1})),a.controller.mRouteAndExecute("/order/variant/new?code=STJUDERU&amount=0")):e.reject()})},isSubscriptionRoundUpProduct:function(a){var b=this.stjudeIsActive()&&jsDPZ.app.customer.getCustomer().data.StJudeRoundUp&&"STJUDERU"===a.Code;return b&&!jsDPZ.app.customer.getCustomer().data.Session.stJudeAutoRoundUpIsZero&&0===a.Price?(jsDPZ.app.customer.getCustomer().data.Session.stJudeAutoRoundUpIsZero=!0,site.sessionTools.save(),dpz.utag.fire.link(void 0,{event_name:"0.00 St. Jude Donation",event_category:"abtest",event_action:"change",event_label:"abtest"}),b):b},roundUpOptInOut:function(){var a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=_extends({},jsDPZ.obj.customer(jsDPZ.app.customer.getCustomer().getCustomerForPower()).data,{StJudeRoundUp:a});return d.Deferred(function(a){function e(){site.func.saveAccountData({data:b,success:function(b){a.resolve(b)},error:function(){a.reject()}})}site.func.customerSemiLoggedIn()?(site.func.showLoginPopup(),d(c).on("customerLogin.success",function(){e()})):site.func.customerLoggedIn()?e():a.resolve()})}}}(window,document,$);return window.stjude=dpz.stjude=b,b}),require(["simplr"],function(a){var b,c={signinURL:"#/checkout/info/",activateURL:"#/rewards/activate/",dashboardURL:"#/customer/rewards/",warningWindowBase:30,history:{pageIndex:1,pageSize:2e3,previewSize:10,separatePending:!0,hideLoading:!0,translations:{ADJUSTMENT:"customer.loyalty_activity_adjustment",BONUS:"customer.loyalty_activity_bonus",EXPIRATION:"customer.loyalty_activity_expired",NON_QUALIFYING_ORDER:"customer.loyalty_activity_non_qualifying",QUALIFYING_ORDER:"customer.loyalty_activity_qualifying",REDEMPTION:"customer.loyalty_activity_redemption",POINTS_RETURNED:"customer.loyalty_activity_returned"}},loyaltyIsOk:!0,enrollmentBonusConfig:{show:!1,bonusPoints:10,bonusTotalNeeds:10},defaultBase:{pointsPerOrder:10,totalNeeded:10,rewardPoints:60,rewardString:"customer.loyalty_reward_2m2t"},commands:{enroll:"LOYALTY_ENROLL",optOut:"LOYALTY_OPT_OUT",redeem:"LOYALTY_REDEEM",dashboard:"LOYALTY_VIEW_DASHBOARD",claimRewards:"CLAIM_REWARDS"},animation:{animate:!0,animateAllNewPizzas:!1,cache:"general",cachePrefix:"dpz_loyalty_",updateCache:function(){return!0}},widgetRulesSkeleton:{animation:{},data:{balance:{checkout:!1,useFullTitle:function(){return!1},showFullPoints:function(){return dpz.loyalty.animateWidgets("big")&&(1===dpz.loyalty.getPizzaCount()||dpz.loyalty.config.animation.animateAllNewPizzas)},hideAfterAnimation:function(){return!1}},pizzaCounter:{},redemption:{keepCoupons:!1,hideRedemption:function(){return!1}},points:{showTotalPoints:function(){return!0},showNextRewardPoints:function(){return!1},showPendingPoints:function(){return!0}},alerts:{showWarning:!0}},display:{balance:function(){return!0},pizzaCounter:function(){return!0},redemption:function(){return!0},points:function(){return!0},alerts:function(){return!0}},redirectToRewards:{balance:!0,pizzaCounter:!0,redemption:!1,points:!0,alerts:!0},parentSelector:""}},d=function(){return killConfig.isMarketEnabled("loyalty")},e=function(){var a=jsDPZ.app.customer.getCustomer().data;return!!this.loyaltyIsActive()&&(this.config.loyaltyIsOk&&void 0!==a.Session.loyaltyIsOk?a.Session.loyaltyIsOk:this.config.loyaltyIsOk)},f=function(){return jsDPZ.app.customer.getCustomer().isLoyaltyCustomer()},g=function(){return this.loyaltyIsOk()&&!this.isEnrolled()&&this.store.isParticipating()},h=function(){return this.loyaltyIsOk()&&site.func.customerLoggedIn()&&!f()&&this.store.isParticipating()||!site.func.customerLoggedIn()&&this.store.isParticipating()},i={storeSelectionChanged:!1,isParticipating:function(){return jsDPZ.app.store.getStore().data.Pop}},j=function(a){var b,d=site.func.customerLoggedIn(),e=site.func.customerSemiLoggedIn();a&&(jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect=a,site.sessionTools.save()),b=jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect,!d&&!e||!this.store.isParticipating()||f||site.isPaymentPage?d||e?(d||e)&&dpz.loyalty.isEnrolled()&&(b=jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect,jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect="",site.sessionTools.save()):b=c.signinURL:b=c.activateURL,"#"===b[0]?window.location.hash=b:window.location=b},k=function(){return jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect&&""!==jsDPZ.app.customer.getCustomer().data.Session.LoyaltyRedirect},l=function(a){var b,c=a||this.getBaseCoupon().CouponCode,d=jsDPZ.app.customer.getCustomer().data.Loyalty.LoyaltyCoupons;return this.loyaltyIsOk()&&this.isEnrolled()&&d&&(b=d.find(function(a){return a.CouponCode===c}))?b.PointValue||0:0},m=function(){var a={BalancePoints:0,PendingPoints:0,RemainderPoints:0,HasEarnedNewPizza:!1},b=this.getBasePoints();return a.Potential=jsDPZ.app.order.getOrder().data.Details.Loyalty.Potential,a.BalancePoints=jsDPZ.app.customer.getCustomer().data.Loyalty.VestedPointBalance-a.Potential.Burn.RedemptionPoints,a.PendingPoints=jsDPZ.app.customer.getCustomer().data.Loyalty.PendingPointBalance,a.RemainderPoints=b>0?(jsDPZ.app.customer.getCustomer().data.Loyalty.VestedPointBalance-a.Potential.Burn.RedemptionPoints)%b:0,a.HasEarnedNewPizza=0===a.RemainderPoints&&a.BalancePoints>0,a},n=function(){var a=this.getBasePoints(),b={FloorPoints:0,CeilingPoints:0,BasePoints:a},c=this.getPizzaCount(this.getCustomerPoints());return b.FloorPoints=c*a,b.CeilingPoints=(c+1)*a,b},o=function(a){var b=a?a.BalancePoints:this.getCustomerPoints().BalancePoints,c=this.getBasePoints();return b<0&&(b=0),c>0?Math.floor(b/c):0},p=function(){var a=this.getCustomerPoints(),b=a.BalancePoints,c=this.getPizzaCount(a),d=this.getBasePoints(),e=0;return d>0&&(e=a.HasEarnedNewPizza?1:(b-c*d)/d),e},q=function(){var a=this.getRawPercentage();return 100*a+"%"},r=function(){var a=this.getRawPercentage();return 100*a-6+"%"},s=function(){var a,b,c;return!(!this.isEnrolled()||(a=moment(moment().format("YYYY-MM-DD"),"YYYY-MM-DD"),b=moment(jsDPZ.app.customer.getCustomer().data.Loyalty.BasePointExpirationDate,"YYYY-MM-DD"),!b.isValid()))&&(c=moment(a).add(this.config.warningWindowBase,"days"),c.isSame(b)||c.isAfter(b)&&(b.isAfter(a)||b.isSame(a)))},t=function(a){var b;return void 0!==a&&null!==a&&""!==a?(b=a.toUpperCase(),this.config.history.translations[b]?this.config.history.translations[b]:a.replace("-"," ")):"&nbsp"},u=function(a){var b="",c="",d=a.Description.includes("${Points}");if(d){var e=a.Description.split("${Points}");b=e[0].trim(),c=e[1].trim()}return _extends({},a,{description1:b,description2:c,dynamicDescription:d})},v=function(a){var b=a&&a.pageIndex?a.pageIndex:this.config.history.pageIndex,c=a&&a.separatePending?a.separatePending:this.config.history.separatePending,d=a&&a.successCallback?a.successCallback:function(){},e=a&&a.errorCallback?a.errorCallback:function(){};this.loyaltyIsActive()&&this.loyaltyIsOk()&&this.isEnrolled()?jsDPZ.ajax.fetchLoyaltyHistory({pageIndex:b,pageSize:this.config.history.pageSize,useCache:!1,success:function(a){var b={completedHistory:[],pendingHistory:[],fullHistory:(a.History||[]).map(function(a){return $.extend(!0,{},a,{TransactionDate:moment(a.TransactionDate).format("MM/DD/YY")})})},f=function(a){var b=$.extend({Description:"",OrderNumber:"",Points:"",PointBalance:"",PointStatus:"",TransactionDate:"",TransactionType:"",TransactionTotal:null,translateText:"",displayCustomerService:!1,showBalance:!0,rowClass:"",fullRowDescription:!1},a,{Points:a.Points||0,PointBalance:a.PointBalance||0});return b=u(b),b.activityClass="loyalty-history--cell--"+b.TransactionType.toLowerCase().replace(new RegExp(" ","g"),"-").replace(new RegExp("_","g"),"-"),b.pointStatusClass="loyalty-history--cell--"+b.PointStatus.toLowerCase(),b.translateText=dpz.loyalty.getActivityString(b.TransactionType),b.displayCustomerService="Expiration"===b.TransactionType,b.showTotal=b.TransactionTotal&&"0"!==b.TransactionTotal,b.fullRowDescription="Expiration"===b.TransactionType||"Customer Care"===b.TransactionType,b};"Fail"!==a.Status?(c&&$.extend(!0,b,{pendingHistory:b.fullHistory.filter(function(a){return"PENDING"===a.PointStatus}).map(function(a){return $.extend(f(a),{showBalance:!1})}),completedHistory:b.fullHistory.filter(function(a){return"PENDING"!==a.PointStatus}).map(function(a,b){var c=b<dpz.loyalty.config.history.previewSize;return $.extend(f(a),{rowClass:c?a.rowClass:a.rowClass+" is-hidden"})})}),d(b)):e()},error:function(){e()},complete:function(){site.func.toggleLoading(!1,{},{})}}):this.loyaltyIsOk()||e()},w=function(a){this.config.widgetRules=$.extend(!0,{},this.config.widgetRulesSkeleton,{animation:this.config.animation},{animation:{updateCache:function(){return!site.func.isHandheld()}}},a)},x=function(a){return $.extend(!0,this.config.widgetRulesSkeleton,{animation:{cache:"small"},data:{balance:{useFullTitle:function(){return site.func.isHandheld()},hideAfterAnimation:function(){return dpz.loyalty.getCustomerPoints().HasEarnedNewPizza},showFullPoints:function(){return dpz.loyalty.animateWidgets("small")&&(1===dpz.loyalty.getPizzaCount()||dpz.loyalty.config.animation.animateAllNewPizzas)}},redemption:{keepCoupons:!0,hideRedemption:function(){return site.func.isHandheld()}},points:{showTotalPoints:function(){return!1},showNextRewardPoints:function(){return dpz.loyalty.getCustomerPoints().BalancePoints>=60}},alerts:{showWarning:!1}},display:{balance:function(){var a=dpz.loyalty.getCustomerPoints();return a.BalancePoints<60||dpz.loyalty.animateWidgets("small")&&60===a.BalancePoints},pizzaCounter:function(){var a=dpz.loyalty.getCustomerPoints().BalancePoints;return a>60||60===a&&!dpz.loyalty.animateWidgets("small")},redemption:function(){var a=dpz.loyalty.getCustomerPoints().BalancePoints;return a>60||60===a&&!dpz.loyalty.animateWidgets("small")},points:function(){return!(site.func.isHandheld()&&dpz.loyalty.getCustomerPoints().BalancePoints>60)}}},a)},y=function(a){var c=this.config.animation.animate,d=jsDPZ.app.customer.getCustomer().data,e=this.getCustomerPoints(),f=this.getPizzaCount();return c&&(void 0===d.Session.WidgetAnimation&&(d.WidgetAnimation={}),b=this.config.animation.cachePrefix+a,c=!1!==d.Session.WidgetAnimation[b]&&site.func.hasCanvasSupport()&&(f<=1||e.RemainderPoints>0||this.config.animation.animateAllNewPizzas)),c},z=function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=$.extend({keepCoupons:!1},c),t=jsDPZ.app.customer.getCustomer().data;!c&&this.config.widgetRules||this.setWidgetRules($.extend({},c)),e=this.config.widgetRules,this.isEnrolled()&&(g=e.parentSelector,y=this.config.animation.animate,g=e.parentSelector,j=g+" .loyalty--widget-container--balance",k=g+" .loyalty--widget-container--pizza-counter",m=g+" .loyalty--widget-container--points",l=g+" .loyalty--widget-container--redemption",$(l).length>=2&&(l=site.func.isHandheld()?g+" .loyalty--widget-container--redemption--handheld":g+" .loyalty--widget-container--redemption--desktop"),n=g+" .loyalty--widget-container--alerts",dpz.util.isEmpty(t.Session.WidgetAnimation)&&(t.Session.WidgetAnimation={}),$.extend(this.config.animation,s.animation),f=d&&d.forceAnimation||dpz.loyalty.animateWidgets(this.config.animation.cache),b=this.config.animation.cachePrefix+this.config.animation.cache,o=f&&this.getCustomerPoints().HasEarnedNewPizza,h=$(j).data("widget-modifier"),i=$(k).data("widget-modifier"),site.func.isHandheld()&&(h=$(j).data("widget-handheld-modifier"),i=$(k).data("widget-handheld-modifier")),a.view.mRender({name:"loyalty_widget_balance",data:$.extend({},e.data.balance,{animate:f,newPizzaAnimation:this.config.animation.animateAllNewPizzas,modifierClass:h}),selector:j}),a.view.mRender({name:"loyalty_widget_pizza_counter",data:$.extend({},e.data.pizzaCounter,{willBeAnimated:o,modifierClass:i}),selector:k}),a.view.mRender({name:"loyalty_widget_points",data:$.extend({},e.data.points),selector:m}),a.view.mRender({name:"loyalty_widget_redemption",data:$.extend({},e.data.redemption,{willBeAnimated:o}),selector:l}),a.view.mRender({name:"loyalty_widget_alerts",data:$.extend({},e.data.alerts),selector:n}),q=this.loyaltyIsOk(),q&&e.display.balance()?$(j).show():$(j).hide(),q&&e.display.pizzaCounter()?$(k).show():$(k).hide(),q&&e.display.points()?$(m).show():$(m).hide(),q&&e.display.redemption()?$(l).show():$(l).hide(),q&&this.canRedeem()&&d&&d.animateButton&&$(l).addClass("small-scale-hidden"),e.display.alerts()||!q?$(n).show():$(n).hide(),~l.indexOf("handheld")?$(g+" .loyalty--widget-container--redemption--desktop").hide():~l.indexOf("desktop")&&$(g+" .loyalty--widget-container--redemption--handheld").hide(),site.func.hasCanvasSupport()||$(j+", "+k).addClass("widget__fallback"),$(j+", "+k+", "+m+", "+l+", "+n).off("click.redirectToRewards"),this.loyaltyIsOk()&&(p=[],e.redirectToRewards.balance&&p.push(j),e.redirectToRewards.pizzaCounter&&p.push(k),e.redirectToRewards.redemption&&p.push(l),e.redirectToRewards.points&&p.push(m),e.redirectToRewards.alerts&&p.push(n),$(p.join(",")).on("click.redirectToRewards",function(a){a.preventDefault(),dpz.loyalty.redirectToRewards()})),s.showInfo&&(r=s.showInfo.pageName?s.showInfo.pageName:"",$(".loyalty-icon-info").off("click.loyaltyWidget").on("click.loyaltyWidget",function(){var a=r||utag.data.page_name,b=$.extend(!0,{title:"LoyaltyWidget "+a,group:"Loyalty Widget",subGroup:a+" Show Info",uri:"LoyaltyWidget/"+a+"/ShowInfo"},s.showInfo.webTrendEvent);site.trigger.onEvent(b),$.isFunction(s.showInfo.callback)&&s.showInfo.callback()})),q&&this.canRedeem()&&d&&d.animateButton&&setTimeout(function(){$(l).toggleClass("small-scale-hidden full-scale"),$(l).one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){$(this).removeClass("full-scale")})},500),0!==$(".js-loyalty-widgets-container").length&&"none"===!$(".js-loyalty-widgets-container").css("display")||!e.animation.updateCache()||(t.Session.WidgetAnimation[b]=!1),site.sessionTools.save())},A=function(a){var b=this.config.widgetRules,c=b.parentSelector,d=c+" .loyalty--widget-container--balance",e=c+" .loyalty--widget-container--pizza-counter",f=c+" .loyalty--widget-container--points",g=c+" .loyalty--widget-container--redemption",h=$(g).find(".js-loyaltyRedeem"),i=function(){$(e).find(".js-pizzasEarnedAnimOverlay").animate({width:"100%",height:"100%"},{queue:!1,duration:300,complete:function(){$(e).find(".js-pizzasEarnedAnimOverlay").hide()}}),$(e).find(".js-oldPizzasEarned").animate({top:"-100%"},{queue:!1}),$(e).find(".js-newPizzasEarned").animate({top:"50%"},{queue:!1,complete:function(){a&&(h.removeClass("inactive"),$(g).fadeIn())}})};$(g).length>=2&&(g=site.func.isHandheld()?c+" .loyalty--widget-container--redemption--handheld":c+" .loyalty--widget-container--redemption--desktop"),a?$(d).fadeOut({complete:function(){$(e).fadeIn({complete:function(){i()}}),$(f).show(),h.removeClass("inactive"),$(g).show()}}):(i(),dpz.loyalty.canRedeem()&&h.toggle({effect:"scale",duration:100,queue:!1,complete:function(){h.removeClass("inactive").toggle({effect:"scale",duration:200})}}))},B=function(a){var b,c,d,e,f,g,h,i=a||this.getBaseCoupon().CouponCode,j=jsDPZ.app.store.getStore().data.StoreID,k=this.store.isParticipating()||""===j,l=jsDPZ.app.customer.getCustomer().data.Loyalty.AccountStatus;return!(!this.isEnrolled()||"SUSPENDED"===l||""===i||!k)&&(b=this.getPizzaCount(),c=jsDPZ.app.order.getOrder().data,d=c.Details.Coupons,b>0&&(!((e=d.reduce(function(a,b){return b.Code===i?a+b.Qty:a},0))>0)||((f=jsDPZ.app.catalog.getCatalog().getCoupon(i))&&f.data?(h=f.data.Tags.LimitPerOrder?parseInt(f.data.Tags.LimitPerOrder,10):1,jsDPZ.app.catalog.isCouponActive(i).Success&&e<h):(g=jsDPZ.app.customer.getCustomer().data.Loyalty.LoyaltyCoupons,!!(f=g.find(function(a){return a.CouponCode===i}))&&(h=f.LimitPerOrder?f.LimitPerOrder:1,e<h)))))},C=function(){var a={CouponCode:"",PointValue:0,BaseCoupon:!1},b=jsDPZ.app.customer.getCustomer().data.Loyalty.LoyaltyCoupons;return this.loyaltyIsOk()&&this.isEnrolled()&&b?b.find(function(a){return a.BaseCoupon})||a:a},D=function(a){return jsDPZ.app.order.getOrder().data.Details.Coupons.some(function(b){return~b.Code.indexOf(a||"LTY")})},E=function(a,b){var c;jsDPZ.app.customer.getCustomer().data.Session.loyaltyIsOk=a,e||b||(c=jsDPZ.app.order.getOrder().removeCoupons({successFilter:function(a,b){return b.isLoyaltyCoupon()}})),$.when(c).done(function(){site.sessionTools.save().then(function(){dpz.loyalty.updateWidgets(),jsDPZ.topic("loyalty.status.changed").publish({status:a})})})},F=function(){var a=$(".js-smallWidgetBody:visible"),b=a.html(),c=this.getRedemptionTemplateMarkup(),d=$.Deferred(),e=$.Deferred();return $(a).css("height",a.outerHeight()),a.fadeTo(250,0,function(){var f,g;a.html(c),f=a.find(".js-pizzaRedeemedText"),g=f.outerHeight(),a.css("opacity",1),a.animate({height:g},function(){f.toggleClass("small-scale-hidden full-scale"),f.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){setTimeout(function(){f.removeClass("full-scale").addClass("small-scale-transition"),f.one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(){a.css({opacity:0,maxHeight:g,height:"auto"}).html(b),dpz.loyalty.getPizzaCount()<1&&dpz.loyalty.getCustomerPoints().RemainderPoints>0?setTimeout(function(){dpz.loyalty.updateWidgets({data:{balance:{checkout:window.location.hash.indexOf("/checkout/")>-1}}},{forceAnimation:!0}),d.resolve()},1e3):(dpz.loyalty.updateWidgets({},{animateButton:dpz.loyalty.getPizzaCount()>=1}),d.resolve()),a.animate({maxHeight:1e3,opacity:1},1e3,function(){$(this).removeAttr("style"),e.resolve()})})},500)})})}),$.when(d,e)},G=function(){return $.extend({show:!1,bonusPoints:0,bonusTotalNeeds:0},this.config.enrollmentBonusConfig)},H=function(){var a=$.Deferred();return this.loyaltyIsOk()&&this.isEnrolled()?site.func.getOrderForPowerData({calculatePotentialPoints:!0}).then(function(b){jsDPZ.ajax.priceOrder({data:b}).then(function(b){if(b.Status>=0)b.Order&&b.Order.Loyalty?b.Order.Loyalty.Status&&"Fail"===b.Order.Loyalty.Status?a.reject(b):($.extend(!0,jsDPZ.app.order.getOrder().data.Details.Loyalty,{Potential:b.Order.Loyalty.Potential||jsDPZ.config.dataModel.ORDER.Details.Loyalty.Potential,Burn:b.Order.Loyalty.Burn||jsDPZ.config.dataModel.ORDER.Details.Loyalty.Burn,Earn:b.Order.Loyalty.Earn||jsDPZ.config.dataModel.ORDER.Details.Loyalty.Earn,PendingBalance:b.Order.Loyalty.PendingBalance||jsDPZ.config.dataModel.ORDER.Details.Loyalty.PendingBalance,PointBalance:b.Order.Loyalty.PointBalance||jsDPZ.config.dataModel.ORDER.Details.Loyalty.PointBalance}),site.sessionTools.save(),a.resolve()):a.reject(b);else{if(b.Order.StatusItems.some(function(a){return"PosOrderIncomplete"===a.Code&&6===a.PulseCode}))return $.extend(!0,jsDPZ.app.order.getOrder().data.Details.Loyalty,{Potential:jsDPZ.config.dataModel.ORDER.Details.Loyalty.Potential,Burn:jsDPZ.config.dataModel.ORDER.Details.Loyalty.Burn,Earn:jsDPZ.config.dataModel.ORDER.Details.Loyalty.Earn,PendingBalance:jsDPZ.config.dataModel.ORDER.Details.Loyalty.PendingBalance,PointBalance:jsDPZ.config.dataModel.ORDER.Details.Loyalty.PointBalance}),site.sessionTools.save(),void a.resolve();a.reject(b)}},function(){a.reject()})}):a.reject(),a},I=function(a){var b=$.extend(!0,{},a),c=jsDPZ.app.customer.getCustomer().data;this.loyaltyIsOk()?($.extend(!0,c.Loyalty,{Command:"ENROLL"}),site.func.saveAccountData({data:c,success:function(a){a.Loyalty&&"Fail"!==a.Loyalty.Status?(jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError&&jsDPZ.app.customer.getCustomer().data.Session.loyaltyStopover&&(delete jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError,site.func.toggleLoading(!1)),jsDPZ.app.customer.getCustomer().data.Session.NewLoyaltyEnrollment=!0,site.sessionTools.save().then(function(){b.successCallback&&$.isFunction(b.successCallback)?b.successCallback():dpz.loyalty.loyaltyRedirect()})):(a.Loyalty||dpz.loyalty.updateLoyaltyStatus(!1),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyEnrollmentFailed"}),b.ErrorCallback&&$.isFunction(b.ErrorCallback)&&b.ErrorCallback())}})):(site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyEnrollmentFailed"}),b.ErrorCallback&&$.isFunction(b.ErrorCallback)&&b.ErrorCallback())},J=function(){this.loyaltyIsOk()&&this.isEnrolled()&&($.extend(!0,jsDPZ.app.order.getOrder().data.Details.Loyalty,{Potential:{Earn:jsDPZ.config.dataModel.ORDER.Details.Loyalty.Potential.Earn}}),site.sessionTools.save())},K=function(b){var c=$.extend(!0,{selector:".js-myLoyaltyWidget",updateData:{}},b);a.view.mRender({name:"loyalty_small_widget",data:c.updateData,selector:c.selector})},L=function(){return dpz.template.assembleLayout({component:"loyaltyWidgetPizzaRedeemed",tokens:{}})},M=function(){this.loyaltyIsActive()&&!1===jsDPZ.app.customer.getCustomer().data.Session.loyaltyIsOk&&site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"})},N=function(){this.loyaltyIsActive()&&site.func.overlayToggle(!0,"contentOverlay",{},{template:"loyaltyInfographic",templateData:{customClass:"loyalty-infographic--overlay",showBanner:!0}},function(){site.func.stackAttack(" .loyalty-infographic--overlay")})},O=function(){var a=$.Deferred(),b=jsDPZ.app.customer.getCustomer().data;return this.loyaltyIsActive()&&(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn())&&(this.config.loyaltyIsOk?(site.func.toggleLoading(!0),jsDPZ.ajax.fetchLoyaltySummary(b.CustomerID).done(function(c){$.extend(!0,b.Loyalty,c),delete b.Loyalty.CustomerID,site.sessionTools.save().then(function(){dpz.loyalty.updateLoyaltyStatus(!0),site.func.toggleLoading(!1),a.resolve()})}).fail(function(){dpz.loyalty.updateLoyaltyStatus(!1),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"}),a.reject()})):(dpz.loyalty.updateLoyaltyStatus(!1),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"}),a.reject())),a},P=function(){this.loyaltyIsActive()&&(site.func.customerSemiLoggedIn()?site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.dashboard}):~window.location.href.indexOf("/pages/customer/")?~window.location.hash.indexOf(this.config.dashboardURL)||(window.location.hash=this.config.dashboardURL):window.location.href=urlConfig.root+"/pages/customer/"+this.config.dashboardURL)};return $(document).on("/breakpoint/change/handheld/ /breakpoint/change/desktop/ ",function(){dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.updateWidgets()}),dpz.loyalty={animateWidgets:y,canEnroll:g,canRedeem:B,config:c,continueAnimation:A,enrollCustomer:I,isReroute:k,loyaltyRedirect:j,doStopOver:h,loyaltyIsActive:d,loyaltyIsOk:e,isEnrolled:f,getBasePoints:l,getCustomerPoints:m,getEnrollmentBonusConfig:G,getPizzaCount:o,store:i,updateWidgets:z,getPointsRange:n,getRawPercentage:p,getRedemptionTemplateMarkup:L,getSmallWidgetRules:x,getPercentage:q,positionBarEndcap:r,isLastActivityInsideWarningTime:s,generateLoyaltyDescription:u,getHistoryPoints:v,getActivityString:t,getBaseCoupon:C,updateLoyaltyStatus:E,refreshLoyaltyStatus:O,renderSmallWidget:K,notifyLoginError:M,pizzaRedemptionAnimation:F,redirectToRewards:P,resetOrderEarnPoints:J,setWidgetRules:w,showInfographicOverlay:N,updateOrderPoints:H,hasLoyaltyCoupon:D},dpz.loyalty}),require([],function(){var a=function(){var a=jsDPZ.util.oauth.getTokens().accessTokens[jsDPZ.ajax.oAuthConfig.customer.tokenKey];return!(!a||jsDPZ.util.oauth.decomposeToken(a).scope!==jsDPZ.ajax.oAuthConfig.customer.scope||!jsDPZ.app.customer.getCustomer().data.CustomerID)},b=function(){var a,b=jsDPZ.util.oauth.getTokens().accessTokens[jsDPZ.ajax.oAuthConfig.customer.tokenKey];return b?(a=jsDPZ.util.oauth.decomposeToken(b),a.body&&a.body.scope?a.body.scope:[]):site.func.customerLoggedIn()?jsDPZ.ajax.oAuthConfig.customer.scope.split(" "):site.func.customerSemiLoggedIn()?jsDPZ.ajax.oAuthConfig.customer.rememberMeScope.split(" "):[]},c=function(a){return function(){var c=b();return 0===a.indexOf("anonymous")||0!==a.length&&0!==c.length&&!a.some(function(a){return-1===c.indexOf(a)})}},d=function(){window.location=urlConfig.localRoot+"/pages/customer/#/customer/login/"};return dpz.oauth={customerLoggedIn:a,isAuthorized:c,onUnauthorized:d,getCustomerScope:b},dpz.oauth}),require([],function(){var a=function(){return!jsDPZ.util.empty(jsDPZ.app.customer.getCustomer().data.PasswordHash)};return dpz.basicauth={customerLoggedIn:a},dpz.basicauth}),dpz.driverTracker=function(a,b,c){var d=function(){return killConfig.isActive("driverTracker")&&"Campus"!=jsDPZ.app.order.getOrder().data.Customer.Address.Type&&"NOLO_VISIBLE"==jsDPZ.app.store.getStore().data.DriverTrackingSupportMode||null!=jsDPZ.util.sessionStorage("trackingOverride")},e=function(){return d()&&f()},f=function(){var a=jsDPZ.app.order.getOrder().data.Details&&jsDPZ.app.order.getOrder().data.Details.OrderID?jsDPZ.app.order.getOrder().data.Details:RealtimeProxy.Data.Orders[0];return a&&a.OrderID?"DELIVERY"==a.ServiceMethod.toUpperCase():site.data.lastOrder&&!c.isEmptyObject(site.data.lastOrder)?"DELIVERY"==site.data.lastOrder.Details.ServiceMethod.toUpperCase():!!(RealtimeProxy&&RealtimeProxy.Data.Orders.length>0)&&"DELIVERY"==RealtimeProxy.Data.Orders[0].ServiceMethod.toUpperCase()},g={drivers:[],orders:[],location:{},storeID:"",hasPin:function(){this.pin},setLocation:function(a){this.location=a},assignPin:function(){this.pin=t(this.location,o.defaultStorePinSettings)},pin:null},h={storeID:"",driverID:"",driverPin:null,getDestination:function(){return this.destinationPin.getLocation()},infoWindow:null,hasInfoWindow:function(){return null!=this.infoWindow},active:!1,deliveryStatus:"",invisibility:!1,interpolatedRoute:[],routePoly:{},createAddressInfoWindow:function(a){var b=this,c=new Microsoft.Maps.Location(b.destinationPin.getLocation().latitude,b.destinationPin.getLocation().longitude),d="<div class='driver-tracker__address-infowindow'>"+a+"<span class='triangle'></span></div>",e=new Microsoft.Maps.Infobox(c,{offset:new Microsoft.Maps.Point(20,20),htmlContent:d,showCloseButton:!1});b.destinationInfoWindow=e,e.setMap(p.map)},createInfoWindow:function(a,b){var d=this,e=b.pin||d.driverPin;e.infoWindow&&(e.infoWindow.setOptions({visible:!1}),e.infoWindow.setMap(null),delete e.infoWindow);var f=c.extend(!0,{backgroundColor:"#fff",classString:"",width:180,top:0},b),g=new Microsoft.Maps.Location(e.getLocation().latitude,e.getLocation().longitude),h="<div style='width: "+f.width+"px; top:"+f.top+"px; position: relative; right:"+f.width/2+"px' class='driver-tracker__driver-infowindow "+f.classString+"'>"+a+"</div>",i=new Microsoft.Maps.Infobox(g,{offset:new Microsoft.Maps.Point(0,35),htmlContent:h,showCloseButton:!1});e.infoWindow=i,i.setMap(p.map)},updateDeliveryStatus:function(a){var b=this;a!=b.deliveryStatus&&(b.deliveryStatus=a,"DISPATCHED"!==a&&dpz.driverTrackerStatusUtil.updateDeliveryStatusWindow(a),dpz.driverTrackerStatusUtil.updateDeliveryStatus(a,b,q.getStoreByID(b.storeID)))},getLocationUpdate:function(a){var b,d=c.Deferred(),e=this,f=!1;return o.testRoute?(b=testDriverLoc[a].deliveryStatus||"LEFT_STORE",f=null==testDriverLoc[a].lat&&null==testDriverLoc[a].lng||0===testDriverLoc[a].lat&&0===testDriverLoc[a].lng,d.resolve(testDriverLoc[a],b,f)):c.ajax({url:urlConfig.api+"/order-tracker-service/order-status/by-order-locator/"+e.storeID+"/"+this.orderKey+"/",cache:!1,success:function(a){f=0===Number(a.OrderStatuses[0].CurrentLocation.Latitude)&&0===Number(a.OrderStatuses[0].CurrentLocation.Longitude),b=a.OrderStatuses[0].DeliveryStatus,d.resolve({bearing:Number(a.OrderStatuses[0].CurrentLocation.Bearing),lat:Number(a.OrderStatuses[0].CurrentLocation.Latitude),lng:Number(a.OrderStatuses[0].CurrentLocation.Longitude)},b,f)}}),d.promise()},isActive:function(){return this.active},initTimeEstimation:function(a,b){function c(){var a=setInterval(function(){"LEFT_STORE"==d.deliveryStatus?dpz.driverTrackerAnimation.getInterpolatedPoints(d.driverPin.getLocation(),d.destinationPin.getLocation()).then(function(a){var b=a.resourceSets[0].resources[0],c=Math.round(b.travelDuration/60),e="<p><span class='js-timeEstimate'>"+c+" </span>min</p><span class='triangle'></span>";d.createInfoWindow(e,{classString:"blue time-estimate",width:47})}):clearInterval(a)},3e4)}var d=this;d.timeEstimationActive||dpz.driverTrackerAnimation.getInterpolatedPoints(a,b).then(function(a){var b=a.resourceSets[0].resources[0],e=Math.round(b.travelDuration/60),f="<p><span class='js-timeEstimate'>"+e+" </span>min</p><span class='triangle'></span>";d.createInfoWindow(f,{classString:"blue time-estimate",width:47}),d.timeEstimationActive=!0,c()})},initTracking:function(){function b(a,d,e){var f=d||5e3;if(!c.isActive())return!1;c.getLocationUpdate(a).then(function(d,e,g){var h={};return g!=c.invisibility&&(i(c,g),h.skipAnimation=!g),newPositionAndStatus.push({CurrentLocation:d,DeliveryStatus:e}),a++,g?setTimeout(function(){b(a)},5e3):"DISPATCHED"==e?(c.updateDeliveryStatus(e),setTimeout(function(){b(a)},1e4)):("LEFT_STORE"==e&&"LEFT_STORE"!=c.deliveryStatus&&(h={skipAnimation:!0},c.updateDeliveryStatus(e)),"OUT_THE_DOOR"!=e&&"APPROACHING_DESTINATION"!=e||c.updateDeliveryStatus(e),void dpz.driverTrackerAnimation.buildRoute(c.driverPin.getLocation(),d,h,f).then(function(d){d.animateRoute(c.driverPin,f,h,function(){return"COMPLETE"==e&&(c.updateDeliveryStatus(e),p.map.entities.remove(c.driverPin),o.icons.deliveryDestination_Complete.then(function(a){c.destinationPin.icon&&c.destinationPin.icon.drawIcon&&c.destinationPin.setOptions({icon:u(a,c.destinationPin.icon.settings,0)})}),dpz.driverTracker.cancelTracking()),"AT_THE_DOOR"==e&&c.updateDeliveryStatus(e),b(a)})}))})}var c=this;a.googleRouteResults=[],a.routeWaypoints=[],a.newPositionAndStatus=[],j([c.driverPin.getLocation(),c.getDestination()]),c.active=!0,b(0)}},i=function(a,b){var c=q.getStoreByID(a.storeID);!function(){for(var a,d=p.map.entities.getLength(),e=0;e<d;e++)(a=p.map.entities.get(e))!=c.pin&&a.setOptions({visible:!b})}(),b?a.updateDeliveryStatus("UNABLE_TO_TRACK"):(j([a.driverPin.getLocation(),a.destinationPin.getLocation(),c.pin.getLocation()]),c.pin.infoWindow.setMap(null)),a.invisibility=b},j=function(a){for(var b=[],c=-90,d=90,e=-180,f=180,g=0,h=a.length;g<h;g++){var i=a[g];b.push(i),i.latitude>c&&(c=i.latitude),i.latitude<d&&(d=i.latitude),i.longitude>e&&(e=i.longitude),i.longitude<f&&(f=i.longitude)}var j=.1,k=(c-d)*j,l=(e-f)*j;b.push(dpz.driverTrackerAnimation.apiFriendlyLocation({lat:d-k,lng:e+l})),b.push(dpz.driverTrackerAnimation.apiFriendlyLocation({lat:c+k,lng:f-l}));var m=Microsoft.Maps.LocationRect.fromLocations(b);p.map.setView({bounds:m})},k={storeID:"",driverID:"",pin:null,hasPin:function(){return null!=this.pin},getLocation:function(){return this.pin.getLocation()}},l=function(){h.driverPin&&(h.driverPin.infoWindow&&h.driverPin.infoWindow.setMap(null),p.map.entities.remove(h.driverPin),h.driverPin=null)},m=function(a,b){p&&null!==p.map&&p.map.entities.clear();var c={lat:Number(b.Latitude),lng:Number(b.Longitude)};if(q.addStore(a.StoreID,c),!a.DeliveryStatus)return l(),dpz.driverTrackerStatusUtil.updateDeliveryStatusWindow("UNABLE_TO_TRACK"),dpz.driverTrackerStatusUtil.updateDeliveryStatus("UNABLE_TO_TRACK",Object.create(h),q.getStoreByID(a.StoreID)),q.orders[a.OrderKey]="UNABLE_TO_TRACK",p&&null!==p.map&&t({lat:p.map.getCenter().latitude,lng:p.map.getCenter().longitude},o.defaultStorePinSettings),!1;var d={CurrentLocation:{Latitude:"",Longitude:""},DeliveryLocation:{Latitude:"",Longitude:""},DeliveryStatus:"",StopNumber:"",DriverID:"",OrderKey:"",StoreID:"",DriverName:""};for(var e in d)d[e]=a[e]||d[e];var f={lat:Number(d.CurrentLocation.Latitude),lng:Number(d.CurrentLocation.Longitude)},g={lat:Number(d.DeliveryLocation.Latitude),lng:Number(d.DeliveryLocation.Longitude)};null!==d.DeliveryLocation.Latitude&&null!==d.DeliveryLocation.Longitude&&d.DriverID&&d.DriverName?("LEFT_STORE"==d.DeliveryStatus||"APPROACHING_DESTINATION"==d.DeliveryStatus||"AT_THE_DOOR"==d.DeliveryStatus||"COMPLETE"==d.DeliveryStatus?q.addDriver(d.DriverID,f,d.DriverName):q.addDriver(d.DriverID,c,d.DriverName),q.addOrder(d.DriverID,g,d.OrderKey,d.StoreID,d.StopNumber,d.DeliveryStatus),d.StopNumber>1&&dpz.driverTrackerStatusUtil.showMultiRunText(),dpz.driverTrackerStatusUtil.updateDriverName(d.DriverName)):(h.createInfoWindow(o.templates.infoWindows.notAbleToTrack(),{pin:h.storePin,width:145,backgroundColor:"#0078ae",classString:"blue getting-ready"}),dpz.driverTrackerStatusUtil.updateDeliveryStatusWindow("UNABLE_TO_TRACK"))},n=function(a){return c.Deferred(function(b){var c=new Image;c.src=a,c.crossOrigin="Anonymous",c.onload=function(a){b.resolve(a.currentTarget)}})},o={testRoute:!1,templates:{infoWindows:{waitingForBake:function(){return"<img class='driver-tracker__driver-infowindow__icon' src='"+urlConfig.assets+"/images/tracker/driverTracker/ovenIcon.png' alt=\"Oven Icon\" /><p>Waiting for your<br/>order to finish</p><span class='triangle'></span>"},gettingReady:function(){return"<p>Getting your order<br/>ready to go</p><span class='triangle'></span>"},almostThere:function(){return"<p>Any Minute Now!</p><span class='triangle'></span>"},atTheDoor:function(){return"<p>Get Ready!</p><span class='triangle'></span>"},notAbleToTrack:function(){return"<p>Sorry, we are not able<br/>to track this order</p><span class='triangle'></span>"}}},selectors:{mapContainerDefault:"#driver-tracker__map",deliveryStatusContainer:".js-deliveryStatusContainer",deliveryStatusText:".js-deliveryStatusText",deliveryStatusDescription:".js-deliveryStatusDescription",multiOrderText:".js-multiOrderText"},defaultMapCenter:{lat:43.37202157094114,lng:-84.56838726093746},defaultMapZoom:7,icons:{store:null,deliveryDestination:null,deliveryDestination_Complete:null,car:null},trackingSettings:{carRefreshInterval:5e3,metersPerAnimation:.5},defaultStorePinSettings:{type:"store",color:"#29a50a"}},p={map:null},q={addStore:function(a,b){if(!(a in this.stores)){var c=Object.create(g);c.setLocation(b),c.assignPin(),this.stores[a]=c}},addOrder:function(a,b,c,d,e,f){if(!(c in this.orders)){var g=Object.create(h);g.driverID=a,g.storeID=d,g.orderKey=c,g.destinationPin=t(b,{type:"deliveryDestination",color:"#e21737"}),g.stopNumber=e,g.driverPin=q.getDriverByID(g.driverID).pin,g.updateDeliveryStatus(f),g.storeLocation=dpz.driverTrackerAnimation.apiFriendlyLocation(q.getStoreByID(g.storeID).location),this.orders[c]=g,g.initTracking()}},getCurrentOrders:function(){return q.orders},addDriver:function(a,b,c){if(l(),!(a in this.drivers)){var d=Object.create(k);d.driverID=a,d.driverName=c,d.pin=t(b,{type:"car",color:"#0078ae",zIndex:999,width:44,height:44,anchor:new Microsoft.Maps.Point(22,22)}),this.drivers[a]=d}},getDriverByID:function(a){return this.drivers[a]},getStoreByID:function(a){return this.stores[a]},stores:{},orders:{},drivers:{}},r=function(a){var b=this;site.data.initializedBingMap||(require(["tracker/tracker-images"],function(d){var e=c.extend(!0,{mapContainer:o.selectors.mapContainerDefault,mapCenter:{lat:"",lng:""},zoom:o.defaultMapZoom},a);Object.keys(o.icons).forEach(function(a){o.icons[a]=n(d[a])}),bingMapLoadedPromise.then(function(){b.initializeMap(e)})}),site.data.initializedBingMap=!0)},s=function(a){var b=c(a.mapContainer)[0];p.map=new Microsoft.Maps.Map(b,{center:new Microsoft.Maps.Location(a.mapCenter.lat,a.mapCenter.lng),zoom:a.zoom,disableDefaultUI:!0,credentials:"AlTHY2ztc-9lKqBpjsx-xhght0FzbGpbnu-V3Q7JuyI7Z_Oju80AEVoq5lmvmDbK",mapTypeId:Microsoft.Maps.MapTypeId.road,showMapTypeSelector:!1,showScalebar:!1,showDashboard:!0,enableSearchLogo:!1}),h.driverPin=t({lat:p.map.getCenter().latitude,lng:p.map.getCenter().longitude},{type:"car",color:"#0078ae",anchor:new Microsoft.Maps.Point(12,19)}),h.createInfoWindow(o.templates.infoWindows.waitingForBake(),{pin:h.driverPin,width:145,backgroundColor:"#0078ae",classString:"blue waiting-for-bake .js-waitingForBake"})},t=function(a,b){var d={width:45,height:45},e=c.extend(!0,d,b),f=new Microsoft.Maps.Location(a.lat,a.lng),g=new Microsoft.Maps.Pushpin(f,{width:e.width,height:e.height,zIndex:e.zIndex,anchor:e.anchor,color:e.color});return p&&null!==p.map&&(o.icons[e.type].then(function(a){g.setOptions({icon:u(a,e,0)}),g.icon={drawIcon:u,img:a,settings:e}}),p.map.entities.push(g)),g},u=function(a,c,d){var e,f=b.createElement("canvas");return f.width=c.width,f.height=c.height,e=f.getContext("2d"),d&&(e.translate(.5*f.width,.5*f.height),e.rotate(d*Math.PI/180),e.translate(.5*-f.width,.5*-f.height)),e.drawImage(a,f.width/2-a.width/2,f.height/2-a.height/2),f.toDataURL()},v=function(){jsDPZ.util.sessionStorage("trackingOverride",!0)};return{cancelTracking:function(){for(var a in q.orders)q.orders[a].active=!1},getCurrentOrders:q.getCurrentOrders,trackingEnabled:d,init:r,updateMapBounds:j,initializeMap:s,mapObj:p,mapEnabled:e,trackSingleOrder:m,forceTracking:v}}(window,document,jQuery),dpz.driverTrackerStatusUtil=function(a,b,c){function d(a){c(".js-driverName").text(a)}function e(){c(".js-driverTrackerStatusContainer").addClass("has-multiple-deliveries")}function f(a){dpz.driverTracker.mapObj&&null!==dpz.driverTracker.mapObj.map&&(c(".js-driverTrackerStatusContainer")["ERROR"===a||"UNABLE_TO_TRACK"===a?"addClass":"removeClass"]("has-error"),c(".js-driverTrackerStatus.current").addClass("discarded").one("webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend",function(a){c(".js-driverTrackerStatus.current.discarded").removeClass("discarded current").addClass("queued")}),c("[data-delivery-status="+a.toLowerCase()+"]").removeClass("queued").addClass("current"))}function g(a,b,d){if(dpz.driverTracker.mapObj&&null!==dpz.driverTracker.mapObj.map){switch(dpz.utag.fire.link(void 0,{event_name:a,event_action:"update",event_category:"Delivery Status",event_label:"Driver Tracker"}),a){case"UNABLE_TO_TRACK":dpz.driverTracker.mapObj.map.setView({center:d.pin.getLocation(),zoom:17}),b.createInfoWindow(h.infoWindows.unableToTrack(),{pin:d.pin,width:159,top:-30,backgroundColor:"#0078ae",classString:"blue unable-to-track js-unableToTrack"});break;case"DISPATCHED":if(b.createInfoWindow(h.infoWindows.gettingReady(),{pin:d.pin,width:115,backgroundColor:"#0078ae",classString:"blue getting-ready js-gettingReady"}),jsDPZ.app.order.getOrder().data.Customer.Address.Street){var e=jsDPZ.app.order.getOrder().data.Customer.Address;b.destinationInfoWindow||b.createAddressInfoWindow(""!=e.CampusID?e.StreetName:e.Street)}break;case"LEFT_STORE":c(".js-gettingReady").fadeOut(function(){b.driverPin.infoWindow&&b.driverPin.infoWindow.setMap(null),delete b.driverPin.infoWindow,d.pin&&(!d.pin||d.location.lat===d.pin.geometry.y&&d.location.lng===d.pin.geometry.x)||d.assignPin(),b.stopNumber<2&&b.initTimeEstimation(b.driverPin.getLocation(),b.destinationPin.getLocation())});break;case"APPROACHING_DESTINATION":c(".driver-tracker__order-status-container__order-status").css("background-color","#EF3447"),dpz.driverTracker.updateMapBounds([b.driverPin.getLocation(),b.getDestination()]),b.createInfoWindow(h.infoWindows.almostThere(),{classString:"almost-there js-almostThere",width:100});break;case"AT_THE_DOOR":c(".driver-tracker__order-status-container__order-status").css("background-color","#EF3447"),b.driverPin.infoWindow&&b.driverPin.infoWindow.setOptions({visible:!1}),delete b.driverPin.infoWindow,b.createInfoWindow(h.infoWindows.atTheDoor(),{classString:"at-the-door js-atTheDoor blue",width:62});break;case"COMPLETE":c(".driver-tracker__order-status-container__order-status").css("background-color","#EF3447"),c(".js-almostThere").fadeOut(function(){b.driverPin.infoWindow.setOptions({visible:!1})}),b.driverPin.infoWindow&&b.driverPin.infoWindow.setOptions({visible:!1}),b.destinationInfoWindow&&b.destinationInfoWindow.setOptions({visible:!1});break;case"PENDING":if(b.createInfoWindow(h.infoWindows.waitingForBake(),{width:145,backgroundColor:"#0078ae",classString:"blue waiting-for-bake js-waitingForBake"}),jsDPZ.app.order.getOrder().data.Customer.Address.Street){var e=jsDPZ.app.order.getOrder().data.Customer.Address;b.destinationInfoWindow||b.createAddressInfoWindow(""!=e.CampusID?e.StreetName:e.Street)}}c(".js-deliveryStatusTime").text(moment().format("h:mm A"))}}var h={infoWindows:{unableToTrack:function(){return"<p>Your order isn't trackable<br/>but it's on the way!</p><span class='triangle'></span>"},waitingForBake:function(){return"<img class='driver-tracker__driver-infowindow__icon' src='"+urlConfig.assets+"/images/tracker/driverTracker/ovenIcon.png'/><p>Waiting for your<br/>order to finish</p><span class='triangle'></span>"},gettingReady:function(){return"<p>Getting your order<br/>ready to go</p><span class='triangle'></span>"},almostThere:function(){return"<p>Any Minute Now!</p><span class='triangle'></span>"},atTheDoor:function(){return"<p>Get Ready!</p><span class='triangle'></span>"}}};return{updateDeliveryStatus:g,updateDeliveryStatusWindow:f,showMultiRunText:e,updateDriverName:d}}(window,document,jQuery),dpz.driverTrackerAnimation=function(a,b,c){var d={distance:0,isAnimationWorthy:function(){return this.distance>25},distanceIsTrusted:function(){this.distance},routePoints:[],animateRoute:function(a,b,c,d){function e(a){return a<=0?a+360*Math.ceil(Math.abs(a)/360):a-360*Math.floor(Math.abs(a)/360)}function g(a,b){var c=!1;return Math.abs(a-b)>15&&Math.abs(a-(360-b))>15&&(c=!0),c}function h(a,b,c){var d=(Math.abs(c-a)+180)%360-180;return c>a?b+d:b-d}function i(c,j){if(c.length){var k,l=c.shift(),n=f.calculateBearing(a.getLocation(),l),o=a.currentBearing||0,p=e(o),q=g(p,n);return q&&j.rotatePin&&(k=h(p,o,n),dpz.driverTrackerAnimation.rotatePin(a,k)),a.setLocation(l),a.infoWindow&&a.infoWindow.setLocation(l),setTimeout(function(){i(c,j)},b/m)}d()}var j,k,l=this,m=l.routePoints.length,n=a.currentBearing||0,o=e(n);m>1&&l.isAnimationWorthy()&&(j=f.calculateBearing(l.routePoints[0],l.routePoints[l.routePoints.length-1]),g(o,j)&&(k=h(o,n,j),dpz.driverTrackerAnimation.rotatePin(a,k))),i(l.routePoints,{rotatePin:l.isAnimationWorthy()})}},e={rotatePin:{BING:function(a,b){a.icon&&a.icon.drawIcon&&a.setOptions({icon:a.icon.drawIcon(a.icon.img,a.icon.settings,b)}),a.currentBearing=b}},buildRoute:{BING:function(a,b,e,f){var g=c.Deferred(),h=c.extend(!0,{},e),i=this,j=Object.create(d),k=i.apiFriendlyLocation(b);if(j.distance=i.haversineDistance(a,k),j.distance<1||h.skipAnimation)j.routePoints=[k],g.resolve(j);else if(j.isAnimationWorthy()){i.getInterpolatedPoints(a,k).then(function(b){var c=b.resourceSets[0].resources[0].routePath.line.coordinates,d=b.resourceSets[0].resources[0].travelDistance,e=d*(f/1e3)+.5;if(j.distance/(1e3*d)<.75)j.routePoints=i.granulateRoutePoints([a,k],e);else if(d>0){for(var h=[],l=0,m=c.length;l<m;l++)h.push(i.apiFriendlyLocation({lat:c[l][0],lng:c[l][1]}));j.routePoints=i.granulateRoutePoints(h,e)}else j.routePoints=[i.apiFriendlyLocation({lat:c[0][0],lng:c[0][1]})];g.resolve(j)})}else j.routePoints=i.granulateRoutePoints([a,k]),g.resolve(j);return g.promise()}},apiFriendlyLocation:{BING:function(a){return new Microsoft.Maps.Location(a.lat,a.lng)}},getInterpolatedPoints:{BING:function(a,b,d){var e=d||"Driving",f="wp.0="+a.latitude+","+a.longitude+"&wp.1="+b.latitude+","+b.longitude;return c.ajax({url:"https://dev.virtualearth.net/REST/V1/Routes/"+e+"?&s=1&rpo=Points&"+f+"&avoid=minimizeTolls&key=AlTHY2ztc-9lKqBpjsx-xhght0FzbGpbnu-V3Q7JuyI7Z_Oju80AEVoq5lmvmDbK",dataType:"jsonp",data:{},jsonp:"jsonp"})}}},f={calculateBearing:function(a,b){function c(a){return a*Math.PI/180}function d(a){return 180*a/Math.PI}var e=c(a.latitude),f=a.longitude,g=c(b.latitude),h=b.longitude,i=c(h-f),j=Math.sin(i)*Math.cos(g),k=Math.cos(e)*Math.sin(g)-Math.sin(e)*Math.cos(g)*Math.cos(i);return(d(Math.atan2(j,k))+360)%360},granulateRoutePoints:function(a,b){function c(a,b){for(var b=b||[],f=a.shift(),g=a.shift(),h=g.latitude-f.latitude,i=g.longitude-f.longitude,j=d.haversineDistance(f,g),k=Math.ceil(Number((j/e).toFixed(1))),l=h/k,m=i/k,n=1,o=k;n<=o;n++){var p=d.apiFriendlyLocation({lat:f.latitude+l*n,lng:f.longitude+m*n});b.push(p)}return a.length?(a.unshift(b[b.length-1]),c(a,b)):b}var d=this,e=b||.5;return c(a)},haversineDistance:function(a,b){function c(a){return a*a}function d(a){return a*i/180}var e=Math.atan2,f=Math.cos,g=Math.sin,h=Math.sqrt,i=Math.PI,j=a.latitude||a.lat,k=b.latitude||b.lat,l=a.longitude||a.lng,m=b.longitude||b.lng,n=d(k-j),o=d(m-l),p=c(g(n/2))+f(d(j))*f(d(k))*c(g(o/2));return 2*e(h(p),h(1-p))*6378137}};return function(){var a={};for(func in e)a[func]=e[func].BING;for(func in f)a[func]=f[func];return a}()}(window,document,jQuery),dpz.fulfillerWizard=function(a,b,c){function d(a,b){var c,d,f,i=[],j={};if(b){var c=g(b)||h(b);if(void 0===c)return[];for(var k=c.UnFulfilled,l=0,m=k.length;l<m;l++){var d=k[l],f=d.filter(function(b){return b.Code===a});f.length&&e(j,f[0].Variants)}i=Object.keys(j)}else i=jsDPZ.app.catalog.getCatalog().getProduct(a).data.Variants;return i}function e(a,b){for(var c,d=0,e=b.length;d<e;d++)c=b[d],a.hasOwnProperty(c)||(a[c]=!0)}function f(a){var b;return b=jsDPZ.app.order.getOrder().data.Details.Coupons,b.filter(function(b){return b.Code===a})[0].ID}function g(a){var b=site.func.updateFulfillerStatus();return b.filter(function(b){return a===b.GroupID})[0]}function h(a){return jsDPZ.app.order.getOrder().data.Fulfiller.Groups.filter(function(b){return a===b.GroupID})[0]}function i(a,b){var c,d,e=!1;return c=g(a),void 0===c&&(d=jsDPZ.app.order.getOrder().data.Details.Coupons.filter(function(b){return b.Code==a}),e=!jsDPZ.util.empty(d)&&d[0].Fulfilled),e&&(c=h(a)),c}function j(a,b){var d=c.extend({},b),e=i(a,d),g=f(a);e&&l(e,g,d)}function k(a,b){j(a,c.extend({addItem:!0},b))}function l(a,b,d){var e=c.extend(!0,{},d);site.func.overlayToggle(!0,"fulfillerWizard",{},{group:a,orderID:b,settings:e})}return{addItemToCoupon:k,showWizard:j,getEligibleVariants:d}}(window,document,jQuery),require(["external/tealium-adapter","dpz.config"],function(a){var b=a.default,c=void 0,d=void 0;if(killConfig.isActive("tealium")){switch(dpz.market.marketCode){case"US":c="main";break;case"CA":c="Canada";break;default:c="golo"}switch(envConfig){case"nolo-us-preprod":case"nolo-us-qa":case"golo-qa":case"golo-preprod":case"nolo-ca-qa":case"nolo-ca-preprod":d="qa";break;case"nolo-us-prod":case"golo-prod1":case"golo-prod2":case"golo-va-prod1":case"golo-va-prod2":case"golo-de-prod1":case"golo-de-prod2":case"nolo-ca-prod":d="prod";break;default:d="dev"}}window.dpz.utag=function(){var a=void 0,e={group:"",sub_group:"",ab_test:"false",address_type:"",cart_identifier:"",coupon_codes:"false",coupon_quantities:[],coupon_prices:[],con_refresh:"false",content_group:"",content_subgroup:"",count_recent_orders:"",device_type:"",displayed_upsells:[],external_referrer:"",event_description:"",event_path:"",event_type:"",GAcampaign:"",GAcontent:"",GAmedium:"",GAsource:"",GAterm:"",gps_map_enabled:"false",has_easy_order:jsDPZ.app.customer.getCustomer().data.Session.hasEasyOrder,has_loyalty:"false",is_easy_order:jsDPZ.app.customer.getCustomer().data.Session.IsEasyOrder,is_recent_order:jsDPZ.app.customer.getCustomer().data.Session.IsRecentOrder,last_click:"",last_load:"",loyalty_confirmation:"",marked_campaign:"",market_code:dpz.market.marketCode,market_language_code:dpz.market.activeLanguageCode,market_language_name:dpz.market.activeLanguageName,market_name:dpz.market.marketName,my_srv_methd:"",order_date:"",order_time:"",order_delivery:"",order_discount:"",order_grand_total:"",order_id:"",pulse_order_id:"",order_payment_type:[],credit_card_payment_amount:"",gift_card_payment_amount:"",cash_payment_amount:"",order_subtotal:"",order_tax:"",page_url:"",page_type:"",pixels_fired:"false",product_ci:[],product_family:[],product_family_sku:"",product_id:[],product_price:[],product_quantity:[],product_salt:"false",product_sku:[],remember_me:"",route_params:"",save_easy_order:jsDPZ.app.customer.getCustomer().data.Session.SaveAsEasyOrder,store_id:"",tip_amount:"",user_logged_in:"",return_user:"",yesmail_offercode:"",yesmail_segment:"",yesmail_treatment:"",yesmail_fcode:"",device_id:"",timestamp_local:"",code_version_numbers:"",session_id:"",store_list:"",store_button:"",store_search:"",local_time:"",customer_latitude:"",customer_longitude:"",hotspot_id:"",hotspots_active:"",lower_estimated_wait_minutes:"",upper_estimated_wait_minutes:"",crow_fly_distance:"",walking_time:"",driving_time:"",poe:""},f={getOrder:function(){return site.isConfirmationPage?site.data.lastOrder:jsDPZ.app.order.getOrder().data},getCustomer:function(){return jsDPZ.app.customer.getCustomer().data},getVariantSkusInCart:function(a){return a=a||this.getOrder(),a.Details.Variants.reduce(function(a,b){return a.push(b.Code),a},[])},getProductCodesInCart:function(a){return a=a||this.getVariantSkusInCart(),a.reduce(function(a,b){var c=jsDPZ.app.catalog.getCatalog().getVariant(b).data;return c&&a.push(c.ProductCode),a},[])},getProductFamiliesInCart:function(a){return a=a||this.getVariantSkusInCart(),a.reduce(function(a,b){var c=jsDPZ.app.catalog.getCatalog().getVariant(b).data;if(c){var d=jsDPZ.app.catalog.getCatalog().getProduct(c.ProductCode).data;d&&a.push(jsDPZ.util.htmlUnEncode(d.ProductType))}return a},[])},updateReturnUser:function(){e.return_user=site.func.isLoggedInAndNotNewUser()?"true":jsDPZ.app.customer.getCustomer().data.Session.ReturnUser},updateAddressType:function(a){e.address_type=a.Customer.Address.Type},updateGpsMapEnabled:function(){e.gps_map_enabled=dpz.driverTracker.mapEnabled().toString()},updateProductSku:function(a){e.product_sku=a.Details.Variants.reduce(function(a,b){return a.push(jsDPZ.util.htmlUnEncode(b.Code)),a},[])},updateProductCI:function(a){e.product_ci=a.Details.Variants.reduce(function(a,b){return a.push(b.Instructions?jsDPZ.util.htmlUnEncode(b.Instructions):null),a},[])},updateProductQuantity:function(a){e.product_quantity=a.Details.Variants.reduce(function(a,b){return a.push(b.Qty),a},[])},updateProductPrice:function(a){e.product_price=a.Details.Variants.reduce(function(a,b){return a.push(b.Price>0?b.Price:null),a},[])},updateProductSalt:function(a){var b=a.Details.Variants,c=jsDPZ.app.catalog.getCatalog(),d=void 0,f=void 0,g=void 0,h=void 0;jsDPZ.util.empty(c.data.Variants)||(e.product_salt=[],a.Details.Variants.forEach(function(a,i){d=b[i].Code;try{f=c.getVariant(d).data.ProductCode}catch(a){jsDPZ.topic("utag.variant_undefined.IOLO-15696").publish({error:a,variant:d,storeid:e.store_id})}g=c.getProduct(f).data.ProductType,h=dpz.dietary.checkForSodium(g,b[i]),h?e.product_salt.push(1):e.product_salt.push(0)}))},updateOrderPaymentType:function(a){a=a||this.getOrder(),a.Details.Payments.forEach(function(a){e.order_payment_type.push(a.Type)})},updateOrderId:function(a){a=a||f.getOrder(),e.order_id=a.Details.OrderID},updatePulseOrderId:function(a){a=a||f.getOrder(),e.pulse_order_id=a.Details.StoreOrderID.split("#")[1]},updateServiceMethod:function(a){a=a||f.getOrder(),a.DeliveryHotspot&&a.DeliveryHotspot.Id?e.my_srv_methd="Hotspot":e.my_srv_methd=a.Details.ServiceMethod},updateStoreId:function(a){a=a||f.getOrder(),e.store_id=a.Details.StoreID},updateOrderAmountsBreakdown:function(a){a=a||f.getOrder();var b=a.Details.Amounts;e.order_subtotal=parseFloat(b.FoodAndBeverage),e.order_delivery=parseFloat(b.DeliveryFee),e.order_tax=parseFloat(b.Tax).toFixed(2),e.order_discount=parseFloat(b.Savings).toFixed(2),e.order_grand_total=parseFloat(b.Customer).toFixed(2)},updateOrderMisc:function(a){a=a||jsDPZ.app.customer.getCustomer().data,e.easyorder=a.Session.IsEasyOrder,f.updateServiceMethod()},updatePaymentAmounts:function(a){var b=[];a=a||f.getOrder().Details.Payments,a.forEach(function(a){b[a.Type]=a.Amount}),e.credit_card_payment_amount=b.CreditCard?b.CreditCard:"0.00",e.gift_card_payment_amount=b.GiftCard?b.GiftCard:"0.00",e.cash_payment_amount=b.Cash?b.Cash:"0.00"},updateLoginStatus:function(){site.func.customerLoggedIn()?e.user_logged_in="loggedin":site.func.customerSemiLoggedIn()?e.user_logged_in="remembered":e.user_logged_in="anonymous"},updateYesmail:function(a){var b=void 0;a=a||this.getOrder(),jsDPZ.util.empty(a.Partners.YesMail)||(b=f.getOrder().Partners.YesMail,e.yesmail_offercode=b.offercode,e.yesmail_segment=b.segment,e.yesmail_treatment=b.treatment,e.yesmail_fcode=b.fcode)},updateProductId:function(a){a=a||this.getVariantSkusInCart(),e.product_id=a.reduce(function(a,b){var c=jsDPZ.app.catalog.getCatalog().getVariant(b).data;return c&&a.push(jsDPZ.util.htmlUnEncode(c.Name)),a},[])},updateProductFamily:function(a){a=a||this.getProductFamiliesInCart(),e.product_family=a},updateAbTest:function(){var a=void 0;killConfig.isMarketEnabled("mBox")&&(a=jsDPZ.app.customer.getCustomer().data.Session.tnt,a&&a.testGroups&&a.testGroups.length?e.ab_test=a.testGroups.join(", "):e.ab_test="false")},updateProductFamilySku:function(a,b){a=a||this.getVariantSkusInCart(),b=b||this.getProductFamiliesInCart(),e.product_family_sku=a.reduce(function(a,c,d){return a.push(jsDPZ.util.htmlUnEncode(b[d]+" - "+c)),a},[])},updateOrderDate:function(){var a=moment();e.order_date=a.format("L"),e.order_time=a.format("HH:mm:ss")},updateLoyaltyDetails:function(){var a=jsDPZ.app.customer.getCustomer().data.Session||{};e.new_loyalty_enrollment=a.NewLoyaltyEnrollment?"true":"false",e.send_loyalty_enrollment_pixel=a.sendLoyaltyEnrollmentPixel?"true":"false",e.loyalty_confirmation=a.NewLoyaltyEnrollment?"true":"false"},updateCouponDetails:function(a){a=a||this.getOrder();var b=a.Details.Coupons;e.coupon_quantities=[],e.coupon_prices=[],b.length>0&&(e.coupon_codes=[]),b.forEach(function(a){e.coupon_codes.push(a.Code),e.coupon_quantities.push(a.Qty),e.coupon_prices.push(a.Price)})},updateCartId:function(a){e.cart_identifier=a.Details.StoreOrderID+"#"+a.Details.StoreID},updateGroupSubgroup:function(a){a&&(e.group=a.group),a&&(e.sub_group=a.subGroup)},updatePageUrl:function(a){var b=$("link[rel='canonical']").attr("href");e.page_url=b||a&&a.uri||window.location.href},updateGoogleAd:function(){var a=$.extend({},dpz.util.getQueryParameters(),jsDPZ.app.customer.getCustomer().data.Session.googleAd);e.GAcampaign=a.utm_campaign||"",e.GAcontent=a.utm_content||"",e.GAmedium=a.utm_medium||"",e.GAsource=a.utm_source||a.easyOrderReferrer||"",e.GAterm=a.utm_term||"",delete jsDPZ.app.customer.getCustomer().data.Session.googleAd,site.sessionTools.save()},updateRouteParams:function(){e.route_params=JSON.stringify(jsDPZ.app.customer.getCustomer().data.Session.routeParams),delete jsDPZ.app.customer.getCustomer().data.Session.routeParams,site.sessionTools.save()},updateHasLoyalty:function(){(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn())&&(e.has_loyalty=dpz.loyalty.isEnrolled().toString())},updateConRefresh:function(){jsDPZ.app.customer.getCustomer().data.Session.ConfirmationPageRefreshCounter&&jsDPZ.app.customer.getCustomer().data.Session.ConfirmationPageRefreshCounter>1&&site.isConfirmationPage?e.con_refresh="true":e.con_refresh="false"},updateDeliveryFee:function(a){var b=a.Details.Amounts&&a.Details.Amounts.DeliveryFee||0;"false"===e.product_salt&&(e.product_salt=[]),e.product_family.push("delivery fee"),e.product_family_sku.push("delivery fee"),e.product_id.push("delivery fee"),e.product_price.push(b),e.product_quantity.push(1),e.product_sku.push("delivery"),e.product_ci.push(null),e.product_salt.push(0)},updateKioskProps:function(a){e.device_id=a.deviceId,e.timestamp_local=moment().format("YYYY-MM-DD HH:mm:ss.SSS Z"),e.code_version_numbers=dpz.version.version,e.session_id=dpz.kiosk.sessionId},updateStoreList:function(){e.store_list=site.storage.load("storeList")||"",e.store_button=jsDPZ.app.customer.getCustomer().data.storeList||"",e.store_search=jsDPZ.app.customer.getCustomer().data.storeSearch||""},updateHotspotID:function(a){a&&a.path&&-1!==a.path.indexOf("confirmation")&&jsDPZ.util.htmlEscape(site.data.lastOrder).DeliveryHotspot?e.hotspot_id=jsDPZ.util.htmlEscape(site.data.lastOrder).DeliveryHotspot.Id:jsDPZ.app.order.getOrder().data.DeliveryHotspot?e.hotspot_id=jsDPZ.app.order.getOrder().data.DeliveryHotspot.Id:e.hotspot_id=""},updateAll:function(a){var b=f.getOrder(),c=f.getCustomer(),d=[],g=[];return b&&b.Details&&(d=f.getVariantSkusInCart(b),g=f.getProductFamiliesInCart(d),f.updateProductCI(b),f.updateProductSku(b),f.updateProductQuantity(b),f.updateProductPrice(b),f.updateProductId(d),f.updateProductFamily(g),f.updateProductFamilySku(d,g),f.updateProductSalt(b),f.updateServiceMethod(b),f.updateStoreId(b),f.updateOrderMisc(),f.updatePaymentAmounts(),f.updateYesmail(b),f.updateCouponDetails(b),f.updateCartId(b),"Delivery"===b.Details.ServiceMethod&&(f.updateDeliveryFee(b),f.updateAddressType(b)),site.isConfirmationPage&&(f.updateGpsMapEnabled(),f.updateOrderPaymentType(b),f.updateOrderId(b),f.updatePulseOrderId(b),f.updateOrderDate(),f.updateOrderAmountsBreakdown(b),f.updateConRefresh())),(site.isPaymentPage||-1!==window.location.hash.indexOf("checkout"))&&(f.updateOrderAmountsBreakdown(b),e.lower_estimated_wait_minutes=jsDPZ.app.store.getStore().data.EstimatedWaitMinutes.split("-")[0]||"",e.upper_estimated_wait_minutes=jsDPZ.app.store.getStore().data.EstimatedWaitMinutes.split("-")[1]||""),f.updateReturnUser(),f.updateAbTest(),f.updateGroupSubgroup(a),f.updatePageUrl(a),f.updateLoginStatus(),f.updateGoogleAd(),f.updateRouteParams(),f.updateLoyaltyDetails(),f.updateHasLoyalty(),f.updateStoreList(),dpz.kiosk&&dpz.kiosk.isActive?e.device_type="Ordering":site.func.isHandheld()?e.device_type="handheld":e.device_type="desktop",e.has_easy_order=c.Session.hasEasyOrder,e.is_easy_order=c.Session.IsEasyOrder,e.is_recent_order=c.Session.IsRecentOrder,e.market_code=dpz.market.marketCode,e.market_language_code=dpz.market.activeLanguageCode,e.market_language_name=dpz.market.activeLanguageName,e.market_name=dpz.market.marketName,e.remember_me=site.storage.load("CID")?"true":"false",e.save_easy_order=c.Session.SaveAsEasyOrder,e.local_time=moment().format("YYYY-MM-DD HH:MM:SS.ssss Z"),e.customer_latitude=jsDPZ.app.customer.getCustomer().data.Session.cachedPosition?jsDPZ.app.customer.getCustomer().data.Session.cachedPosition.coords.latitude:"",e.customer_longitude=jsDPZ.app.customer.getCustomer().data.Session.cachedPosition?jsDPZ.app.customer.getCustomer().data.Session.cachedPosition.coords.longitude:"",f.updateHotspotID(a),e.page_load_time=window.performance.timing.domComplete-window.performance.timing.connectStart,e.hotspots_active=jsDPZ.app.customer.getCustomer().data.Session.hotspotsIsActive?jsDPZ.app.customer.getCustomer().data.Session.hotspotsIsActive:"",dpz.kiosk&&dpz.kiosk.isActive&&f.updateKioskProps(dpz.kiosk.getConfig()),e.poe=a&&a.poe||e.poe||"|",e},fire:{view:function(a){f.domCompletePromise.then(function(){b.view(a)})},link:function(c,d){var g=c?{eventData:c,el:c.currentTarget,trackedEventType:c.type}:{},h=c&&$(c.currentTarget);d=d||{},g.order_tip=d.order_tip||"",d.event_name&&(g.event_name=d.event_name),d.event_action&&(g.event_action=d.event_action),d.event_category&&(g.event_category=d.event_category),d.event_label&&(g.event_label=d.event_label),g.page_name=h&&h.attr("data-dpz-track-evt-pagename")||a,g.driving_time=d.driving_time||"",g.walking_time=d.walking_time||"",g.crow_fly_distance=d.crow_fly_distance||"",g.hotspot_id=d.hotspot_id||"",g.number_of_hotspots_shown=d.number_of_hotspots_shown||"0",g.store_id=d.store_id||"","test_side_selected"!==d.event_name&&"false"===e.ab_test||(g.ab_test=e.ab_test),d.event_name&&h&&h.is("[type=checkbox]")&&(g.event_name+="_"+(h.is(":checked")?"checked":"unchecked")),f.domCompletePromise.then(function(){b.link(g)})}},domCompletePromise:new Promise(function(a){"complete"===document.readyState?a():$(document).on("readystatechange",function(){"complete"===document.readyState&&a()})})};return $(document).on("trackedClick",function(a,b){var c=$(b);e.last_click=c.data("uri")+"|"+c.data("subgroup")+"|"+c.data("group")}),$(document).on("customerLogin.success customerLogout",function(){f.updateLoginStatus()}),jsDPZ.topic("site.onPage").subscribe(function(b){$(document).off("documentTitleSet"),b.title?(a=b.title.split(" -")[0],f.fire.view({eventData:b,title:a})):$(document).on("documentTitleSet",function(c,d){a=d.split(" -")[0],f.fire.view({eventData:b,title:a})})}),$(document).ready(function(){var a=["[data-dpz-track-evt]","a:not([data-dpz-no-track])","button:not([data-dpz-no-track])","input[type='submit']:not([data-dpz-no-track])"],b=["input[type='radio']:not([data-dpz-no-track])","input[type='checkbox']:not([data-dpz-no-track])"];$("body").off(".utag"),$("body").on("click.utag",a.join(", "),function(a){$(this).get(0).hasAttribute("data-dpz-stop-propagation")&&a.stopPropagation(),jsDPZ.topic("site.onTrackedEvent").publish(a)}),$("body").on("change.utag",b.join(", "),function(a){jsDPZ.topic("site.onTrackedEvent").publish(a)})}),jsDPZ.topic("site.onTrackedEvent").subscribe(function(a){f.fire.link(a)}),b.init(c,d,f.updateAll,!1),window.utag_data=e,{updateAll:f.updateAll,updateAbTest:f.updateAbTest,fire:f.fire,updateEstimatedTimes:function(a,b){e.lower_estimated_wait_minutes=a,e.upper_estimated_wait_minutes=b}}}()}),define("dpz.history",[],function(){var a={},b=function(){return JSON.parse(jsDPZ.util.sessionStorage("historyStates")||null)||[]}();return $.extend(!0,a,{back:function(){history.back()},replaceWithHash:function(a){var b=document.createElement("a");b.href=window.location.href,b.hash=a,window.location.replace(b)},replace:function(b){a.isHistoryEnabled()&&history.replaceState(b.state,b.title||document.title,b.url||document.location.href)},bindEvents:function(){a.isHistoryEnabled()&&($(window).on("popstate",function(){history.state&&history.state.overriden&&$(window).trigger("hashchange")}),$(window).on("hashchange",function(){site.data.hasLanded?site.data.stripParams&&(site.data.stripParams=!1,a.replace({url:window.location.href.replace(/\?[^#]+#/,"#")})):(site.data.hasLanded=!0,site.data.stripParams=!(!window.location.search||!window.location.hash),site.data.stripParams&&a.replace({state:{overriden:!0}}))}))},init:function(){a.bindEvents(),this.pushState()},pushState:function(){b.push({hash:document.location.hash,host:document.location.host,pathname:document.location.pathname.replace("/index.jsp","/")}),jsDPZ.util.sessionStorage("historyStates",JSON.stringify(b))},getStates:function(){return b},isHistoryEnabled:function(){return Modernizr.history}}),a.init(),a}),dpz.dietary=function(){var a=function(a,b){return!(!a.Variants||0===a.Variants.length)&&a.Variants[b.Code].Tags.sodiumWarningEnabled},b=function(b,c){return a(b,c)&&Object.keys(c.Toppings).length>=7};return{checkForSodium:function(c,d){var e=jsDPZ.app.catalog.getCatalog().data;if(!killConfig.isMarketEnabled("sodiumWarning")||!jsDPZ.app.store.getStore().data.IsSaltWarningEnabled)return!1;switch(c.toLowerCase()){case"pizza":return b(e,d);case"sandwich":case"wings":case"bread":case"pasta":return a(e,d);default:return!1}},getCaloricMessaging:function(a,b){return a&&a[b]&&a[b].calories&&a[b].calories.defaultText?jsDPZ.util.htmlUnEncode(a[b].calories.defaultText):jsDPZ.app.order.getOrder().data.Details.Variants.filter(function(a){return a.ID===b&&~a.Code.indexOf("STJUDE")}).length>0?"":dpz.template.translate("nutrition.no_nutrition_info")}}}(),define("dpz.deepLink",["simplr","dpz.cart","dpz.easyOrder"],function(a,b,c){function d(a){return!(!i||dpz.util.isEmpty(i[a]))}var e,f,g,h,i=dpz.util.getQueryParameters(),j={},k={},l=!1;return i&&(e=d("clearAccount"),f=d("clearOrder"),g=d("reset"),(h=d("clearSession")||e&&f||g)&&(site.sessionTools.remove(),a.browser.mLocalStorageCapable()&&localStorage.clear(),!g&&i.redirect||(i.redirect="homepage"))),site.sessionTools.load().then(function(){var a,g,m,n,o,p,q="",r="",s="",t=jsDPZ.app.order.getOrder().data,u=["redirect","couponCode","couponCode_0","variantCode","variantCode_0","orderVariantID","productCode","easyorder","storeid","zipcode","ordtype","streetName","streetNumber","lat","lng","saveEOHome","createEasyOrder","easyOrderReferrer","createEasyOrderProfile"],v={},w=!1;if(h||(e?(jsDPZ.app.customer.setCustomer({Session:jsDPZ.app.customer.getCustomer().data.Session}),site.storage.remove("CID")):f&&(jsDPZ.app.order.setOrder(),jsDPZ.app.store.setStore(),jsDPZ.app.customer.getCustomer().data.Session=jsDPZ.obj.customer().data.Session)),g=jsDPZ.app.customer.getCustomer().data.Session,dpz.util.isEmpty(i)||i.route||!Object.keys(i).filter(function(a){return~u.indexOf(a)}).length)a={wasDeepLinked:!1,doRedirect:function(){return this.savePromise.then(function(){window.location=urlConfig.root+"/?route=1"})}};else{switch(site.storage.save("dpz_route_url",window.location.search),i.redirect){case"homepage":q="/";break;case"menu":q="/pages/order/menu.jsp";break;case"giftcard":q="/pages/giftcard/";break;case"coupons":q="/pages/order/",s="#/section/Coupons/category/All/",w=!0;break;case"chicken":q="/pages/order/",s="#/section/Food/category/Wings/",w=!0;break;case"createprofile":q="/pages/customer/",s="#/customer/profile/new";break;case"groupOrdering":q="/pages/order/",s="#/section/GroupOrdering/category/Pizza/";break;case"loyalty":case"rewards":q="/pages/customer/",s="#/customer/rewards/";break;default:i.easyorder?(q="/",g.easyOrderDeepLink=!0):"required"!==i.auth||!site.func.customerSemiLoggedIn()&&site.func.customerLoggedIn()?(q="/pages/order/",d("redirect")&&(s="#"+i.redirect,w=!0)):g.authRequired=!0}Object.keys(i).forEach(function(a){var b=a.split("_");"productCode"===b[0]||"variantCode"===b[0]||"qty"===b[0]||"toppings"===b[0]||"sides"===b[0]?(dpz.util.isEmpty(j[b[1]])&&(j[b[1]]={productCode:"",code:"",qty:"1",toppings:"",sides:""}),j[b[1]]["variantCode"===b[0]?"code":b[0]]=i[a]):"couponCode"!==b[0]&&"promocode"!==b[0]||(l=!0,k[b[1]]={Code:i[a],Qty:1,suppressWizard:0})}),p=t.Details.Coupons.some(function(a){return a.Code.includes("LTY")}),l&&!p&&(t.Details.Coupons=[]),Object.keys(k).forEach(function(a){jsDPZ.app.order.getOrder().addCoupon(k[a])}),Object.keys(j).forEach(function(a){var b,c=j[a];dpz.util.isEmpty(c.productCode)?(b=site.catalogTools.orderVariantFromURLParameters(c),jsDPZ.app.order.getOrder().addVariant(b)):(r="&cmd=/product/"+c.productCode+"/builder/",c.productCode&&(r+="&code="+c.code))}),"rewards"!==i.redirect&&"loyalty"!==i.redirect||i.showlogin&&(g.ShowLogin=!0),d("orderVariantID")&&(r="&cmd=/order/variant/"+i.orderVariantID+"/"),["utm_campaign","utm_content","utm_medium","utm_source","utm_term"].forEach(function(a){v[a]=i[a]||""}),g.googleAd=v,g.routeParams=i,i.ordtype&&"string"===$.type(i.ordtype)&&(m="carryout"===i.ordtype.toLowerCase()?"Carryout":"Delivery",g.ServiceMethod=m,t.Details.ServiceMethod=m,site.storage.save("ServiceType",m)),i.zipcode&&$.isNumeric(i.zipcode)&&(t.Customer.Address.PostalCode=i.zipcode,g.Address.PostalCode=i.zipcode,site.storage.save("dpz_customer_address",jsDPZ.dataConversion.JSONObjectToString(g.Address))),i.storeid&&$.isNumeric(i.storeid)&&(t.Details.StoreID=i.storeid,g.StoreID=i.storeid),i.saveEOHome&&"true"===i.saveEOHome&&(jsDPZ.util.sessionStorage("save_eo_home",!0),q="/"),i.streetName&&"string"===$.type(i.streetName)&&(t.Customer.Address.StreetName=i.streetName,g.Address.StreetName=i.streetName),i.streetNumber&&$.isNumeric(i.streetNumber)&&(t.Customer.Address.StreetNumber=i.steetNumber,g.Address.StreetNumber=i.streetNumber),i.lat&&i.lng&&$.isNumeric(i.lat)&&$.isNumeric(i.lng)&&($.extend(!0,t.Customer.Address,{Coordinates:{Latitude:i.lat,Longitude:i.lng}}),$.extend(!0,g.Address,{Coordinates:{Latitude:i.lat,Longitude:i.lng}})),i.storeid&&i.ordtype&&i.zipcode&&i.couponCode&&(g.RouteAndShowCouponWizard=!0),n=urlConfig.root+q,o=n+"?route=1"+r+s,a={hashRoute:s,pageRoute:n,parameterRoute:r,wasDeepLinked:!!(q||s||r),routedURL:o,doRedirect:function(){return this.savePromise.then(function(){w&&site.func.setRedirect(o),site.func.toggleLoading(!0),window.location.assign(o)},function(a){DEBUG&&console.log("Router couldn't save session",JSON.stringify(a))})},afterStoreSelection:w}}d("partnerCode")&&(t.Partners[i.partnerCode]="true"),d("offertype")&&"loyalty"===i.offertype?g.sendLoyaltyEnrollmentPixel=!0:d("offercode")&&d("treatment")&&d("segment")&&d("storenumber")&&d("fcode")&&(t.Partners.YesMail={offercode:i.offercode,treatment:i.treatment,segment:i.segment,storenumber:i.storenumber,fcode:i.fcode});var x=killConfig.isMarketEnabled("createEasyOrderEnabled")&&d("createEasyOrderProfile")&&d("easyOrderReferrer")&&"microsite"===i.easyOrderReferrer;return killConfig.isMarketEnabled("createEasyOrderEnabled")&&d("createEasyOrder")&&(g.EasyOrderReferrer=i.easyOrderReferrer,c.placeInEasyOrderFlow()),x&&(window.location=urlConfig.root+"/pages/customer/#/customer/profile/new"),d("abtest")&&site.func.abtest.force(i.abtest),d("date")&&site.storage.save("testingDate",jsDPZ.util.htmlUnEncode(i.date)),a.savePromise=site.sessionTools.save(),$.Deferred(function(c){d("cartid")?b.getCart(i.cartid,i.storenumber,i.zip).always(function(){c.resolve(a)}):c.resolve(a)})})}),dpz.customer=$.extend({},dpz.customer,{getStatus:function(){return site.func.customerLoggedIn()?"loggedin":site.func.customerSemiLoggedIn()?"remembered":"anonymous"}}),dpz.optInOutTracking=function(){return{getSource:function(a){var b=[];return b.push("NOLO"),b.push(a),b.push(site.func.isHandheld()?"h":"d"),b.push(dpz.customer.getStatus()),b.join("_")}}}(),require(["simplr"],function(){function a(a){window.dpzRecaptchaReady&&delete window.dpzRecaptchaReady,e.resolve(a)}function b(a,b){var c=$.Deferred();return $("#"+a).addClass("recaptcha-container").after(dpz.template.assembleLayout({component:"recaptchaError",tokens:{}})),grecaptcha.render(a,{sitekey:b,callback:function(){c.resolve(grecaptcha.getResponse())},hl:dpz.market.activeLanguageCode}),c}function c(a){$("#"+a).addClass("error").next(".recaptcha-error").removeClass("is-hidden")}function d(a){$("#"+a).removeClass("error").next(".recaptcha-error").addClass("is-hidden")}var e=$.Deferred();return dpz.recaptcha={ready:e,jsLoaded:a,showError:c,hideError:d,insert:b},dpz.recaptcha}),define("dpz.postorderearn",["dpz.config"],function(){function a(){return b()?{}:{KillPOE:!0}}function b(){return killConfig.isMarketEnabled("loyaltyPostOrderEarn")&&killConfig.isMarketEnabled("loyaltyPostOrderEarnEmail")}function c(a){return jsDPZ.ajax.claimLoyalty({data:JSON.stringify(a),contentType:a.ecommOrderId?"ecom/json; charset=utf-8":"store/json; charset=utf-8"}).then(f,e)}function d(){return killConfig.isMarketEnabled("loyaltyPostOrderEarn")}function e(){return $.Deferred(function(a){a.reject({statusCode:"UnknownError"})}).promise()}function f(a){return $.Deferred(function(b){var c,d;a&&1===a.Loyalty.Response.Status?(d=a.Loyalty.Order.Earn,c=Object.keys(d).reduce(function(a,b){return a+d[b]},0),c>0?b.resolve({points:c,tracker:"tracker"===jsDPZ.app.customer.getCustomer().getSessionData().ClaimRewards.src}):b.reject({statusCode:"NotQualified"})):b.reject({statusCode:a.Loyalty.Response.StatusCode})}).promise()}return{getEmailKillSwitchTag:a,claimLoyalty:c,isActive:d,isEmailEnabled:b}}),define("inlineUpsells",[],function(){var a={cheeseUpsell:function(a,b,c,d,e,f){var g,h=Object.keys(b.data.Toppings.Pizza).filter(function(a){return b.data.Toppings.Pizza[a].Tags.Cheese&&e.data.Tags.DefaultToppings.includes(a+"=")}).pop()||"",i=b.getVariantOfProduct(e.data.ProductCode,e.data.FlavorCode,f.Code),j=!1;return killConfig.isMarketEnabled("cheeseInlineUpsell")&&c.data.Details.Variants[a].Toppings[h]&&!jsDPZ.util.empty(i)&&"1"===d.powerOrderData.Order.Products[a].Options[h]["1/1"]&&(d.powerOrderData.Order.Products[a].Options[h]["1/1"]=1.5,g=$.extend(!0,{},c.data.Details.Variants[a]),g.Toppings[h]["1/1"]="1.5",d.upsellProducts.push({Type:"cheeseUpsell",Variant:$.extend(!0,{},g,{Code:i.data.Code}),Size:b.getSizesData("Pizza",i.data.SizeCode).Name}),j=!0),j},sizeUpsell:function(a,b,c,d,e,f,g,h){var i=c.data.Details.Variants[a].UpsellWithNewCoupon||!1,j=0===d.data.Order.Coupons.length||d.data.Order.Coupons.filter(function(a){return"SJRD"===a.Code}).length>0,k=h?b.getVariantOfProduct(f.data.ProductCode,f.data.FlavorCode,h.Code):null,l=!1;return!killConfig.isMarketEnabled("checkoutSizeUpsell")||e.sizeItemSet||!j&&!i||f.data.SizeCode!==g.Code||!h||jsDPZ.util.empty(k)||c.data.hideSizeUpsell&&!i||(e.sizeItemSet=!0,d.powerOrderData.Order.Products[a].Code=k.data.Code,d.upsellProducts.push({Type:"sizeUpsell",Variant:$.extend(!0,{},c.data.Details.Variants[a],{Code:k.data.Code}),Size:b.getSizesData("Pizza",k.data.SizeCode).Name}),l=!0),l},lineItemUpsell:function(a,b,c,d,e){var f=d.data.Order.Coupons.length>0,g=dpz.market.marketConfig.upsells.lineItemUpsell.variantName,h=b.getVariant(g),i=function(a){return a.some(function(a){var b,c=jsDPZ.app.catalog.getCatalog().getVariant(a.Code);return!!(f&&c&&c.data&&(b=jsDPZ.app.catalog.getCatalog().getProduct(c.data.ProductCode))&&b.data&&1===a.Qty&&b.data.ProductType===dpz.market.marketConfig.upsells.lineItemUpsell.productType)})};!killConfig.isMarketEnabled("lineItemUpsell")||e.lineItemSet||void 0===b.getVariant(g).data||c.data.hideInlineUpsell||c.data.Details.Coupons.length>0&&i(c.data.Details.Variants)&&!c.data.hasSeenLineItemUpsell&&h&&(e.lineItemSet=!0,d.upsellProducts.push({Type:"lineItemUpsell",Variant:h,ID:a}),d.powerOrderData.Order.Products.push({ID:a,Code:h.data.Code,Qty:1,CategoryCode:dpz.market.marketConfig.upsells.lineItemUpsell.categoryCode,IsNew:!0,NeedsCustomization:!1,AutoRemove:!1,Fulfilled:!1,Tags:{}}))},upsellPriceOrder:function(a,b){b.forEach(function(b){b.UpsellWithNewCoupon&&a.powerOrderData.Order.Coupons.forEach(function(a){a.Code===b.UpsellWithNewCoupon.old&&(a.Code=b.UpsellWithNewCoupon.new)})}),jsDPZ.ajax.priceOrder({data:a.powerOrderData,headers:{"DPZ-Source":"DSSPriceOrder"},success:function(b){var c,d,e=function(c,d){var e,f;for(e=0,f=a.data.Order.Products.length;e<f&&(a.upsellProducts[c].Variant.ID!==a.data.Order.Products[e].ID||(a.upsellProducts[c].Price=b.Order.Products[d].Price-a.data.Order.Products[e].Price,killConfig.isMarketEnabled("cheeseInlineUpsell")));e++);},f=function(c){var d,f,g;for(d=0,f=b.Order.Products.length;d<f;d++)if(g=a.upsellProducts[c].Variant,g.ID===b.Order.Products[d].ID){g.UpsellWithNewCoupon?"LTY004"===g.UpsellWithNewCoupon.new&&3===b.Order.Products[d].Price&&e(c,d):e(c,d);break}};for(c=0,d=a.upsellProducts.length;c<d;c++)"lineItemUpsell"!==a.upsellProducts[c].Type&&f(c);a.data.UpsellProducts=a.upsellProducts,a.promise.resolve(a.data)},error:function(){site.func.powerCommunicationError()},complete:function(){site.func.toggleLoading(!1)}})}};return{doUpsell:function(b,c){var d,e,f,g,h,i=0,j={sizeItemSet:!1,lineItemSet:!1},k={data:b,promise:$.Deferred(),upsellProducts:[]},l=jsDPZ.app.order.getOrder(),m=jsDPZ.app.catalog.getCatalog();return site.func.toggleLoading(!0),site.func.getOrderForPowerData().then(function(n){var o,p=!1,q=dpz.loyalty.hasLoyaltyCoupon("LTY001");if($.extend(k,{powerOrderData:n}),l.data.Details.Variants.forEach(function(a,b){q&&0===a.Price?(p=b,a.UpsellWithNewCoupon={old:"LTY001",new:"LTY004"}):a.UpsellWithNewCoupon&&delete a.UpsellWithNewCoupon}),o=function(b,i){d=m.getVariant(b.Code),e=m.getProductSizesData(d.data.ProductCode)||[],f=e.map(function(a,b){return{current:a,next:e[b+1]}}).find(function(a){return a.current.Code===d.data.SizeCode}),g=f&&f.current,h=f&&f.next,c?a[c](i,m,l,k,d,g,h):"Pizza"!==b.CategoryCode||1!==b.Qty||jsDPZ.util.empty(d)||a.cheeseUpsell(i,m,l,k,d,g)||a.sizeUpsell(i,m,l,k,j,d,g,h)||a.lineItemUpsell(i,m,l,k,j)},!1!==p)o(k.data.Order.Products[p],p);else for(i;i<k.powerOrderData.Order.Products.length&&(!(k.upsellProducts.length>0)||killConfig.isMarketEnabled("checkoutSizeMultipleUpsells"));i++)o(k.data.Order.Products[i],i);jsDPZ.util.empty(k.upsellProducts)?k.promise.resolve(b):a.upsellPriceOrder(k,l.data.Details.Variants)}),k.promise}}}),define("dpz.cart",[],function(){return{getCart:function(a,b,c){return $.Deferred(function(d){jsDPZ.ajax.getCart({cartId:a}).then(function(a){jsDPZ.app.customer.getCustomer().data.Session.Cart=a.order,site.sessionTools.save().then(function(){site.storage.save("dpz_redirect_url","#/checkout/"),"Carryout"===a.order.ServiceMethod?window.location.href=urlConfig.root+"/pages/order/#/locate/?StoreID="+b+"&type="+a.order.ServiceMethod+"&c="+c||"&lang=en":window.location.href=urlConfig.root+"/pages/order/#/locate/?StoreID="+b+"&type="+a.order.ServiceMethod+"&s="+a.order.Address.Street+"&c="+a.order.Address.City+", "+a.order.Address.Region+" "+a.order.Address.PostalCode+"&lang=en",d.resolve()})}).fail(function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"ePowerCommunication"}),d.resolve()})})},autoPopulateCartFromCartObject:function(){var a,b,c=jsDPZ.app.customer.getCustomer().data.Session.Cart,d=jsDPZ.app.order.getOrder().data.Details,e=jsDPZ.app.customer.getCustomer().data,f={};for(d.Coupons=c.Coupons,d.Payments=c.Payments,e.Address=c.Address,e.Phone=c.Phone,a=0,b=c.Products.length;a<b;a++)f={Code:c.Products[a].Code,ID:-1,Price:0,Qty:c.Products[a].Qty,Toppings:c.Products[a].Options,isNew:!0},jsDPZ.app.order.getOrder().addVariant(f)}}}),define("dpz.breadTwistHoldouts",["simplr"],function(a){return{isTurnedOn:function(){return killConfig.isMarketEnabled("breadTwistHoldouts")&&(moment().isBefore("11/27/2017 03:00:00")||moment().isAfter("12/8/2017 03:00:00"))},couponInCart:function(){return jsDPZ.app.order.getOrder().data.Details.Coupons.filter(function(a){return"TWSTHOLD"===a.Code})},productInCart:function(){return jsDPZ.app.order.getOrder().data.Details.Variants.filter(function(a){return~site.data.breadTwistsCodes.indexOf(a.Code)})},getEmail:function(){var a;return a=jsDPZ.app.customer.getCustomer().data.Email?jsDPZ.app.customer.getCustomer().data.Email:"",a=$(".js-email").val().trim()?$(".js-email").val().trim():a},show:function(){$(".js-breadTwistHoldouts, .js-breadTwistHoldoutsOptions").removeClass("is-hidden"),$(".js-breadTwistHoldoutsLoading, .js-breadTwistHoldoutsLoaded").addClass("is-hidden")},showLoading:function(){$(".js-breadTwistHoldoutsLoading").removeClass("is-hidden"),$(".js-breadTwistHoldoutsOptions, .js-breadTwistHoldoutsLoaded").addClass("is-hidden")},hide:function(){$(".js-breadTwistHoldoutsOptions, .js-breadTwistHoldoutsLoading, .js-breadTwistHoldouts, .js-breadTwistHoldoutsLoaded").addClass("is-hidden")},showCompleted:function(){$(".js-breadTwistHoldoutsLoading, .js-breadTwistHoldoutsOptions").addClass("is-hidden"),$(".js-breadTwistHoldoutsLoaded, .js-breadTwistHoldouts").removeClass("is-hidden")},hasProductAndNoCoupon:function(){var a=this.couponInCart(),b=this.productInCart();return a&&0===a.length&&b&&b.length>0},hasProductAndCoupon:function(){var a=this.couponInCart(),b=this.productInCart();return a&&1===a.length&&a[0].Fulfilled&&b&&1===b[0].Price},hasMultipleProductsAndCoupon:function(){var a=this.couponInCart(),b=this.productInCart();return a&&1===a.length&&a[0].Fulfilled&&b&&(b.length>1||b.filter(function(a){return a.Qty>1}).length>0)},removeProductAndCoupon:function(){this.showLoading(),$(document).one("/order/coupon/delete/",function(){$(document).one("/order/variant/delete/",function(){a.controller.mRouteAndExecute("/checkout/payment/")}),a.controller.mRouteAndExecute("/order/variant/"+this.productInCart()[0].ID+"/delete")}.bind(this)),a.controller.mRouteAndExecute("/order/coupons/"+this.couponInCart()[0].ID+"/delete?renderCouponForm=false")},addProductAndCouponToCart:function(b){this.showLoading(),site.data.noScroll=!0,$(document).one("/order/variant/new/",function(){a.controller.mRouteAndExecute("/checkout/payment/")});var c=b.currentTarget.getAttribute("sides");a.controller.mRouteAndExecute("/order/variant/new?code="+b.currentTarget.value+"&qty=1&sides="+c+"&upsellCoupon="+site.data.breadTwistHoldoutCode)},checkForEligibility:function(){var a=this;site.data.breadTwistHoldoutCode="",jsDPZ.ajax.getTargetedOffer({offerId:"twist",email:this.getEmail(),orderId:jsDPZ.app.order.getOrder().data.Details.OrderID}).then(function(a){return!(!a||!a.promotion)&&jsDPZ.app.catalog.getCatalog().getHiddenCoupon(a.promotion)}).then(function(b){a.productInCart();b.fetched?(site.data.breadTwistHoldoutCode=b.coupon.data.Code,a.show(),(a.hasMultipleProductsAndCoupon()||a.hasProductAndNoCoupon())&&a.hide(),a.hasProductAndCoupon()&&!a.hasMultipleProductsAndCoupon()&&a.showCompleted(),dpz.utag.fire.link(void 0,{event_name:"TwistHold",event_action:"Update",event_category:"CouponWidget",event_label:"PromoCode"})):(a.hasProductAndCoupon()&&(a.removeProductAndCoupon(),site.func.overlayToggle(!0,"holdOutsRemovalWarning",{},{})),a.hide())}).fail(function(b){a.hasProductAndCoupon()&&(a.removeProductAndCoupon(),site.func.overlayToggle(!0,"holdOutsRemovalWarning",{},{})),a.hide()})}}});var Interface=function(a,b){if(2!=arguments.length)throw new Error("Interface constructor called with "+arguments.length+" arguments, but expected exactly 2.");this.name=a,this.methods=[];for(var c=0,d=b.length;c<d;c++){if("string"!=typeof b[c])throw new Error("Interface constructor expects method names to be passed in as a string.");this.methods.push(b[c])}};Interface.ensureImplements=function(a){if(arguments.length<2)throw new Error("Function Interface.ensureImplements called with "+arguments.length+" arguments, but expected at least 2.");for(var b=1,c=arguments.length;b<c;b++){var d=arguments[b];if(d.constructor!==Interface)throw new Error("Function Interface.ensureImplements expects two and above to be instances of Interface.");for(var e=0,f=d.methods.length;e<f;e++){var g=d.methods[e];if(!a[g]||"function"!=typeof a[g])throw new Error("Function Interface.ensureImplements: object does not implement the "+d.name+" interface. Method "+g+" was not found")}}};var PizzaDisplay=new Interface("PizzaDisplay",["setTopping","setToppings","setCrustType","toJSON"]);!function(){function a(a){var d=$("#"+a.id);0==d.length?$("body").append('<div id="'+a.id+'" class="'+a.className+'"></div>'):(d.removeClass(b).removeClass(c),$(a.closeSelector).off("click.layer.destroy."+a.id));var e=$("#"+a.id),f=!(null!=a.xPos&&null!=a.yPos);f&&(a.keepCentered&&e.addClass(c),$.layer.center(a.id)),e.html(a.defaultContent),f&&$.layer.center(a.id),$(a.closeSelector).on("click.layer.destroy."+a.id,function(b){b.preventDefault(),$.layer.destroy({id:a.id,closeSelector:a.closeSelector})})}var b="_centerLayer",c="_keepCenterLayer";$.layer={center:function(a){if(a){var d=$("#"+a),e=d.width(),f=d.height(),g=window.innerWidth||document.documentElement.clientWidth,h=window.innerHeight||document.documentElement.clientHeight,i=0;i=(g-e)/2,i=i<0?20:i,i+=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft;var j=0;j=(h-f)/2,j=j<0?20:j,j+=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,(e>g||f>h)&&d.hasClass(c)&&d.removeClass(c).addClass(b),d.css({top:j+"px",left:i+"px"})}},create:function(b){var c=$.extend({ajax:null,callback:null,className:"_layer",closeSelector:"#_layerClose",defaultContent:"",id:"_layer",isOverlay:!1,keepCentered:!1,xPos:null,yPos:null},b);if(c.isOverlay&&(c.id="_layer"==c.id?"_overlay":c.id,c.closeSelector="#_layerClose"==c.closeSelector?"#_overlayClose":c.closeSelector,c.xPos=0,c.yPos=0),a(c),null!=c.ajax){var d=c.ajax.success;c.ajax.success=function(b,e){c.defaultContent=b,a(c),$.isFunction(d)&&d(b,e)},$.ajax(c.ajax)}else $.isFunction(c.callback)&&c.callback();c.isOverlay&&$("#"+c.id).css({position:"fixed",width:"100%",height:"100%"}).on("click",function(a){a.preventDefault()})},destroy:function(a){var b=$.extend({id:"_layer",closeSelector:"#_layerClose"},a);b.id&&($("#"+b.id).remove(),$(b.closeSelector).off("click.layer.destroy."+b.id))}},$(function(){$(window).on("resize.layer",function(){$("."+c+",."+b).each(function(a,d){$(d).addClass(c).removeClass(b),$.layer.center($(d).attr("id"))})}).on("scroll.layer",function(){$("."+c).each(function(a,b){$.layer.center($(b).attr("id"))})})})}(),function(a){require(["simplr"],function(b){b.controller.mAddBases(["customer"]),b.controller.mAddCommands({customer_login_create:{route:["customer","login","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(c){if(dpz.loyalty.updateLoyaltyStatus(void 0,!0),site.trigger.onPage({route:c}),!site.func.customerLoggedIn()||site.isPaymentPage||site.isConfirmationPage){var d=a(".js-rememberMe").is(":checked")||site.rememberMe||site.func.customerSemiLoggedIn(),e=c.parameters.email;site.func.toggleLoading(!0),jsDPZ.ajax.customerLogin({data:{loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),rememberMe:d,u:c.parameters.email,p:c.parameters.password},success:function(e){if("true"===jsDPZ.util.sessionStorage("semiLoggedIn__loginEnrollAndPlaceOrder"))jsDPZ.util.sessionStorage("semiLoggedIn__loginEnrollAndPlaceOrder",!1),a(".js-paymentForm").submit();else{jsDPZ.app.order.getOrder().filterCoupons({filterFailure:!0,successFilter:function(a,b){return b.isLoyaltyCoupon()}}).done(function(a){a.length&&jsDPZ.app.customer.getCustomer().data.Session.authRequired&&require(["market/js/national-menu"],function(a){site.func.overlayToggle(!0,"eRoutingCouponOverlay",{},{code:jsDPZ.app.order.getOrder().data.Details.Coupons.length?"eRoutingCouponMessage":"eRoutingMessage",success:!0,nationalMenu:a,staticMenu:!0}),delete jsDPZ.app.customer.getCustomer().data.Session.authRequired,site.sessionTools.save()})});var f=jsDPZ.app.customer.getCustomer();jsDPZ.util.oauth.fallBackToBasicAuth()&&jsDPZ.util.basicAuth.authorization(c.parameters.email,c.parameters.password);var g;jsDPZ.app.customer.setCustomerFromPower(e),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty));f.data.Session.ShowRewards;if(delete f.data.Session.ShowRewards,void 0!==f.data.Session.EasyOrderReferrer&&""!==f.data.Session.EasyOrderReferrer&&(f.data.Session.CreateEasyOrder=!0),site.sessionTools.save(),d&&(site.storage.save("CID",f.data.CustomerID,365),site.storage.save("customerFirstName",f.data.FirstName,90)),f.fetchCreditCard({data:{rememberMe:d},complete:function(){jsDPZ.topic("fetchCreditCard.complete").publish(e)}}),killConfig.isActive("profileHomepage")||"true"===jsDPZ.util.sessionStorage("save_eo_home")&&killConfig.isMarketEnabled("saveEasyOrderSetupModal"))if(jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink)site.func.easyOrderDeepLink();else{var h=a("html").attr("lang")||"en";f.fetchOrderHistory({customerID:site.storage.load("CID"),loggedIn:site.func.customerLoggedIn(),loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),lang:h,success:function(c){if(c&&c.easyOrder&&(f.data.Session.EasyOrder=c.easyOrder,f.data.Session.hasEasyOrder=!0,site.sessionTools.save()),c.customerOrders&&c.customerOrders.length){var d=c.customerOrders[0];if(f.data.Session.RecentOrderCount=c.customerOrders.length,site.sessionTools.save(),site.isHomepage){a(document).trigger("/customer/profile/login/",f);var e=killConfig.isMarketEnabled("recentOrderItems")&&site.func.isHandheld();b.view.mRender({name:"order_history_view",data:{customerOrders:c,showRecentOrderItems:e},selector:"#orderHistory"}),b.view.mRender({name:"local_store_view",data:{customerOrder:d},selector:"#localStore"}),site.trigger.onPage({uri:"/home",group:"Home Page",subGroup:"Home Page",action:"view",base:urlConfig.root,title:"Profiled Home Page"})}site.func.updateMinorNavigation()}}})}if(site.func.updateMinorNavigation(),site.func.genericOverlayToggle({show:!1,viewName:"pizzaProfileLoginOverlay",UIBlockID:"overlayUIBlock3"}),jsDPZ.topic("customerLogin.success").publish(e),a(document).trigger("customerLogin.success",e),"data-claim-rewards"!==c.parameters.claimRewards||dpz.loyalty.isEnrolled()||(c.parameters.routeAfter=urlConfig.root+"/pages/customer/#/customer/profile/"),dpz.loyalty.notifyLoginError(),c.parameters.routeAfter)c.parameters.routeAndExecute?b.controller.mRouteAndExecute(c.parameters.routeAfter):window.location=c.parameters.routeAfter;else if(c.parameters.successCommand&&""!==c.parameters.successCommand)if(c.parameters.successCommand===dpz.loyalty.config.commands.enroll)if(-1!==window.location.hash.indexOf("#/customer/profile/")||-1!==window.location.hash.indexOf("#/customer/rewards/")){var i=function(){-1!==window.location.hash.indexOf("#/customer/profile/")?b.controller.mRouteAndExecute("/customer/profile/"):window.location.hash="#/customer/profile/",site.func.toggleLoading(!1)},j=function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"})};dpz.loyalty.enrollCustomer({successCallback:i,errorCallback:j})}else if(site.isHomepage){var i=function(){b.view.mRender({name:"loyalty_card_view",data:{},selector:".js-loyaltyContainer"}),site.func.toggleLoading(!1)},j=function(){b.view.mRender({name:"loyalty_card_view",data:{},selector:".js-loyaltyContainer"}),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"})};dpz.loyalty.enrollCustomer({successCallback:i,errorCallback:j})}else if(site.isPaymentPage){site.func.toggleLoading(!0);var i=function(){b.controller.mRouteAndExecute("/payment/checkout/?paymentPageRewardsEnrollment=1")},j=function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"})};dpz.loyalty.enrollCustomer({successCallback:i,errorCallback:j})}else dpz.loyalty.enrollCustomer();else if(c.parameters.successCommand===dpz.loyalty.config.commands.optOut)b.controller.mRouteAndExecute("/loyalty/opt-out/");else if(c.parameters.successCommand===dpz.loyalty.config.commands.redeem){var k=c.parameters.productUrl?jsDPZ.util.htmlUnEscape(c.parameters.productUrl):void 0;k&&("true"===c.parameters.keepCoupons?b.controller.mRouteAndExecute(k):window.location=k)}else c.parameters.successCommand===dpz.loyalty.config.commands.dashboard?dpz.loyalty.redirectToRewards():c.parameters.successCommand===dpz.loyalty.config.commands.claimRewards&&b.controller.mRouteAndExecute("#/customer/claim-rewards-enrollment-check/");else if(!c.parameters.semiLoggedIn||c.parameters.paymentPage||site.isConfirmationPage)if(c.parameters.setEasyOrder)c.parameters.selector?site.func.createEasyOrder(c.parameters.selector):site.func.overlayToggle(!0,"nameEasyOrder",{},{orderID:c.parameters.setEasyOrder},{});else if(c.parameters.setEasyOrderSelector)a(c.parameters.setEasyOrderSelector).trigger("click");else if(c.parameters.removeEasyOrder)site.func.overlayToggle(!0,"removeEasyOrder",{},{orderID:c.parameters.removeEasyOrder,easyOrderNickname:a(".js-removeEasyOrder").attr("data-easyordernickname")},{});else if(c.parameters.paymentPage){if(!c.parameters.semiLoggedIn){var l=c.parameters.paymentType;if(!site.easyOrderObj||"true"!==site.easyOrderObj.easyOrderSaveNow||"Cash"!==l&&"Credit"!==l)b.controller.mRouteAndExecute("/checkout/payment/");else{var m={};"Cash"===l?a.extend(m,{paymentType:"Cash"}):a.extend(m,{billingZip:c.parameters.billingZip,cardType:c.parameters.cardType,expirationMonth:c.parameters.expirationMonth,expirationYear:c.parameters.expirationYear,number:c.parameters.number,saveAndPlaceOrder:!1,securityCode:c.parameters.securityCode,paymentType:"Credit"}),b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/easyorder/create",parameters:m}))}}}else-1!==window.location.hash.indexOf("#/locations/")?b.controller.mRouteAndExecute(site.func.buildURL({url:"#/locations/",parameters:{login:!0}})):site.isPaymentPage?"true"===c.parameters.easyOrderSaveNow&&"Cash"===c.parameters.easyOrderPaymentType?(site.saveNow=!0,b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/easyorder/create",parameters:{paymentType:"Cash"}}))):"true"===c.parameters.easyOrderSaveNow&&"Credit"===c.parameters.easyOrderPaymentType?(site.saveNow=!0,b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/easyorder/create",parameters:{billingZip:c.parameters.billingZip,cardType:c.parameters.cardType,expirationMonth:c.parameters.expirationMonth,expirationYear:c.parameters.expirationYear,number:c.parameters.number,saveAndPlaceOrder:!1,securityCode:c.parameters.securityCode}}))):("true"===c.parameters.easyOrderSaveWhenPlacingOrder&&(site.saveWhenPlacingChecked=!0,f.fetchOrderHistory({customerID:site.storage.load("CID"),loggedIn:site.func.customerLoggedIn(),loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),lang:h,success:function(a){if(a.customerOrders&&a.customerOrders.length){a.easyOrder?a.easyOrder:a.customerOrders[0];f.data.Session.EasyOrder=a.easyOrder,f.data.Session.hasEasyOrder=!!a.easyOrder,site.sessionTools.save()}}})),g=site.func.buildURL({url:"#/checkout/payment/",parameters:{paymentPageRewardsEnrollment:void 0!==c.parameters.LoyaltyEnrollment}}),b.controller.mRouteAndExecute(g)):-1!==window.location.hash.indexOf("#/customer/login/")?"http://www.dominos.com/"===document.referrer?window.location=urlConfig.localRoot+"/index.jsp":window.location.hash="#/customer/profile/":-1!==window.location.hash.indexOf("#/customer/profile/new")?window.location.hash="#/customer/profile/":-1!==window.location.hash.indexOf("/checkout/")?(dpz.stjude.subscriptionRoundUp(),dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.isEnrolled()&&jsDPZ.app.order.getOrder().filterCoupons({filterFailure:!0,successFilter:function(a,b){return b.isLoyaltyCoupon()}}).done(function(c){c.length>0?b.controller.mRouteAndExecute("/order/price/?checkout=1"):dpz.loyalty.updateWidgets(a.extend(!0,{},dpz.loyalty.getSmallWidgetRules(),{data:{balance:{checkout:!0,useFullTitle:function(){return site.func.isHandheld()}}},parentSelector:".js-checkoutLoyaltyWidgets"})),a(".js-loyalty-widgets-container").show()})):-1===window.location.href.indexOf("/pages/customer/")||c.parameters.semiLoggedIn?-1!==window.location.href.indexOf("/pages/order/")&&-1!==window.location.hash.indexOf("/section/")&&dpz.loyalty.renderSmallWidget({selector:".js-myLoyaltyWidget"}):-1===window.location.hash.indexOf("#/customer/profile/")?jsDPZ.app.customer.getCustomer().data.Session.ShowRewards?(b.controller.mRouteAndExecute("/customer/rewards/"),site.sessionTools.save()):window.location.hash="#/customer/profile/":b.controller.mRouteAndExecute("/customer/profile/");else window.location=urlConfig.localRoot+"/pages/customer/#/customer/profile/"}},error:function(b){if((b.responseText.StatusItems||[]).find(function(a){return"PartiallyMigrated"===a.Code}))site.func.overlayToggle(!0,"codeOverlay",{},{code:"eProfileMigrated",label:e});else{site.trigger.onEvent({breadcrumb:["Customer","Login Error",b.status+" - "+b.statusText]}),site.isPaymentPage&&(a(".js-creditCardSelection").val()>=0&&a("input[name='Credit_Card_Selection'][value='-1']").click(),a(".js-saveToProfile").is(":checked")&&a(".js-saveToProfile").click(),a("#Easy_Order_Selection").is(":checked")&&(a("#Easy_Order_Selection").prop("checked",!1),a(".js-easyOrderLabel, #Easy_Order_Name").hide(),a("#Easy_Order_Name").val("")));var c=b.responseText,d="powerCustomer";c.StatusItems&&("NotAuthorized"==c.StatusItems[0].Field?d="powerCustomer":"NotAuthorizedForMarket"==c.StatusItems[0].Code&&(d="powerCustomerMarketEmailUsed")),site.func.overlayToggle(!0,"codeOverlay",{},{code:d})}}})}else window.location.href=urlConfig.root+"/pages/customer/#/customer/profile/"}},customer_logout_view:{route:["customer","logout","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){jsDPZ.app.order.getOrder().removeCoupons({successFilter:function(a,b){return b.isLoyaltyCoupon()}}),jsDPZ.app.customer.setCustomer({EmailOptIn:!1}),killConfig.isMarketEnabled("displayPricesEntreesPage")&&(jsDPZ.app.customer.getCustomer().data.Session.priceReorder=!0),jsDPZ.app.order.getOrder().data.Customer=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Customer),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),jsDPZ.app.store.getStore().data=a.extend(!0,{},jsDPZ.config.dataModel.STORE),jsDPZ.util.oauth.fallBackToBasicAuth()&&jsDPZ.util.basicAuth.revoke(),jsDPZ.ajax.customerLogout().always(function(){site.sessionTools.save().then(function(){site.storage.remove("CID"),site.storage.remove("customerFirstName"),site.func.toggleLoading(!0),setTimeout(function(){site.func.toggleLoading(!1),window.location.href=urlConfig.localRoot+"/index.jsp"},1e3),a(document).trigger("customerLogout")})})}},customer_guestcheckout_view:{route:["customer","guest-checkout","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){jsDPZ.ajax.customerLogout(),jsDPZ.util.oauth.fallBackToBasicAuth()&&jsDPZ.util.basicAuth.revoke(),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),site.sessionTools.save().then(function(){site.storage.remove("CID"),site.func.toggleLoading(!0),setTimeout(function(){site.func.toggleLoading(!1),window.location.href=urlConfig.localRoot+"/pages/order/payment.jsp"},1e3)})}},customer_semilogout_view:{route:["customer","semilogout","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){var c="true"==b.parameters.doRedirect;jsDPZ.app.customer.setCustomer(),jsDPZ.app.order.getOrder().data.Customer=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Customer),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),jsDPZ.util.oauth.fallBackToBasicAuth()&&jsDPZ.util.basicAuth.revoke(),site.sessionTools.save().then(function(){site.func.toggleLoading(!0),setTimeout(function(){site.func.toggleLoading(!1),c&&(window.location.href=urlConfig.localRoot+"/index.jsp")},1e3)})}},customer_profile_create:{route:["customer","profile","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(c){var d="true"===c.parameters.SaveCreditCard,e="true"===c.parameters.RememberMe,f="true"===c.parameters.EmailOptIn,g="true"===c.parameters.LoyaltyEnrollment,h=a.extend(!0,{},jsDPZ.app.customer.getCustomer().getCustomerForPower(),{FirstName:c.parameters.FirstName,LastName:c.parameters.LastName,Gender:c.parameters.Gender,Email:c.parameters.Email,Password:c.parameters.Password||c.parameters.Create_Password,Phone:c.parameters.Phone,PhonePrefix:killConfig.isMarketEnabled("staticPhonePrefix")?"":c.parameters.PhonePrefix,Extension:c.parameters.Extension,EmailOptIn:f,AgreeToTermsOfUse:!0,Age13OrOlder:!0,TaxInformation:{TaxType:c.parameters.TaxType,TaxID:c.parameters.TaxID,isDefault:!0}});jsDPZ.util.oauth.fallBackToBasicAuth()||(h.useOAuthNoBasicAuth=!0),!h.CustomerID||site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()||(h.CustomerID=""),dpz.loyalty.loyaltyIsOk()&&g&&a.extend(!0,h.Loyalty,{Command:"ENROLL"}),site.func.toggleLoading(!0),jsDPZ.ajax.customerSave({data:h}).then(function(f){jsDPZ.app.customer.getCustomer().data.Session.customerCreatedProfile=!0,jsDPZ.topic("customerLogin.success").publish(f);var h="true"===c.parameters.fromClaimRewards,i=dpz.loyalty.loyaltyIsOk()&&g,j=!1;i&&f.Loyalty&&f.Loyalty.Status&&(j="Success"===f.Loyalty.Status),jsDPZ.util.oauth.fallBackToBasicAuth()&&jsDPZ.util.basicAuth.authorization(c.parameters.Email,c.parameters.Password),jsDPZ.app.customer.setCustomerFromPower(f),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),site.sessionTools.save(),site.func.updateMinorNavigation(),site.trigger.onEvent({uri:"/account/newprofile",group:"Account",subGroup:"Registration Complete",title:"Created Profile from Payment Page"});var k=dpz.market.marketName;if("true"===c.parameters.EmailOptIn&&"UNITED_STATES"===k){var l=jsDPZ.app.order.getOrder().data,m=a.extend(!0,{},f),n=jsDPZ.app.store.getStore().data;jsDPZ.ajax.emailOptInAndOut({data:{FirstName:m.FirstName,LastName:m.LastName,Email:m.Email,EmailOptIn:!0,Street:l.Customer.Address.Street,City:l.Customer.Address.City,Region:l.Customer.Address.Region,PostalCode:l.Customer.Address.PostalCode,StoreID:n.StoreID,Source:dpz.optInOutTracking.getSource("ProfileNew")}})}i?(jsDPZ.app.customer.getCustomer().data.Loyalty?j?(jsDPZ.app.customer.getCustomer().data.Session.NewLoyaltyEnrollment=!0,site.sessionTools.save()):(jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError=!0,jsDPZ.app.customer.getCustomer().data.Session.ProfileCreated=!0,site.sessionTools.save()):dpz.loyalty.updateLoyaltyStatus(!1),site.trigger.onEvent({uri:"Checkout/asGuest/ActivateLoyalty",group:"Checkout as Guest Activate Loyalty",subGroup:"Checkout",title:"as Guest Activate Loyalty"})):!dpz.loyalty.loyaltyIsOk()&&g&&(jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError=!0,jsDPZ.app.customer.getCustomer().data.Session.ProfileCreated=!0,site.sessionTools.save()),c.parameters.routeAfter?window.location=c.parameters.routeAfter:h?b.controller.mRouteAndExecute("#/customer/claim-rewards-enrollment-check/?isNew=true"):killConfig.isMarketEnabled("gpmAdyen")||!d&&"true"!==c.parameters.saveAndPlaceOrder?-1===window.location.hash.indexOf("/customer/profile/new")||c.parameters.confirmationPage||(b.controller.mRouteAndExecute("/customer/profile/?isNew=true"),site.func.toggleLoading(!1)):(delete site.cardInfo,site.saveCard=!0,jsDPZ.app.customer.getCustomer().data.Session.NewProfile=!0,b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/creditcard/create",parameters:{billingZip:c.parameters.billingZip,cardType:c.parameters.cardType,expirationMonth:c.parameters.expirationMonth,expirationYear:c.parameters.expirationYear,nameOnCard:c.parameters.nameOnCard,nickName:c.parameters.nickName,number:c.parameters.number,securityCode:c.parameters.securityCode,isDefault:c.parameters.isDefault,saveAndPlaceOrder:c.parameters.saveAndPlaceOrder,saveEasyOrder:c.parameters.EasyOrderSaveNow}}))),(c.parameters.paymentsPage||c.parameters.confirmationPage)&&("true"===c.parameters.EasyOrderSaveNow?a(".js-profileCreateSaveEOToggle").toggle():a(".js-profileCreateToggle").toggle(),a(".js-ab-loyalty-grid").toggle(),"true"==c.parameters.SaveEasyOrder&&(site.easyOrderObj={easyOrder:c.parameters.SaveEasyOrder,easyOrderNickName:c.parameters.EasyOrderName,easyOrderSaveNow:c.parameters.EasyOrderSaveNow,easyOrderSaveWhenPlacingOrder:c.parameters.EasyOrderSaveWhenPlacingOrder,easyOrderPaymentType:c.parameters.PaymentType}),e&&(site.rememberMe=!0),c.parameters.isSaveCreditCard&&(site.saveCard=!0),site.trigger.onPage({title:"OC_loyalty_enrolled_popup"}),b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/login/create",parameters:{email:c.parameters.Email,password:c.parameters.Password,loyaltyEnrollment:void 0!==c.parameters.LoyaltyEnrollment,paymentPage:!!site.isPaymentPage||"",paymentType:c.parameters.PaymentType,billingZip:c.parameters.billingZip,cardType:c.parameters.cardType,expirationMonth:c.parameters.expirationMonth,expirationYear:c.parameters.expirationYear,nameOnCard:c.parameters.nameOnCard,nickName:c.parameters.nickName,number:c.parameters.number,securityCode:c.parameters.securityCode,isDefault:c.parameters.isDefault}})))}).fail(function(d){site.trigger.onEvent({breadcrumb:["Customer","Save Error",d.status+" - "+d.statusText]});var e=d.responseText,f="powerCustomerGenericError";e.StatusItems&&(f=site.func.getCustomerErrorKey(e.StatusItems[0].Field),a("#Pizza_Profile_Selection").prop("checked",!1)),"true"===c.parameters.saveAndPlaceOrder?(jsDPZ.app.customer.getCustomer().data.Session.NewProfile=!1,b.controller.mRouteAndExecute(site.func.buildURL({url:"#/order/place/new",parameters:{}}))):site.func.overlayToggle(!0,"codeOverlay",{},{code:f})}).always(function(){"false"===c.parameters.saveAndPlaceOrder&&site.func.toggleLoading(!1)})}},customer_reset_password_create:{route:["customer","reset-password","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){!!b.parameters.ABtestView&&b.parameters.ABtestView;site.func.toggleLoading(!0),jsDPZ.ajax.changePassword({data:{u:decodeURIComponent(b.parameters.email)},success:function(c){site.func.overlayToggle(!0,"codeOverlay",{},{code:"iForgotPasswordSuccess",label:b.parameters.email,abtestView:b.parameters.ABtestView,success:!0,title:"forms.reset_password"},function(){a("#genericOverlay .js-closeButton").on("click",function(){b.parameters.paymentPage&&(a("input[name='Payment_Type'][value='Credit']").is(":checked")&&a(".js-creditCardSelection").val()>=0&&a("input[name='Credit_Card_Selection'][value='-1']").click(),a("#Easy_Order_Selection").is(":checked")&&(a("#Easy_Order_Selection").prop("checked",!1),a(".js-easyOrderLabel, #Easy_Order_Name").hide(),a("#Easy_Order_Name").val("")))})})},error:function(a){site.trigger.onEvent({breadcrumb:["Customer","Forgot Password Error",a.status+" - "+a.statusText]}),site.func.powerCommunicationError()},complete:function(){site.func.toggleLoading(!1)}}),site.func.genericOverlayToggle({show:!1,viewName:"pizzaProfileLoginOverlay",UIBlockID:"overlayUIBlock3"})}}}),b.controller.mAddCommands({customer_location_view:{route:["customer","location","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){if(site.func.customerLoggedIn()){var c=jsDPZ.app.customer.getCustomer().data.Addresses,d=parseInt(b.resources.location,10);d>=0&&d<c.length&&site.func.overlayToggle(!0,"customer_location_view",{},a.extend(!0,{},{address:c[d],id:d,cmdData:b.parameters}))}else window.location.href=urlConfig.root+"/pages/customer/#/customer/login/"}},customer_location_create:{route:["customer","location","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){var c=jsDPZ.obj.customer(jsDPZ.app.customer.getCustomer().getCustomerForPower()).data,d=a.parameters;d.Latitude&&(d.Coordinates={Latitude:parseFloat(d.Latitude,10),Longitude:parseFloat(d.Longitude,10)},delete d.Latitude,delete d.Longitude),d.IsDefault="true"===d.IsDefault,d.IsDefault&&(c.Addresses=c.Addresses.map(function(a){return a.IsDefault=!1,a})),d.SaveToProfile="true"===d.SaveToProfile,c.Addresses.push(d),site.func.saveAccountData({data:c,success:function(a){site.trigger.onEvent({group:"Account",subGroup:"Add Location Complete",title:"Account - Add Location Complete",uri:"/account/addlocationcomplete"}),site.func.overlayToggle(!0,"addressChangeOverlay",{},{}),-1!==window.location.hash.indexOf("/customer/settings/")?b.controller.mRouteAndExecute("#/customer/settings/"):-1!==window.location.hash.indexOf("/customer/profile/")&&b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector})}})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}},customer_location_update:{route:["customer","location","update"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){for(var c=jsDPZ.obj.customer(jsDPZ.app.customer.getCustomer().getCustomerForPower()),d=c.data.Addresses,e=-1,f=a.resources.location.replace(/%3F/gi,"?").replace(/%2F/gi,"/"),g=0,h=d.length;g<h;g++)if(jsDPZ.util.htmlEscape(d[g].Name)==f||jsDPZ.util.htmlUnEscape(d[g].Name)==f){e=g;break}if(e>=0&&e<d.length){if(a.parameters.DeliveryInstructions&&!a.parameters.Region)d[e].DeliveryInstructions=a.parameters.DeliveryInstructions;else{if(!0===a.parameters.IsDefault||"true"===a.parameters.IsDefault){for(var i=0,j=d.length;i<j;i++)d[i].IsDefault=!1;d[e].IsDefault=!0}d[e].LocationName=a.parameters.LocationName,d[e].Street=a.parameters.Street,d[e].StreetName=a.parameters.StreetName,d[e].StreetNumber=a.parameters.StreetNumber,d[e].StreetRange=a.parameters.StreetRange,d[e].AddressLine2=a.parameters.AddressLine2,d[e].AddressLine3=a.parameters.AddressLine3,d[e].Neighborhood=a.parameters.Neighborhood,d[e].City=a.parameters.City,d[e].Region=a.parameters.Region,d[e].PostalCode=a.parameters.PostalCode,d[e].DeliveryInstructions=a.parameters.DeliveryInstructions,d[e].AddressType=a.parameters.Type,d[e].Name=a.parameters.Name,d[e].CampusID=a.parameters.CampusID,d[e].BuildingID=a.parameters.BuildingID,d[e].UnitNumber=a.parameters.UnitNumber,d[e].UnitType=a.parameters.UnitType,d[e].PropertyType=a.parameters.PropertyType,d[e].PropertyNumber=a.parameters.PropertyNumber}var k=a.resources.location,l=d[e].Name;site.func.saveAccountData({data:c.data,success:function(a){site.trigger.onEvent({group:"Account",subGroup:"Edit Location Complete",title:"Account - Edit Location Complete",uri:"/account/editlocationcomplete"});var c=jsDPZ.app.customer.getCustomer();c.data.Session.AddressSelection===k&&(c.data.Session.AddressSelection=l),site.func.overlayToggle(!1),site.func.overlayToggle(!0,"addressChangeOverlay",{},{}),-1!==window.location.hash.indexOf("/customer/profile/")?b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector}):-1!==window.location.hash.indexOf("#/locations/search/")?b.controller.mRouteAndExecute("/locations/"):-1!==window.location.hash.indexOf("/customer/settings/")&&b.controller.mRouteAndExecute("#/customer/settings/")}})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}},customer_location_delete:{route:["customer","location","delete"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){var c=jsDPZ.app.customer.getCustomer(),d=c.data.Session.AddressSelection,e=jsDPZ.obj.customer(c.getCustomerForPower()).data,f=e.Addresses,g=parseInt(a.resources.location,10),h=d===f[g].Name;g>=0&&g<f.length?(f.remove(g),site.func.saveAccountData({data:e,success:function(a){h&&(c.data.Session.AddressSelection="",site.sessionTools.save()),site.trigger.onEvent({group:"Account",subGroup:"Remove Location Complete",title:"Account - Remove Location Complete",uri:"/account/removelocationcomplete"}),-1!==window.location.hash.indexOf("/customer/profile/")?b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector}):-1!==window.location.hash.indexOf("/customer/settings/")&&b.controller.mRouteAndExecute("#/customer/settings/")}})):site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}}}),b.controller.mAddCommands({customer_card_view:{route:["customer","creditcard","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(b){if(site.func.customerLoggedIn()){var c=jsDPZ.app.customer.getCustomer().data.CreditCards,d=parseInt(b.resources.creditcard,10);d>=0&&d<c.length&&site.func.overlayToggle(!0,"customer_creditcard_view",{},a.extend(!0,{},c[d],{id:d}))}else window.location.href=urlConfig.root+"/pages/customer/#/customer/login/"}},customer_card_create:{route:["customer","creditcard","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){var c;"true"===a.parameters.saveAndPlaceOrder&&(c=!0,delete a.parameters.saveAndPlaceOrder);var d;"true"===a.parameters.saveEasyOrder&&(d=!0,delete a.parameters.saveEasyOrder),site.func.toggleLoading(!0),jsDPZ.app.customer.getCustomer().saveCreditCard({data:a.parameters,success:function(a){if(site.trigger.onEvent({group:"Account",subGroup:"Add Card Complete",title:"Account - Add Card Complete",uri:"/account/addcardcomplete"}),-1!==window.location.hash.indexOf("/customer/profile/")&&b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector}),c)for(var e=0,f=site.data.payments.length;e<f;e++)"CreditCard"==site.data.payments[e].Type&&(site.data.payments[e].CardID=a.id,delete site.data.payments[e].Number,delete site.data.payments[e].CardType,delete site.data.payments[e].Expiration,delete site.data.payments[e].SecurityCode,delete site.data.payments[e].PostalCode);d&&b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/easyorder/create",parameters:{paymentType:"Credit",cardId:a.id}}))},error:function(a){var b=a.responseText.error,c="powerCustomerGenericError";b.length&&"CardOnFileLimitExceeded"==b[0].code&&(c="powerCustomerMaxCreditCards"),site.func.overlayToggle(!0,"codeOverlay",{},{code:c})},complete:function(a){c?b.controller.mRouteAndExecute(site.func.buildURL({url:"#/order/place/new",parameters:{}})):site.func.toggleLoading(!1)}})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}},customer_card_update:{route:["customer","creditcard","update"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){var c=jsDPZ.obj.customer(jsDPZ.app.customer.getCustomer().data),d=c.data.CreditCards,e=parseInt(a.resources.creditcard,10);e>=0&&e<d.length?(a.parameters.isDefault?d[e].isDefault=!0:(d[e].expirationMonth=a.parameters.expirationMonth,d[e].expirationYear=a.parameters.expirationYear,d[e].nickName=a.parameters.nickName),site.func.toggleLoading(!0),jsDPZ.app.customer.getCustomer().updateCreditCard({data:d[e],success:function(){site.trigger.onEvent({group:"Account",subGroup:"Edit Card Complete",title:"Account - Edit Card Complete",uri:"/account/editcardcomplete"}),site.func.overlayToggle(!1),-1!==window.location.hash.indexOf("/customer/profile/")?a.parameters.isDefault?jsDPZ.app.customer.getCustomer().fetchCreditCard({complete:function(){b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector})}}):b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector}):-1!==window.location.hash.indexOf("/customer/settings/")?b.controller.mRouteAndExecute("#/customer/settings/"):b.view.mRender({name:"customer_creditcardlist_view",data:{justSelectCard:!0},selector:"#paymentCreditCardList"})},complete:function(a){site.func.toggleLoading(!1)}})):site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}},customer_card_delete:{route:["customer","creditcard","delete"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){if(site.func.customerLoggedIn()){var c=jsDPZ.app.customer.getCustomer().data.CreditCards,d=parseInt(a.resources.creditcard,10);d>=0&&d<c.length?(site.func.toggleLoading(!0),jsDPZ.app.customer.getCustomer().deleteCreditCard({data:{id:c[d].id},success:function(){site.trigger.onEvent({group:"Account",subGroup:"Remove Card Complete",title:"Account - Remove Card Complete",uri:"/account/removecardcomplete"}),-1!==window.location.hash.indexOf("/customer/profile/")?b.view.mRender({name:"customer_profile_view",data:{update:!0},selector:customerPageSelector}):-1!==window.location.hash.indexOf("/customer/settings/")&&b.controller.mRouteAndExecute("#/customer/settings/")},complete:function(){site.func.toggleLoading(!1)}})):site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}},customer_easyorder_create:{route:["customer","easyorder","create"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(c){if(site.func.customerLoggedIn()){var d=function(){site.func.getOrderForPowerData().then(function(d){jsDPZ.ajax.priceOrder({data:d,success:function(a){jsDPZ.util.sessionStorage("dpz_authorization")&&jsDPZ.util.sessionStorage("dpz_authorization")},error:function(a){site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})},complete:function(){site.func.toggleLoading(!1)}}).then(function(b){var d={order:b.Order},e=a.Deferred(),f=function(){jsDPZ.ajax.setEasyOrderExpress({data:JSON.stringify(d),success:function(a){},error:function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}}).then(function(a){e.resolve(a)})};d.easyOrder=!0,d.easyOrderNickName="My Domino's Favorite";var g={Type:"Cash"===c.parameters.paymentType?"Cash":"CreditCard",Amount:jsDPZ.app.order.getOrder().data.Details.Amounts.Customer},h=c.parameters.cardId;return h&&(g.CardID=h),d.order.Payments.push(g),"Cash"!=c.parameters.paymentType?a(".js-creditCardList .js-savedEntry input:checked")?(a.extend(g,{CardID:a(".js-creditCardList .js-savedEntry input:checked").closest(".js-savedEntry").data("cardid")}),f()):jsDPZ.app.customer.getCustomer().saveCreditCard({data:{billingZip:c.parameters.billingZip,cardType:c.parameters.cardType,expirationMonth:c.parameters.expirationMonth,expirationYear:c.parameters.expirationYear,nickName:"My Card",number:c.parameters.number,securityCode:c.parameters.securityCode,isDefault:!0},success:function(b){a.extend(g,{CardID:b.id,CardType:b.cardType,Expiration:("0"+b.expirationMonth).slice(-2)+String(b.expirationYear).substr(2,2),Number:b.lastFour,PostalCode:b.billingZip}),f()},error:function(a){var b=a.responseText.error,c="powerCustomerGenericError";b.length&&"CardOnFileLimitExceeded"==b[0].code&&(c="powerCustomerMaxCreditCards"),site.func.overlayToggle(!0,"codeOverlay",{},{code:c})}}):f(),e}).then(function(c){jsDPZ.app.customer.getCustomer().fetchOrderHistory({customerID:jsDPZ.app.customer.getCustomer().data.CustomerID,loggedIn:site.func.customerLoggedIn(),loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),lang:a("html").attr("lang")||"en",success:function(a){(a.customerOrders&&a.customerOrders.length||a.easyOrder)&&(jsDPZ.app.customer.getCustomer().data.Session.EasyOrder=a.easyOrder,site.sessionTools.save().then(function(){b.controller.mRouteAndExecute("/checkout/payment/")}))}})})})};site.func.toggleLoading(!0),!c.parameters.cardId&&c.parameters.number?(site.cardInfo={type:c.parameters.cardType,number:c.parameters.number,exMonth:c.parameters.expirationMonth,exYear:c.parameters.expirationYear,code:c.parameters.securityCode,zip:c.parameters.billingZip},site.savedEasyOrderPopulateCC=!0,d()):d()}else site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}}}),b.controller.mAddBases(["loyalty","rewards","checkout"]),b.controller.mAddCommands({loyalty_enroll_stopover:{route:["checkout","info","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){b.view.mRender({name:"loyalty_checkout_signin",data:{},selector:"#js-pageFull"}),site.func.updateMainNavigation({main:"checkout"})}},loyalty_activate_splash:{route:["rewards","activate","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){b.view.mRender({name:"loyalty_checkout_activate",data:{},selector:"#js-pageFull"}),site.func.updateMainNavigation({main:"checkout"})}},loyalty_profile:{route:["customer","rewards","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(c){var d=jsDPZ.app.customer.getCustomer().data,e=function(){dpz.loyalty.loyaltyIsActive()?dpz.loyalty.isEnrolled()&&dpz.loyalty.loyaltyIsOk()?(jsDPZ.ajax.fetchLoyaltySummary(d.CustomerID).then(function(c){a.extend(!0,d.Loyalty,c),delete d.Loyalty.CustomerID,site.sessionTools.save().then(function(){b.view.mRender({name:"loyalty_rewards_details",data:{},selector:customerPageSelector})})},function(a){dpz.loyalty.updateLoyaltyStatus(!1),b.view.mRender({name:"loyalty_enrollment_details",data:{},selector:customerPageSelector})}),site.func.updateMainNavigation({main:"profile",sub:"loyalty"})):(b.view.mRender({name:"loyalty_enrollment_details",data:{},selector:customerPageSelector}),site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()?site.func.updateMainNavigation({main:"profile",sub:"loyalty"}):site.func.updateMainNavigation({main:"guest",sub:"loyalty"})):(b.view.mRender({name:"page_not_found",data:{},selector:customerPageSelector}),site.func.updateMainNavigation({main:"restricted"}))};site.func.customerSemiLoggedIn()&&""===d.CustomerID&&site.storage.load("CID")?(site.func.toggleLoading(!0),jsDPZ.ajax.customerLogin({data:{rememberMe:!0,loyaltyIsActive:dpz.loyalty.loyaltyIsOk()},success:function(b){jsDPZ.app.customer.setCustomerFromPower(b),dpz.loyalty.loyaltyIsActive()&&(jsDPZ.app.order.getOrder().data.Details.Loyalty=a.extend(!0,{},jsDPZ.config.dataModel.ORDER.Details.Loyalty)),jsDPZ.app.customer.getCustomer().fetchCreditCard({success:function(a){e(),site.func.updateMinorNavigation()},complete:function(){site.func.toggleLoading(!1)},data:{rememberMe:!0}})},error:function(a,b,c){site.func.powerCommunicationError()}})):e(),site.trigger.onPage({title:"Piece of the Pie",uri:"/customer/rewards",group:"Customer"})}},loyalty_opt_out:{route:["loyalty","opt-out","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){site.trigger.onEvent({group:"Loyalty",subGroup:"OptOut",title:"Loyalty Opt Out",uri:"/Loyalty/OptOut/"}),site.func.overlayToggle(!0,"loyaltyOptOut",{},{})}}}),b.controller.mAddCommands({content_page:{route:["content","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(c){var d=dpz.config.getMarketProperty("contentPages"),e=c.resources.content;if(d&&d.pages&&d.pages[e]){var f=d.pages[e];site.func.updateMainNavigation({main:e,isContentPage:!0});var g=a.extend(!0,{},{title:f.title?f.title:"content_"+e,titleIsKey:!0,uri:"/#/content/"+e+"/",group:"content",subGroup:e},f.webTrends),h={modifier:e,template:f.template?f.template:e,pageData:g};c.parameters.view&&(h.view=c.parameters.view),b.view.mRender({name:"content_page",data:h,selector:".js-contentPage"}),a(".js-contentWrap").toggleClass("content-wrap--full-header",!0)}else site.func.updateMainNavigation({main:"restricted",isContentPage:!1}),b.view.mRender({name:"page_not_found",data:{},selector:".js-contentPage"})}}}),b.controller.mAddCommands({kiosk_activation:{route:["kiosk-activation","view"],isAuthorizedMethod:dpz.oauth.isAuthorized(["anonymous"]),authorized:function(a){b.view.mRender({name:"kiosk_activation",data:{},selector:".js-contentPage"})}}})}),define("siteViews/BogoWeekPopup",["simplr"],function(b){b.view.mAddViews({BogoWeekPopup:{html:function(a){var b="en"===dpz.market.activeLanguageCode&&"US"===dpz.market.marketCode,c="bogo-week-popup__container pizza-box";return a.popUpSelector="BogoWeekPopup",b&&(c+=" english-us-market pizza-box"),dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:a.popUpSelector,tokens:{dateRange:site.func.homepageWeekPopupConfig.friendlyDate()}},customClass:c}})},callback:function(b,c){site.func.stackAttack("#"+c.popUpSelector),a(".js-orderNow","#"+c.popUpSelector).click(function(a){a.preventDefault(),window.location.href=urlConfig.root+"/pages/order/?couponCode_0=9206&partnerCode=DOMINOS&so=hp&ordtype=Carryout"}),a(".js-closeButton, .js-noThanks","#"+c.popUpSelector).click(function(b){b.preventDefault(),site.func.overlayToggle(!1,c.popUpSelector,{},{}),a("#BogoWeekPopup").fadeOut(),site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()||site.func.isHandheld()||site.func.signInPopup()})}}})}),define("siteViews/CosWeekPopup",["simplr"],function(b){b.view.mAddViews({CosWeekPopup:{html:function(a){return a.popUpSelector="CosWeekPopup",dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:a.popUpSelector,tokens:{dateRange:site.func.homepageWeekPopupConfig.friendlyDate()}},customClass:"cos-week-popup__container overlay-wrap--center"}})},callback:function(b,c){a(".js-orderNow","#"+c.popUpSelector).click(function(a){a.preventDefault(),window.location.href=urlConfig.root+"/pages/order/?couponCode_0=9159&partnerCode=DOMINOS&so=hp&ordtype=Carryout"}),a(".js-closeButton, .js-noThanks","#"+c.popUpSelector).click(function(b){if(b.preventDefault(),site.func.overlayToggle(!1,c.popUpSelector,{},{}),a("#CosWeekPopup").fadeOut(),!(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()||site.func.isHandheld())){a(".js-sign-in--pop-up");site.func.signInPopup()}})}}})}),define("siteViews/Week50OffPopup",["simplr"],function(b){b.view.mAddViews({Week50OffPopup:{html:function(a){a.popUpSelector="Week50OffPopup";var b="week-50-off-popup__container pizza-box",c={component:"genericOverlay",tokens:{overlayContent:{component:a.popUpSelector,tokens:{dateRange:site.func.homepageWeekPopupConfig.friendlyDate()}},customClass:b}};return dpz.template.assembleLayout(c)},callback:function(b,c){site.func.stackAttack("#"+c.popUpSelector),a(".js-orderNow","#"+c.popUpSelector).click(function(a){a.preventDefault(),window.location.href=urlConfig.root+"/pages/order/?couponCode_0=9413&partnerCode=DOMINOS&so=hp"}),a(".js-closeButton, .js-noThanks","#"+c.popUpSelector).click(function(b){if(b.preventDefault(),site.func.overlayToggle(!1,c.popUpSelector,{},{}),a("#Week50OffPopup").fadeOut(),!(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()||site.func.isHandheld())){a(".js-sign-in--pop-up");site.func.signInPopup()}})}}})}),define("siteViews/addressChangeOverlay",["simplr"],function(b){b.view.mAddViews({addressChangeOverlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"addressChangeOverlay",tokens:{}}}})},callback:function(b,c){"handheld"!==site.func.getCurrentBreakpoint()&&a(".card--overlay").css("width","600px"),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:b})}}})}),define("siteViews/address_predictions",["simplr"],function(b){b.view.mAddViews({address_predictions:{html:function(a){return dpz.template.assembleLayout({component:"typeaheadDropdown",tokens:{predictions:a.predictions&&a.predictions.map(function(a){return{description:a.description||a,place_id:a.place_id||a}}),showArrows:!(!(a.predictions&&a.predictions.length>3)||killConfig.isMarketEnabled("googleMapsAddressAutocomplete"))}})},callback:function(b,c){c.searchBox.off("keydown").on("keydown",function(d){var e=d.keyCode,f=a(".js-addressPrediction",b),g=f.filter(".active"),h=a.extend(!0,{13:function(){c.searchBox.triggerHandler("blur"),jsDPZ.topic("place_selected").publish(g.attr("data-placeid")||c.searchBox.val()),a(b).empty()},27:function(){f.is(".active")&&a(this).val(a(this).attr("data-value")),a(b).empty()},38:function(){h.toggleActive("prev")},40:function(){f.last().is(".active")||(f.is(".active")?h.toggleActive("next"):(a(this).attr("data-value",a(this).val()),f.eq(0).toggleClass("active"),h.populateInput()))},toggleActive:function(a){g.toggleClass("active")[a]().toggleClass("active"),h.populateInput()},populateInput:function(){a(this).val(a(".js-addressPrediction.active",b).text()||a(this).attr("data-value"))}.bind(this)},c.keyBindings);h.hasOwnProperty(e)&&(d.preventDefault(),h[e].call(this))});var d;c.searchBox.on("blur",function(b){var c=this,d=function(){a(c).val(a(this).html()),jsDPZ.topic("place_selected").publish(a(this).attr("data-placeid"))};a(".js-addressPrediction").hover(d).click(d)}),jsDPZ.topic("address.predictions.update").subscribe(function(c){a(b).empty().append(this.html({predictions:c})),!killConfig.isMarketEnabled("googleMapsAddressAutocomplete")&&c.length>3&&(d=site.func.eventScrollY({speed:5,scrollContent:"ul.address-typeahead__predictions.js-addressPredictions",up:{actionTrigger:".up-anchor",startAction:"focus",stopAction:"blur"},down:{actionTrigger:".down-anchor",startAction:"focus",stopAction:"blur"}})),0===c.length&&a(b).html(""),a(".js-addressPrediction",b).on("click",function(c){d&&d.isScrolling()?d.stopAnimation(!1):(a(b).empty(),d&&d.stopAnimation(!0))})}.bind(this))}}})}),define("siteViews/bubbleCodeOverlay",["simplr"],function(b){b.view.mAddViews({bubbleCodeOverlay:{html:function(b){var c=a.extend({success:!1,code:"",label:""},b);return dpz.template.assembleLayout({component:"bubbleCodeOverlay",tokens:{codeClass:c.success?"informationText":"errorText",message:dpz.template.translateError(c.code,c.label)}})},callback:function(b,c){var d=a(b).text().split(" ").length/5*1e3;clearTimeout(site.data.bubbleOverlayTimeout),site.data.bubbleOverlayTimeout=setTimeout(function(){site.func.bubbleOverlayToggle(!1)},d),a(".js-closeButton",b).click(function(a){a.preventDefault(),clearTimeout(site.data.bubbleOverlayTimeout),site.func.bubbleOverlayToggle(!1)})}}})}),define("siteViews/claimRewardsOrderDetailsInfo",["simplr","dpz.postorderearn"],function(a,b){a.view.mAddViews({claimRewardsOrderDetailsInfo:{html:function(a){var c=b.isEmailEnabled();return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"claimRewardsOrderDetailsInfo",tokens:{isEmailEnabled:c,orderReceiptClassName:c?"grid__cell--1/2@desktop":"",orderReceiptSpacer:c&&!site.func.isHandheld()?"":"rewards-order-location__receipt--top"}}}})},callback:function(a,b){site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:a}),site.func.setupLayerCloseEvents({closeSelector:"[data-hook='close-button']",layerSelector:a,callback:function(){window.scrollTo(0,0)}})}}})}),define("siteViews/codeOverlay",["simplr"],function(b){b.view.mAddViews({codeOverlay:{html:function(b){var c,d=a.extend({success:!1,code:"",label:"",title:""},b);return c="array"===a.type(d.label)?d.label:[d.label],dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"codeOverlay",tokens:{routeHeading:"eRoutingMessage"===d.code?"blk":"",couponHeading:"eRoutingCouponMessage"===d.code?"blk":"",defaultHeading:"eRoutingCouponMessage"!==d.code&&"eRoutingMessage"!==d.code?"":"none",codeClass:d.success?"informationText":"errorText",message:dpz.template.translateError(d.code,c),title:d.title}}}})},callback:function(b,c){var d=a.extend({recoverable:!0},c);dpz.utag.fire.link(void 0,{event_name:c.code,event_action:"error",event_category:"error"}),site.trigger.onEvent({uri:"/error/"+c.code,title:"Error or Alert "+c.code,group:"Error",subGroup:c.code,eventType:"error"}),d.recoverable?(site.func.setupLayerCloseEvents({layerSelector:b}),a(".js-continueButton",b).click(function(b){b.preventDefault();var c=a(this).attr("href");site.func.toggleLoading(!0),setTimeout(function(){site.func.toggleLoading(!1),site.func.overlayToggle(!1),window.location=c},1500)})):a(".js-closeButton",b).remove()}}})}),define("siteViews/confirmOverlay",["simplr"],function(b){b.view.mAddViews({confirmOverlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"confirmOverlay",tokens:{message:dpz.template.translateError(a.code)}}}})},callback:function(b,c){site.trigger.onEvent({uri:"/error/"+c.code,title:"Error or Alert "+c.code,group:"Error",subGroup:c.code,eventType:"error"}),a(".js-continue",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1),c.continueFunc&&c.continueFunc()}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:b,callback:function(){c.cancelFunc&&c.cancelFunc()}})}}})}),define("siteViews/contentOverlay",["simplr"],function(b){b.view.mAddViews({contentOverlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"contentOverlay",tokens:{klass:a.klass}}}})},callback:function(b,c){if(dpz.util.isEmpty(c.url)){if(!dpz.util.isEmpty(c.template)){var d=c.templateData?c.templateData:{},e=dpz.template.assembleLayout({component:c.template,tokens:d});a(".js-content",b).html(e)}}else a.ajax({url:c.url,data:{type:"layer"},success:function(c){a(".js-content",b).html(c)}});dpz.kiosk.isActive&&a(".js-content").on("scroll",function(b){a(document).trigger("scroll.kioskTimeout")}),site.func.setupLayerCloseEvents({layerSelector:b}),site.func.setupTemplatePopups(b)}}})}),define("siteViews/content_page",["simplr"],function(b){b.view.mAddViews({content_page:{html:function(a){return dpz.template.assembleLayout({component:"contentPage",tokens:{modifier:a.modifier,template:{component:a.template,tokens:{}}}})},callback:function(b,c){var d;site.trigger.onPage(c.pageData),c.view?(d="."+c.view,a("#homeWrapper").hide(),a(".js-contentPage").show(),site.func.animateScroll("html, body",d,!site.func.isHandheld())):a("html, body").animate({scrollTop:0},10),"cookiePolicy"===c.template&&a(".js-gaOptOut").on("click",function(a){var b,c;a.preventDefault(),b=dpz.config.getMarketProperty("thirdParty").googleAnalytics[envConfig],c="ga-disable-"+b,document.cookie=c+"=true; expires=Thu, 31 Dec 2099 23:59:59 UTC; path=/",window[c]=!0})}}})}),define("siteViews/cookieBanner",["simplr"],function(b){b.view.mAddViews({cookieBanner:{html:function(a){return dpz.template.assembleLayout({component:"cookiesHeader",tokens:{}})},callback:function(b,c){if(site.func.isHandheld()){a(".cookie-policy-banner").outerHeight();a("header[role='banner'], .js-contentWrap").css("margin-top",a(".cookie-policy-banner").outerHeight())}a(".js-cookie-close").on("click",function(){a(".cookie-policy-banner").hide(),site.func.isHandheld()&&a("header[role='banner'], .js-contentWrap").css({"margin-top":"0"})}),a(document).on("/breakpoint/change/handheld/ /breakpoint/change/desktop/",function(){var b=site.func.isHandheld()?a(".cookie-policy-banner").outerHeight():0;a("header[role='banner'], .js-contentWrap").css("margin-top",b)})}}})}),define("siteViews/couponUpsellOverlay",["simplr"],function(b){b.view.mAddViews({couponUpsellOverlay:{html:function(a){var b="";return a.upsellCoupon?(site.trigger.onPage({title:"Pan Upsell Overlay",savePreviousState:!0}),b="#/order/coupons/new?code="+a.upsellCoupon+"&qty=1"):a.appCoupon&&(site.trigger.onPage({title:"App Coupon Overlay",savePreviousState:!0}),b=urlConfig.root+"/pages/order/?couponCode_0="+a.appCoupon+"&partnerCode=DOMINOS&so=hp"),dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"couponUpsellOverlay",tokens:{panelName:jsDPZ.util.htmlUnEncode(a.upsellName),coupon:b,description:jsDPZ.util.htmlUnEncode(a.upsellDescription),couponPrice:dpz.template.translateMoney(a.couponPrice),imageName:a.upsellImageName}}}})},callback:function(b,c){site.func.fixMissingImages(a("img",b));var d=a.extend({recoverable:!0},c);a(".card--overlay").addClass("card--overlay--large"),d.recoverable||a(".js-closeButton",b).not(".btn").remove(),dpz.util.isEmpty(c.url)||a.ajax({url:c.url,data:{type:"layer"},success:function(c){a(".js-content",b).html(c)}}),site.func.setupLayerCloseEvents({layerSelector:b,closeSelector:".js-closeButton, .js-nothanks, .js-continue",callback:function(b){a(b).is(".js-nothanks")||a(b).is(".js-closeButton")?site.func.overlayToggle(!1):a(b).is(".js-continue")&&(window.location.href=a(b).attr("href"))}})}}})}),define("siteViews/customerPasswordUpdated",["simplr"],function(b){b.view.mAddViews({customerPasswordUpdated:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"customerPasswordResetConfirmation",tokens:{title:"customer.password_updated",message:dpz.template.translateError(a.code?a.code:"eGenericPointOfServiceError"),confirm:"customer.continue_to_sign_in",codeClass:a.success?"informationText":"errorText"}}}})},callback:function(b){a(".js-closeButton").click(function(a){a.preventDefault(),site.func.overlayToggle(!1),site.func.toggleLoading(!0),window.location=urlConfig.localRoot+"/index.jsp"}),a(".js-confirm").click(function(a){a.preventDefault(),site.func.overlayToggle(!1),site.func.toggleLoading(!0),site.func.doLoginRedirectAndShowPopup(a,{forceRedirect:!0})})}}})}),define("siteViews/customerResponsiveLogin",["simplr"],function(b){b.view.mAddViews({customerResponsiveLogin:{html:function(b){return a.Deferred(function(c){var d,e=!(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()),f=site.isConfirmationPage,g=!1,h=0===window.location.hash.indexOf("#/section/Food/category/")&&-1===window.location.hash.indexOf("AllEntrees/"),i=killConfig.isMarketEnabled("allEntreesStyleNationalMenu")&&(b.showNationalMenuBackButton||b.showBackButton)&&"#/menu/category/viewAll/"!==window.location.hash&&window.location.hash.indexOf("#/menu/category/")>-1;b=b||{},g=!!b.backLink,g||e||i?a(".js-contentWrap").toggleClass("content-wrap--full-header",!0):0===window.location.hash.indexOf("#/menu/category/viewAll/")&&a(".js-contentWrap").toggleClass("content-wrap--full-header",!1),b.backLink&&(d={href:"#"},b.backLink.href?d.href=b.backLink.href:b.backLink.hash&&(d.href=b.backLink.hash),d.text=b.backLink.text||""),c.resolve(dpz.template.assembleLayout({component:"customerResponsiveLogin",tokens:{message:b.message||"",renderData:g||e&&!f,showCustomBackLink:!!d,backlink:d,showBackButton:!!(h||d||i)}}))})},callback:function(b,c){var d=c.backLink&&"#/customer/rewards/"===c.backLink.hash,e=c.backLink&&"/en/pages/order/confirmation.jsp"===c.backLink.hash,f=window.location.hash.indexOf("#/menu/category/")>-1,g=site.func.customerLoggedIn()||site.func.customerSemiLoggedIn();killConfig.isMarketEnabled("allEntreesStyleNationalMenu")&&(f&&"#/menu/category/viewAll/"!==window.location.hash?a(".js-contentWrap").toggleClass("content-wrap--full-header",!0):"#/menu/category/viewAll/"===window.location.hash&&g&&a(".js-contentWrap").toggleClass("content-wrap--full-header",!1)),a(".js-login--responsive").on("click",function(b){b.preventDefault();var c=site.func.getSignInData(a(b.target));site.func.doLoginRedirectAndShowPopup(b,c)}),d||e||a(".js-miniNavBackBtn").on("click",function(a){a.preventDefault(),killConfig.isMarketEnabled("allEntreesStyleNationalMenu")&&f?dpz.history.back():window.location.hash="#/section/Food/category/AllEntrees/"})}}})}),define("siteViews/deliveryTrackerPromotion",["simplr"],function(b){b.view.mAddViews({deliveryTrackerPromotion:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"deliveryTrackerPromotion",tokens:{}},customClass:"driver-tracker-promotional-overlay"}})},callback:function(b,c){var d,e=a(b);d=setTimeout(function(){e.fadeOut("slow")},4e3),e.on("mouseover",function(){clearTimeout(d)}),e.on("mouseleave",function(){d=setTimeout(function(){e.fadeOut("slow")},2e3)}),a(".js-driverTrackerPromotionalOverlayContainer").on("click",function(){e.fadeOut(),site.func.animateScroll("html, body",".js-smsOptInAnchor",!0)}),a(".js-closeButton",b).click(function(a){a.preventDefault(),e.addClass("is-hidden")})}}})}),define("siteViews/domChatButton",["simplr"],function(b){b.view.mAddViews({dom_chat_button:{html:function(){return dpz.template.assembleLayout({component:"domChatInvoke",tokens:{}})},callback:function(b){var c,d=a(".js-chatModal"),e=a(".js-domChatModalOverlay");site.func.stackAttack(b),a(window).on("hashchange",function(){a(".js-domBtn, .js-chatModalClose, .js-chatModalButtonCancel, .js-chatModalButtonConfirm").off("click"),a(".js-domChat").empty()}),a(".js-domBtn").on("click",function(a){a.preventDefault(),0!==jsDPZ.app.order.getOrder().data.Details.Variants.length||""!==jsDPZ.app.customer.getCustomer().data.Session.StoreID?(d.toggleClass("dom-chat__modal--zoom"),e.toggleClass("is-hidden"),c=0!==jsDPZ.app.order.getOrder().data.Details.Variants.length?"Cart not empty":"Store selected",dpz.utag.fire.link(void 0,{event_name:"Dom Popup Warning - "+c,event_action:"error",event_category:"error"})):window.location.href="/chat-pizza-order/"}),a(".js-chatModalClose").on("click",function(){d.toggleClass("dom-chat__modal--zoom"),e.toggleClass("is-hidden"),dpz.utag.fire.link(void 0,{event_name:"Dom Popup Warning - Close (X)",event_action:"click",event_category:"button"})}),a(".js-chatModalButtonCancel").on("click",function(){d.toggleClass("dom-chat__modal--zoom"),e.toggleClass("is-hidden"),dpz.utag.fire.link(void 0,{event_name:"Dom Popup Warning - STAY ON DOMINOS.COM",event_action:"click",event_category:"button"})}),a(".js-chatModalButtonConfirm").on("click",function(){d.toggleClass("dom-chat__modal--zoom"),dpz.utag.fire.link(void 0,{event_name:"Dom Popup Warning - Talk to Dom",event_action:"click",event_category:"button"}),window.location.href="/chat-pizza-order/"})}}})}),define("siteViews/eRoutingCouponOverlay",["simplr"],function(b){b.view.mAddViews({eRoutingCouponOverlay:{html:function(b){var c=a.extend({success:!1,code:"",label:""},b),d=("array"===a.type(c.label)?c.label:c.label,jsDPZ.app.order.getOrder().data.Details.Coupons[0].Code),e=b.nationalMenu.Coupons[d],f=e&&e.ImageCode?e.ImageCode:"placeholder",g=dpz.market.directory+"/images/img/coupons/thumbnails/"+f+".jpg";return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"eRoutingCouponOverlay",tokens:{couponInNationalMenu:e,couponImage:g,couponName:e&&e.Name}}}})},callback:function(b,c){a(".card__header--coupon-routing").parent(".card--overlay").addClass("card--overlay--eCouponRouting"),site.func.stackAttack(b);a.extend({recoverable:!0},c);site.trigger.onEvent({uri:"/error/"+c.code,title:"Error or Alert "+c.code,group:"Error",subGroup:c.code,eventType:"error"}),a(".js-closeButton",b).add(".js-continueButton",b).click(function(b){b.preventDefault();a(b.target).hasClass("js-closeButton");if(site.trigger.onEvent({group:"Coupons",subGroup:"X to Close",title:"X to Close",uri:"XtoClose"}),site.func.overlayToggle(!1,"eRoutingCouponOverlay",{},{}),site.func.customerSemiLoggedIn()&&jsDPZ.app.customer.getCustomer().data.Session.authRequired){(function(b){var c=a.extend({evt:void 0,trigger:{title:"Account - Loyalty Details Sign In",uri:"/locations/account/signin"},overlay:void 0},b);site.func.showLoginPopup(c)})({overlay:"loyaltyRedeemLoginOverlay"})}})}}})}),define("siteViews/easyOrderInstructions",["simplr"],function(b){b.view.mAddViews({easyOrderInstructions:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"easyOrderInstructions",tokens:{}}}})},callback:function(b,c){site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:b}),"handheld"!==site.func.getCurrentBreakpoint()&&a(".card--overlay").css("width","385px"),a(".js-continue").on("click",function(){window.location=a(this).attr("href")})}}})}),define("siteViews/featuredCoupon",["simplr"],function(b){b.view.mAddViews({featuredCoupon:{html:function(b){return a.Deferred(function(a){var c,d,e=site.func.setFeaturedCoupon(dpz.config.getMarketProperty("featuredCoupon")[b.couponType])||[],f=site.func.isFriToSun()?"FriToSun":"MonToThu",g=(e[f]||[]).filter(function(a){return~Object.keys(jsDPZ.app.catalog.getCatalog().data.Coupons).indexOf(a)});g.length?(c=jsDPZ.app.catalog.getCatalog().getCoupon(g[0]),d={component:"featuredCouponComponent",tokens:{description:c.data.Name,price:c.data.Price,code:c.data.Code,couponImage:c.data.ImageCode,featuredCouponImage:'<img class="media--horizontal media--coupon--featured-image" alt="'+jsDPZ.util.removeMarkup(jsDPZ.util.htmlUnEncode(c.data.Name)).toLowerCase()+'" src="'+dpz.market.directory+"/images/img/coupons/featured/"+c.data.ImageCode+'.jpg"/>'}},site.func.checkForImage(dpz.market.directory+"/images/img/coupons/featured/"+d.tokens.couponImage+".jpg").done(function(){jsDPZ.app.catalog.getCatalog().data.FeaturedCoupon=d.tokens.code,a.resolve(dpz.template.assembleLayout(d))}).fail(function(){a.resolve("")})):a.resolve("")})},callback:function(c,d){function e(c){-1!==window.location.hash.indexOf("/menu/category")?window.location.href=a(c).attr("route"):b.controller.mRouteAndExecute(site.func.buildURL({url:a(c).attr("href")}))}var f=a(".js-coupon[data-couponcode="+jsDPZ.app.catalog.getCatalog().data.FeaturedCoupon+"]");dpz.kiosk.isActive?f.addClass("media--coupon--featured is-visible@kiosk"):f.remove(),a(".js-addCoupon",c).on("click",function(b){var c=b.currentTarget.attributes["data-code"].value;b.preventDefault(),"9193"===c?site.func.toggleMixAndMatchUpgradeOverlay(b,a(this).data("wt-panelnumber"),a(this).data("wt-panelname")):e(this)}),site.func.fixMissingImages(a("img",c))}}})}),define("siteViews/glutenFreeDisclaimer",["simplr"],function(b){b.view.mAddViews({glutenFreeDisclaimer:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"glutenFreeDisclaimer",tokens:{kioskIsActive:dpz.kiosk.isActive}}}})},callback:function(c,d){a("a.js-closeButton").hide(),a(".js-continue").on("click",function(){b.controller.mRouteAndExecute(d.url),site.func.overlayToggle(!1)})}}})}),define("siteViews/groupOrderingInfo",["simplr"],function(b){b.view.mAddViews({groupOrderingInfo:{html:function(b){site.trigger.onPage({title:"Group Ordering Overlay",savePreviousState:!0});var c=[],d=[],e=0;a.each(b.coupons,function(a,b){c.push(b.CouponTierThreshold)});for(var f=0,g=c.length;f<g;f++)if(f+1<g){var h=c[f],i=parseInt(c[f+1])-1;c[f]=h+"-"+i}else c[f]=c[f]+"+";return a.each(b.coupons,function(a,b){d.push({numberOfPizzas:c[e],percentOff:b.CouponTierPercentOff}),e++}),dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"groupOrderingInfo",tokens:{couponInfo:{component:"couponInfo",tokens:d}}}}})},callback:function(b,c){a(".card--overlay").css("width","800px"),site.func.stackAttack(b),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:b}),a(".js-overlayFooter a").on("click",function(b){b.preventDefault(),site.func.overlayToggle(!1),window.location=a(this).attr("href")})}}})}),define("siteViews/header",["simplr","adobeTarget"],function(b,c){b.view.mAddViews({header:{html:function(){var a={component:"header",tokens:{hideCart:site.isPaymentPage||site.isConfirmationPage,kioskIsActive:dpz.kiosk.isActive,hideLogin:~window.location.hash.indexOf("#/locations/search/")||~window.location.hash.indexOf("#/content/")}};return killConfig.isActive("mBox")&&site.isHomepage&&c.trackEvent("Dominos-HomePage",{action:"Domino\\'s Home Page",sync:!1,clickedLoginRedirect:!!dpz.util.cookies.getItem("homepageRedirect")}),dpz.template.assembleLayout(a)},callback:function(c,d){function e(b){var d=a(".js-cart-icon",c),e=a(".js-kioskNavMenu",c),f=a(".js-kioskNavCoupons",c);[e,f].forEach(function(a){a.removeClass("is-active")}),~b.indexOf("/section/Food/")&&e.addClass("is-active"),~b.indexOf("/section/Coupons/")&&f.addClass("is-active"),~window.location.href.indexOf("payment")||~window.location.href.indexOf("confirmation")||~window.location.hash.indexOf("checkout")?d.addClass("is-hidden"):d.removeClass("is-hidden"),~window.location.pathname.indexOf("confirmation")&&[e,f].forEach(function(a){a.remove()})}var f=d.options,g=f.responsiveNav||{};a(".site-nav__toggle--nav").on("click",function(a){jsDPZ.topic("site.onTrackedEvent").publish(a),site.func.toggleOffCanvasNav()}),a(".site-nav__untoggle-overlay").on("click",site.func.hideOffCanvasPanels),b.view.mRender({name:"mainNavigation",data:{main:f.main,sub:f.sub,isContentPage:f.isContentPage},selector:".js-siteMainNavigation"}),"home"!==f.main&&b.view.mRender({name:"main_sub_navigation",data:{main:f.main,sub:f.sub,isContentPage:f.isContentPage},selector:"#js-subNavigationPage"}),site.func.updateMinorNavigation(g),site.isPaymentPage||site.isConfirmationPage||site.func.notifyCartUpdate(),dpz.kiosk.isActive&&(e(window.location.hash),a(window).on("hashchange",function(a){e(a.currentTarget.location.hash)}),a(".js-start-over",c).on("click",function(){dpz.kiosk.resetSession("start-new-order-click")})),a(document).on("/breakpoint/change/handheld/ /breakpoint/change/desktop/ force.profilecolumn.render",function(){!site.data.inOrderFunnel||site.isPaymentPage||site.isConfirmationPage||b.view.mRender({name:"profile_column",data:{},selector:"#js-myProfilePage"+("handheld"===site.func.getCurrentBreakpoint()?"Handheld":"")})}),a(document).trigger("force.profilecolumn.render")}}})}),define("siteViews/headerProfile",["simplr"],function(b){function c(){var a=site.func.homepageWeekPopupConfig.isActive()&&!jsDPZ.app.customer.getCustomer().data.Session.hasSeenWeekSpecialPopup&&killConfig.isActive("homepageUpsellOverlay"),b=!(site.func.isHandheld()||site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()||jsDPZ.app.customer.getCustomer().data.Session.signInDisplayed||dpz.util.cookies.getItem("homepageRedirect")),c="true"===jsDPZ.util.sessionStorage("save_eo_home")&&killConfig.isMarketEnabled("saveEasyOrderSetupModal")&&"true"!==jsDPZ.util.sessionStorage("save_eo_popup_seen");!a&&!c&&b&&site.isHomepage&&site.func.signInPopup()}b.view.mAddViews({headerProfile:{html:function(a){var b=jsDPZ.util.empty(a.FirstName)?site.storage.load("customerFirstName"):a.FirstName,c=dpz.loyalty.loyaltyIsActive(),d={isHomePage:site.isHomepage,isNationalMenuPage:~window.location.pathname.indexOf("menu.jsp"),firstName:b,email:a.Email,isPaymentPage:site.isPaymentPage,isConfirmationPage:site.isConfirmationPage,loyaltyEnabled:c,popOverLocationClass:"card--overlay--sign-in--"+(c?"loyalty-":"")+dpz.market.activeLanguageCode,loyaltySignInClass:c?"site-nav__profile__sign-in--loyalty":""};return dpz.template.assembleLayout({component:"headerProfile",tokens:d})},callback:function(b){var d,e;a(".js-userName").on("click",function(b){b.preventDefault(),site.trigger.onEvent({group:"Account",subGroup:"Profile",title:"Account - Profile",uri:"/account/profile"}),site.func.customerSemiLoggedIn()?site.func.showLoginPopup({semiLoggedIn:!0}):window.location=a(this).attr("href")}),a(".js-notUser",b).on("click",function(){site.trigger.onEvent({group:"Account",subGroup:"Sign Out",title:"Account - Sign Out",uri:"/account/signout"})}),a(".js-login").on("click",function(b){var c=site.func.getSignInData(a(b.target));b.preventDefault(),site.func.doLoginRedirectAndShowPopup(b,c)}),a(".js-createProfile",b).on("click",function(){site.trigger.onEvent({group:"Account",subGroup:"Create Profile",title:"Account - Create Profile",uri:"/account/createprofile"})}),c(),d=!(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()),e=jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink||jsDPZ.app.customer.getCustomer().data.Session.authRequired,(d&&e||jsDPZ.app.customer.getCustomer().data.Session.authRequired&&site.func.customerSemiLoggedIn())&&a(".js-login").click()}}})}),define("siteViews/homeStartYourOrder",["simplr"],function(b){b.view.mAddViews({homeStartYourOrder:{html:function(){return a.Deferred(function(a){var b=dpz.template.assembleLayout({component:"homeStartYourOrder",tokens:{}});a.resolve(b)})},callback:function(){a(".js-delivery, .js-carryout").on("click",function(b){var c="SYO_"+a(this).attr("data-method");b.preventDefault(),dpz.utag.fire.link(void 0,{event_name:c,event_action:"click",event_category:"button",event_label:"navigation"}),window.location.href=a(this).attr("href")+"?type="+a(this).attr("data-method")})}}})}),define("siteViews/hotspotsFYIOverlay",["simplr"],function(b){b.view.mAddViews({hotspotsFYIOverlay:{html:function(){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"hotspotsFYIOverlay",tokens:{}},customClass:"hotspots-fyi-overlay hotspots-modal"}})},callback:function(){site.trigger.onPage({title:"Hotspots FYI Overlay",titleIsKey:!0,group:"Hotspots"}),a(".js-closeButton").click(function(){site.func.overlayToggle(!1,"hotspotsFYIOverlay",{},{})})}}})}),define("siteViews/hotspotsLocationAccessOverlay",["simplr","dpz.hotspots"],function(b,c){b.view.mAddViews({hotspotsLocationAccessOverlay:{html:function(){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"hotspotsLocationAccessOverlay",tokens:{}},customClass:"hotspots-location-access hotspots-modal"}})},callback:function(d){site.trigger.onPage({title:"Hotspots Location Permission Overlay",titleIsKey:!0,group:"Hotspots"}),a(".js-closeButton",d).click(function(a){a.preventDefault(),site.func.overlayToggle(!1,"hotspotsLocationAccessOverlay",{},{})}),a(".js-continue",d).click(function(){site.func.toggleLoading(!0),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){c.setLocatorPermission(!0),c.cacheLocation(a).then(function(){site.func.toggleLoading(!1),b.controller.mRouteAndExecute("/hotspots/")})},function(){site.func.overlayToggle(!0,"hotspotsLocationErrorOverlay",{},{})}):site.func.overlayToggle(!0,"hotspotsLocationErrorOverlay",{},{}),site.func.overlayToggle(!1,"hotspotsLocationAccessOverlay",{},{})})}}})}),define("siteViews/hotspotsLocationErrorOverlay",["simplr"],function(b){function c(a,b){var c=dpz.market.activeLanguageCode,d={android:"Android",ios:"iOS"},e=d[a.toLowerCase()]||"Desktop";switch(b.toLowerCase()){case"chrome":return"https://support.google.com/chrome/answer/142065?co=GENIE.Platform%3D"+e+"&hl="+c;case"firefox":return"https://www.mozilla.org/"+c+"-US/firefox/geolocation/";case"safari":return"Desktop"===e?"https://support.apple.com/"+c+"-us/HT204690":"https://support.apple.com/"+c+"-us/HT207092";case"edge":return"https://privacy.microsoft.com/"+c+"-US/windows-10-location-and-privacy";case"ie":case"ie mobile":return"https://support.microsoft.com/"+c+"-us/help/17479/windows-internet-explorer-11-change-security-privacy-settings";default:return""}}b.view.mAddViews({hotspotsLocationErrorOverlay:{html:function(){return a.Deferred(function(a){require(["external/ua-parser.min"],function(b){var d=b();a.resolve(dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"hotspotsLocationErrorOverlay",tokens:{link:c(d.os.name||"",d.browser.name||"")}},customClass:"hotspots-location-error hotspots-modal"}}))})})},callback:function(b){site.trigger.onPage({title:"Hotspots Location Error Overlay",titleIsKey:!0,group:"Hotspots"}),a(".js-closeButton",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1,"hotspotsLocationErrorOverlay",{},{})})}}})}),define("siteViews/hotspotsRingRingOverlay",["simplr"],function(b){b.view.mAddViews({hotspotsRingRingOverlay:{html:function(){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"hotspotsRingRingOverlay",tokens:{}},customClass:"hotspots-modal hotspots-ring-ring"}})},callback:function(b){a(".js-closeButton",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1,"hotspotsRingRingOverlay",{},{})})}}})}),define("siteViews/iFrameOverlay",["simplr"],function(b){b.view.mAddViews({iFrameOverlay:{html:function(a){return dpz.template.assembleLayout({component:"3dSecureCheckOverlay",tokens:{}})},callback:function(b,c){var d=document.getElementById("iFrameOverlay");if(!c)throw new Error("No html or src URL for the iFrameOverlay!");if(a(d,b).height(.75*a(window).height()),c.html){var e=d.contentWindow.document;e.open(),e.write(c.html),e.close()}else c.src&&(d.src=c.src);site.func.setupLayerCloseEvents({layerSelector:b})}}})}),define("siteViews/ipadSplash",["simplr"],function(b){b.view.mAddViews({ipadSplash:{html:function(a){return dpz.template.assembleLayout({component:"ipadSplash",tokens:{cardType:a&&a.cardType?a.cardType:"default",downloadMessage:a&&a.downloadMessage?a.downloadMessage:"DOWNLOAD THE APP",closeMessage:a&&a.closeMessage?a.closeMessage:"Continue to site",appUrl:"http://itunes.apple.com/us/app/dominos-pizza-usa/id436491861"}})},callback:function(b,c){var d=a.extend({recoverable:!0},c);site.trigger.onEvent({uri:"/error/"+c.code,title:"Error or Alert "+c.code,group:"Error",subGroup:c.code,eventType:"error"}),d.recoverable?(site.func.setupLayerCloseEvents({layerSelector:b}),a(".ipad-splash__btn",b).click(function(b){b.preventDefault(),c.triggers&&c.triggers.downloadTrigger&&site.trigger.onEvent(c.triggers.downloadTrigger);var d=a(this).parent().prop("href");site.func.toggleLoading(!0),setTimeout(function(){site.func.toggleLoading(!1),site.func.overlayToggle(!1),document.location=d},1500)}),a(".ipad-splash__close",b).click(function(b){b.preventDefault(),c.triggers&&c.triggers.noThanksTrigger&&site.trigger.onEvent(c.triggers.noThanksTrigger);a(this).attr("href");site.func.toggleLoading(!0),site.func.toggleLoading(!1),site.func.overlayToggle(!1)}),a(".js-closeButton",b).click(function(b){b.preventDefault(),c.triggers&&c.triggers.closeTrigger&&site.trigger.onEvent(c.triggers.closeTrigger);a(this).attr("href");site.func.toggleLoading(!0),site.func.toggleLoading(!1),site.func.overlayToggle(!1)})):a(".js-closeButton",b).remove()}}})}),define("siteViews/lighterOptionsOverlay",["simplr"],function(b){b.view.mAddViews({lighterOptionsOverlay:{html:function(){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"lighterOptionsOverlay",tokens:{}},customClass:"lighter-options"}})},callback:function(b){a(".js-closeButton",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1,"lighterOptionsOverlay",{},{})})}}})}),define("siteViews/loyaltyOptOut",["simplr"],function(b){b.view.mAddViews({loyaltyOptOut:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"loyaltyOptOut",tokens:{}}}})},callback:function(b,c){a(".js-sign-in--pop-up").hide(),"handheld"!==site.func.getCurrentBreakpoint()&&a(".card--overlay").css("width","550px"),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:b}),a(".js-loyaltyOptOut").on("click",function(b){b.preventDefault();var c=a(this).attr("href"),d=a.extend(!0,{},jsDPZ.app.customer.getCustomer().getCustomerForPower());d.Loyalty.Command="OPTOUT",dpz.loyalty.loyaltyIsOk()?site.func.saveAccountData({data:d,success:function(b){"Fail"!==b.Loyalty.Status?(site.func.overlayToggle(!1),window.location=c):(a.extend(jsDPZ.app.customer.getCustomer().data.Loyalty,d.Loyalty),site.sessionTools.save(),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyOptOutFailed"}))},error:function(a){site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyOptOutFailed"})}}):site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyOptOutFailed"})})}}})}),define("siteViews/loyaltyTermsBody",["simplr"],function(b){b.view.mAddViews({loyaltyTermsBody:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"loyaltyTermsBody",tokens:{}}}})},callback:function(b,c){site.func.animateScroll(".loyalty-terms__body",a(".js-collectingPointsAnchor"),!0),a(".js-closeButton",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1)})}}})}),define("siteViews/loyalty_checkout_activate",["simplr"],function(b){b.view.mAddViews({loyalty_checkout_activate:{html:function(a){var b=dpz.loyalty.getEnrollmentBonusConfig(),c=dpz.loyalty.config.defaultBase,d={component:"checkoutLoyaltyActivate",tokens:{showBonus:b.show,bonusPoints:b.bonusPoints,bonusTotalNeeds:b.bonusTotalNeeds,earningPoints:c.pointsPerOrder,totalNeeded:c.totalNeeded,loyaltyReward:dpz.template.translate(c.rewardString),rewardPoints:c.rewardPoints,loyaltyTermsBody:{component:"loyaltyTermsBody",tokens:{}},loyaltyInfographic:{component:"loyaltyInfographic",tokens:{customClass:"loyalty-infographic--stopover",hideBanner:!0}}}};return dpz.template.assembleLayout(d)},callback:function(b,c){site.func.showFull(),a(".js-activateLoyalty").on("click",function(a){a.preventDefault(),site.func.customerLoggedIn()?dpz.loyalty.enrollCustomer():site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.enroll})}),a(".legal-text-button").on("click",function(b){b.preventDefault(),a(".legal-dropdown").stop().slideToggle(),site.trigger.onEvent({uri:"Checkout/asProfiled/LoyaltyTaCClick",title:"Checkout as Profiled Loyalty TaC Click",group:"Checkout",subGroup:"as Profiled Loyalty TaC Click"})}),site.trigger.onEvent({group:"Checkout",subGroup:"as Profiled Activate Loyalty",title:"Checkout as Profiled Activate Loyalty",uri:"/Checkout/asProfiled/ActivateLoyalty"}),jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError&&jsDPZ.app.customer.getCustomer().data.Session.loyaltyStopover&&"m"===!jsDPZ.app.customer.getCustomer().data.Session.loyaltyStopover.settings.experience&&(delete jsDPZ.app.customer.getCustomer().data.Session.LoyaltyEnrollmentError,site.sessionTools.save(),site.func.toggleLoading(!1),site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyProfileCreationFailed"})),site.func.stackAttack(b),site.func.isGroupOrdering()&&a("#js-discountDashboard").hide()}}})}),define("siteViews/loyalty_checkout_signin",["simplr"],function(b){b.view.mAddViews({loyalty_checkout_signin:{html:function(b){site.trigger.onPage({title:"Loyalty Checkout Stopover"});var c=a.Deferred(),d=jsDPZ.app.customer.getCustomer().data,e=dpz.loyalty.getEnrollmentBonusConfig(),f=dpz.loyalty.config.defaultBase,g={component:"checkoutLoyaltyStopover",tokens:{loyaltyCanEnroll:dpz.loyalty.canEnroll(),firstName:d.FirstName,lastName:d.LastName,email:d.Email,phone:d.Phone,extension:d.Extension,showBonus:e.show,bonusPoints:e.bonusPoints,bonusTotalNeeds:e.bonusTotalNeeds,earningPoints:f.pointsPerOrder,totalNeeded:f.totalNeeded,rewardPoints:f.rewardPoints,loyaltyReward:dpz.template.translate(f.rewardString)}};return c.resolve(dpz.template.assembleLayout(g)),c},callback:function(c,d){a(".js-loginKeepLoggedIn").click(function(){a("input#Remember_Me").prop("checked",!0)}),a(".js-loginOnce").click(function(){a("input#Remember_Me").prop("checked",!1)});var e={el:a("form#loyalty-stopover-signin",c),inputs:{Email:a(".js-email",c),Password:a(".js-password",c)},settings:{loginView:!0},init:function(){this.el.focusClass().validate(this.validation),this.el.renderFields(),site.func.customerSemiLoggedIn()?a(".js-anonymous",c).remove():a(".js-semiLoggedIn",c).remove(),d.paymentPage?a(".js-signout",c).remove():a(".js-payment",c).remove(),this.inputs.Email.val()&&this.inputs.Password.is(":visible")?this.inputs.Password.focus():this.inputs.Email.focus()},validation:{rules:{Email:{email:!0,required:function(){return!site.func.customerSemiLoggedIn()||!e.settings.loginView},persist:!0},Password:{required:function(){return e.settings.loginView}},Remember_Me:{showOptional:function(){return e.settings.loginView}}},submitHandler:function(a){var c=b.form.mGetValues(a);b.controller.mRouteAndExecute(site.func.buildURL({url:e.settings.loginView?"#/customer/login/create":"#/customer/reset-password/create",parameters:{email:c.Email,password:c.Password,semiLoggedIn:d.semiLoggedIn,creditCardCheckout:d.creditCardCheckout,setEasyOrder:d.setEasyOrder,removeEasyOrder:d.removeEasyOrder,paymentPage:d.paymentPage}})),site.func.overlayToggle(!1)}}};e.init(),a(".js-toggleLogin",c).on("click",function(b){b.preventDefault(),a(".js-formActions",c).children().toggle(),e.settings.loginView=!e.settings.loginView,e.el.renderFields(),a(".js-message",c).toggle(e.settings.loginView),e.inputs.Email.val()&&e.inputs.Password.is(":visible")?e.inputs.Password.focus():e.inputs.Email.focus()}),a(".js-signout",c).on("click",function(){b.controller.mRouteAndExecute("/customer/logout/")}),a(".js-payment",c).on("click",function(){b.controller.mRouteAndExecute("/customer/guest-checkout/")}),a(".js-rememberMeLegal").on("click",function(b){b.preventDefault(),a(".js-rememberMeLegalText").toggle(),site.trigger.onEvent({group:"Checkout",subGroup:"as Profiled Keep Me Signedin ShowInfo",title:"Checkout as Profiled Keep Me Signedin ShowInfo",uri:"/Checkout/asProfiled/KeepMeSignedIn/ShowInfo"})}),a(".js-rememberMe").on("click",function(){var b=a(".js-rememberMe").is(":checked")?"Check":"UnCheck";site.trigger.onEvent({group:"Checkout",subGroup:"as Profiled Keep Me Signedin "+b,title:"Checkout as Profiled Keep Me Signedin "+b,uri:"/Checkout/asProfiled/KeepMeSignedIn/"+b})}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:c,callback:function(b){d.paymentPage&&(a("input[name='Payment_Type'][value='Credit']").is(":checked")&&a(".js-creditCardSelection").val()>=0&&a("input[name='Credit_Card_Selection'][value='-1']").click(),a("#Easy_Order_Selection").is(":checked")&&(a("#Easy_Order_Selection").prop("checked",!1),a(".js-easyOrderLabel, #Easy_Order_Name").hide(),a("#Easy_Order_Name").val("")))}}),{el:a("form#loyalty-order-as-guest",c),init:function(){if(killConfig.isMarketEnabled("masksEnabled")){var b=dpz.config.getMarketProperty("mask");a(".js-phone",c).mask(b.phone.mask,b.phone.properties).val(b.phone.properties.defaultVal||null),killConfig.isMarketEnabled("phoneExtension")&&a(".js-extension",c).mask(b.extension.mask,b.extension.properties)}a(".js-emailOptIn",c).on("click",function(){a(this).is(":checked")?site.trigger.onEvent({group:"Checkout",subGroup:"as Guest Email Optin Check",title:"Checkout as Guest Email Optin Check",uri:"/Checkout/asGuest/EmailOptinCheck"}):site.trigger.onEvent({group:"Checkout",subGroup:"as Guest Email Optin Uncheck",title:"Checkout as Guest Email Optin Uncheck",uri:"/Checkout/asGuest/EmailOptinUncheck"})}).prop("checked",!0),site.func.setupContentPopups(c),site.func.setupTemplatePopups(c),this.el.focusClass().validate(this.validation),this.el.renderFields()},validation:{rules:{First_Name:{required:!0},Last_Name:{required:!0},Email:{required:!0,email:!0},Confirm_Email:{required:!0,equalToCI:function(){return a(".js-guest-email",c).val()}},Phone:{required:!0,phone:!0},Extension:{showOptional:!0},Create_Password:{required:!0,minlength:8},Confirm_Password:{required:!0,equalTo:"#Create_Password"},Email_Opt_In:{showOptional:function(){return"UNITED_STATES"===dpz.market.marketName}},Agree_To_Terms_Of_Use:{required:!0}},submitHandler:function(c){var d,e,f=b.form.mGetValues(c),g=dpz.loyalty.canEnroll()&&a(".js-loyaltyOptIn").is(":checked"),h=g?"#/customer/profile/create":urlConfig.localRoot+"/pages/order/payment.jsp";e={FirstName:f.First_Name,LastName:f.Last_Name,Email:f.Email,Phone:f.Phone.replace(/[^0-9]/g,""),Extension:killConfig.isMarketEnabled("phoneExtension")?f.Extension.replace(/[^0-9]/g,""):"",Password:f.Create_Password,EmailOptIn:f.Email_Opt_In,AgreeToTermsOfUse:f.Agree_To_Terms_Of_Use,Age13OrOlder:f.Agree_To_Terms_Of_Use},g?(e.LoyaltyEnrollment=!0,d=site.func.buildURL({url:h,parameters:e}),b.controller.mRouteAndExecute(d)):(a.extend(jsDPZ.app.customer.getCustomer().data,e),a.extend(!0,jsDPZ.app.order.getOrder().data.Customer,{FirstName:e.FirstName,LastName:e.LastName,Email:e.Email,Phone:e.Phone,Extension:e.Extension}),site.sessionTools.save().then(function(){window.location=h}))}}}.init(),site.func.showFull();var f=function(){a(".grid--loyalty-stopover--action--none-selected").length>0&&a(".grid--loyalty-stopover--action--none-selected").removeClass("grid--loyalty-stopover--action--none-selected"),a(".js-signIn.js-viewToggle").hasClass("btn")&&a(".js-signIn.js-viewToggle").removeClass("btn").removeClass("checkout-selection--button").addClass("loyalty-stopover--action"),a(".js-orderAsGuest.js-viewToggle").hasClass("btn")&&a(".js-orderAsGuest.js-viewToggle").removeClass("btn").removeClass("checkout-selection--button").addClass("loyalty-stopover--action")};a(".js-loyaltyOptInContainer").show(),a(".js-signIn.js-viewToggle").on("click",function(b){b.preventDefault(),site.trigger.onEvent({group:"Checkout",subGroup:"Profiled Select",title:"Checkout as Profiled Select",uri:"/Checkout/asProfiled/Select"}),f(),a(".js-viewToggle").removeClass("btn").removeClass("checkout-selection--button").addClass("loyalty-stopover--action"),a(".js-signIn.js-viewToggle").hide(),a(".grid__cell--loyalty-stopover--checkout-selection--first").removeClass("grid__cell--loyalty-stopover--checkout-selection--first"),a(".js-orderAsGuest-action-container").removeClass("grid__cell--loyalty-stopover--selected-action"),a(".js-signIn-action-container").addClass("grid__cell--loyalty-stopover--selected-action"),a(".js-orderAsGuest.js-viewToggle").show(),a(".js-orderAsGuest.js-toggledContent").is(":visible")?a(".js-toggledContent").toggle():a(".js-signIn.js-toggledContent").slideDown("fast"),a(".js-signIn #Email").focus()}),a(".js-orderAsGuest.js-viewToggle").on("click",function(b){b.preventDefault(),site.trigger.onEvent({group:"Checkout",subGroup:"Guest Select",title:"Checkout Guest Select",uri:"/Checkout/Guest/Select"}),f(),a(".grid__cell--loyalty-stopover--checkout-selection--first").removeClass("grid__cell--loyalty-stopover--checkout-selection--first"),a(".js-signIn-action-container").removeClass("grid__cell--loyalty-stopover--selected-action"),a(".js-orderAsGuest-action-container").addClass("grid__cell--loyalty-stopover--selected-action"),a(".js-orderAsGuest.js-viewToggle").hide(),a(".js-signIn.js-viewToggle").show(),a(".js-signIn.js-toggledContent").is(":visible")?a(".js-toggledContent").toggle():a(".js-orderAsGuest.js-toggledContent").slideDown("fast"),a(".js-orderAsGuest #First_Name").focus(),a(c).on("focus",".js-phone",function(){"none"!==a(".js-arrow-box").css("display")||a(".js-loyaltyOptIn").prop("checked")||(site.func.isHandheld()?a(".js-arrow-box").slideDown("slow"):a(".js-arrow-box").toggle("slide"))})}),dpz.loyalty.canEnroll()&&(a(".js-loyaltyOptIn").on("change",function(){a(".js-loyaltyProfileCreationFields").stop().slideToggle("fast"),a(".js-loyaltyOptIn").prop("checked")?(dpz.loyalty.config.enrollmentBonusConfig.show?a(".js-arrow-box").hide():a(".js-arrow-box").show(),a(".js-orderAsGuest .btn").text(dpz.template.translate("forms.enroll_and_continue")),site.trigger.onEvent({group:"Checkout",subGroup:"as Guest Loyalty Enroll Check",title:"Checkout as Guest Loyalty Enroll Check",uri:"/Checkout/asGuest/LoyaltyEnrollCheck"})):(dpz.loyalty.config.enrollmentBonusConfig.show&&a(".js-arrow-box").show(),a(".js-orderAsGuest .btn").text(dpz.template.translate("forms.continue")),site.trigger.onEvent({group:"Checkout",subGroup:"as Guest Loyalty Enroll UnCheck",title:"Checkout as Guest Loyalty Enroll UnCheck",uri:"/Checkout/asGuest/LoyaltyEnrollUnCheck"})),a(".js-termsOfUse").toggle()}),a(".js-showLoyaltyInfo").on("click",function(a){a.preventDefault(),dpz.loyalty.showInfographicOverlay()}));var g=jsDPZ.app.customer.getCustomer().data,h=jsDPZ.app.order.getOrder().data;""!==g.FirstName&&""!==g.Email&&(f(),a(".js-emailOptIn",c).prop("checked",h.Customer.EmailOptIn?h.Customer.EmailOptIn:g.EmailOptIn),a(".grid__cell--loyalty-stopover--checkout-selection--first").removeClass("grid__cell--loyalty-stopover--checkout-selection--first"),a(".js-signIn-action-container").removeClass("grid__cell--loyalty-stopover--selected-action"),a(".js-orderAsGuest-action-container").addClass("grid__cell--loyalty-stopover--selected-action"),a(".js-orderAsGuest.js-viewToggle").hide(),a(".js-signIn.js-toggledContent").hide(),a(".js-signIn.js-viewToggle").show(),a(".js-orderAsGuest.js-toggledContent").slideDown("fast"),dpz.loyalty.canEnroll()&&setTimeout(function(){"none"!==a(".js-arrow-box").css("display")||a(".js-loyaltyOptIn").prop("checked")||(site.func.isHandheld()?a(".js-arrow-box").slideDown("slow"):a(".js-arrow-box").toggle("slide"))},1e3)),a(".js-loyaltyTerms").on("click",function(){site.trigger.onEvent({uri:"Checkout/asGuest/LoyaltyTaCClick",title:"Checkout as Guest Loyalty TaC Click",group:"Checkout",subGroup:"as Guest Loyalty TaC Click"})}),site.trigger.onEvent({uri:"/Checkout/asProfiledGuest",title:"Checkout as Profiled or Guest",group:"Checkout",subGroup:"as Profiled or Guest"}),site.func.isGroupOrdering()&&a("#js-discountDashboard").hide()}}})}),define("siteViews/loyalty_details_overlay",["simplr"],function(a){a.view.mAddViews({loyalty_details_overlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{customClass:"card--overlay--loyalty-details",overlayContent:{component:"loyaltyDetailsOverlay",tokens:{}}}})},callback:function(a,b){site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:a})}}})}),define("siteViews/loyalty_enrollment_details",["simplr"],function(b){b.view.mAddViews({loyalty_enrollment_details:{html:function(b){var c=a.Deferred(),d={};d.url=urlConfig.api+"/stock-ticker-service/stockticker";var e=function(a){var b=site.func.customerLoggedIn()||site.func.customerSemiLoggedIn();c.resolve(dpz.template.assembleLayout({component:"loyaltyEnrollmentDetails",tokens:{hasProfile:b,showLoyaltyFail:!dpz.loyalty.loyaltyIsOk()&&b,loyaltyProgramDetails:{component:"loyaltyProgramDetails",tokens:{isEnrolled:!1,faqs:{component:"loyaltyFaq",tokens:{customClass:"card__body--loyalty-details"}},showPOE:killConfig.isMarketEnabled("loyaltyPostOrderEarn")&&killConfig.isMarketEnabled("loyaltyPostOrderEarnProgramDetails")}},loyaltyInfographic:{component:"loyaltyInfographic",tokens:{customClass:"",hideBanner:!0}},loyaltyOtherPerks:{component:"loyaltyOtherPerks",tokens:{stockPrice:a.price?a.price:"",stockLastUpdate:a.timeStamp?jsDPZ.util.htmlUnEscape(a.timeStamp).replace(/:..\s/," "):"",profiled:site.func.customerLoggedIn()||site.func.customerSemiLoggedIn()}}}}))};return d.error=e,d.success=e,jsDPZ.ajax.request(d),c},callback:function(c,d){!function b(){a(".loyalty-ticker__ticker").css("right","-1300px"),a(".loyalty-ticker__ticker").animate({right:"600px"},16e3,"linear",b)}();var e=site.func.customerLoggedIn()||site.func.customerSemiLoggedIn(),f=function(b){var c=a.extend({evt:void 0,trigger:{title:"Account - Loyalty Details Sign In",uri:"/locations/account/signin"},overlay:void 0},b);site.func.showLoginPopup(c)};a(".js-loyaltyFaqLink").on("click",function(b){b.preventDefault();var c=a(this).attr("href");site.trigger.onEvent({group:"Profile Hub",subGroup:"Piece of the Pie Details FAQ Link Click",title:"Piece of the Pie FAQ link",uri:"/customer/rewards/"}),window.location=c}),a(".js-login-rewards",c).on("click",function(a){a.preventDefault(),a.preventDefault();var b={evt:a};site.func.showLoginPopup(b)}),site.func.setupTemplatePopups(c),a(".js-login--enroll").on("click",function(a){a.preventDefault(),site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.enroll})}),e&&(dpz.loyalty.loyaltyIsOk()?(a(c).on("click",".js-loyaltyEnroll",function(a){if(a.preventDefault(),site.func.customerSemiLoggedIn())site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.enroll});else{var b=function(){window.location.hash="#/customer/profile/",site.func.toggleLoading(!1)},c=function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"eLoyaltyLoginFailed"})};dpz.loyalty.enrollCustomer({successCallback:b,errorCallback:c})}}),jsDPZ.topic("loyalty.status.changed").subscribe(function(){dpz.loyalty.loyaltyIsOk()||b.controller.mRouteAndExecute("#/customer/rewards/")})):(b.view.mRender({name:"profile_hub_non_enrolled_loyalty_card_view",data:{},selector:".js-hubLoyaltyNonEnrolledContainer"}),a(".js-hubLoyaltyNonEnrolledContainer").show(),jsDPZ.topic("loyalty.status.changed").subscribe(function(){dpz.loyalty.loyaltyIsOk()&&b.controller.mRouteAndExecute("#/customer/rewards/")}))),jsDPZ.app.customer.getCustomer().data.Session.ShowLogin&&(e||(jsDPZ.app.customer.getCustomer().data.Session.ShowRewards=!0,f({overlay:"loyaltyRedeemLoginOverlay"})),delete jsDPZ.app.customer.getCustomer().data.Session.ShowLogin,site.sessionTools.save()),site.func.stackAttack(c),a(".js-loyaltyTermsBody").on("click",function(a){a.preventDefault(),site.func.overlayToggle(!0,"loyaltyTermsBody")})}}})}),define("siteViews/loyalty_rewards_details",["simplr"],function(b){b.view.mAddViews({loyalty_rewards_details:{html:function(b){var c=dpz.loyalty.getCustomerPoints(),d=(dpz.loyalty.getPointsRange(),moment(jsDPZ.app.customer.getCustomer().data.Loyalty.BasePointExpirationDate,"YYYY-MM-DD").format(dpz.market.marketConfig.date.format.DATE)),e=(c.PendingPoints,a.Deferred()),f={};f.url=urlConfig.api+"/stock-ticker-service/stockticker";var g=function(a){site.func.customerLoggedIn()||site.func.customerSemiLoggedIn();e.resolve(dpz.template.assembleLayout({component:"loyaltyRewardsDetails",tokens:{dashboard:{component:"loyaltyDashboard",tokens:{}},pendingPointsHistory:{component:"loyaltyHistoryTable",tokens:{showBalance:!1,containerIdClass:"js-loyalty-pending-container",titleClass:"card__body--loyalty--title card__body--loyalty--title--pending",bodyIdClass:"js-loyalty-pending-body",title:"customer.loyalty_pending_activity_title",footerText:"customer.loyalty_pending_activity_footer",footerClass:"loyalty-history--pending"}},completedPointsHistory:{component:"loyaltyHistoryTable",tokens:{expirationDate:d,showBalance:!0,containerIdClass:"js-loyalty-completed-container",titleClass:"card__body--loyalty--title",bodyIdClass:"js-loyalty-completed-body",title:"customer.loyalty_completed_activity",footerText:"customer.loyalty_history_warning",footerClass:"loyalty-history--expiration"}},loyaltyProgramDetails:{component:"loyaltyProgramDetails",tokens:{isEnrolled:!0,faqs:{component:"loyaltyFaq",tokens:{customClass:"card__body--loyalty-details"}},showPOE:killConfig.isMarketEnabled("loyaltyPostOrderEarn")&&killConfig.isMarketEnabled("loyaltyPostOrderEarnProgramDetails")}},loyaltyOtherPerks:{component:"loyaltyOtherPerks",tokens:{stockPrice:a.price?a.price:"",stockLastUpdate:a.timeStamp?jsDPZ.util.htmlUnEscape(a.timeStamp).replace(/:..\s/," "):"",profiled:site.func.customerLoggedIn()||site.func.customerSemiLoggedIn(),loyalty:jsDPZ.app.customer.getCustomer().isLoyaltyCustomer()}}}}))};return f.error=g,f.success=g,jsDPZ.ajax.request(f),e},callback:function(c,d){!function b(){a(".loyalty-ticker__ticker").css("right","-1300px"),a(".loyalty-ticker__ticker").animate({right:"600px"},16e3,"linear",b)}(),a(".js-loyaltyFaqLink").on("click",function(b){b.preventDefault();var c=a(this).attr("href");site.trigger.onEvent({group:"Profile Hub",subGroup:"Piece of the Pie Details FAQ Link Click",title:"Piece of the Pie FAQ link",uri:window.location.hash}),window.location=c}),a(".js-loyaltyTermsBody").on("click",function(a){a.preventDefault(),site.func.overlayToggle(!0,"loyaltyTermsBody")}),dpz.loyalty.updateWidgets({keepCoupons:!1,animation:{cache:"big"}}),site.func.setupTemplatePopups(c),a(".loyalty-rewards-toggler").on("click",function(b){b.preventDefault(),a(".js-loyalty-rewards-toggle").toggle()}),a(".loyalty-rewards-details--opt-out a").on("click",function(a){a.preventDefault(),site.func.customerLoggedIn()?b.controller.mRouteAndExecute("/loyalty/opt-out/"):site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.optOut})});var e=function(){var b=a(".js-loyalty-pending-body").children("tr.loyalty-history--transaction").length>0,c=a(".js-loyalty-history-body").children("tr.loyalty-history--transaction").length>0;b&&a(".js-loyalty-pending-container").hide(),c&&a(".js-loyalty-completed-container").hide(),"none"===a(".js-loyalty-history-container").css("display")&&a(".js-loyalty-history-container").slideDown(function(){a(".js-loyalty-history-error").hide().css("visibility","visible").fadeIn("slow")})};jsDPZ.app.customer.getCustomer().data.Session.Loyalty=a.extend({},jsDPZ.app.customer.getCustomer().data.Session.Loyalty,{pageIndex:0}),site.sessionTools.save();var f=function(){if(dpz.loyalty.loyaltyIsOk()&&dpz.loyalty.isEnrolled()){site.func.toggleLoading(!0,{},{});var b=jsDPZ.app.customer.getCustomer().data;b.Session.Loyalty.pageIndex=b.Session.Loyalty.pageIndex+1,site.sessionTools.save(),dpz.loyalty.getHistoryPoints({pageIndex:b.Session.Loyalty.pageIndex,successCallback:function(b){var c=b.pendingHistory.length>0||a(".js-js-loyalty-pending-body").children("tr.loyalty-history--transaction").length>0,d=b.completedHistory.length>0||a(".js-loyalty-history-body").children("tr.loyalty-history--transaction").length>0,e=b.completedHistory.length>3||a(".js-loyalty-history-body").children("tr.loyalty-history--transaction").length>0,f="";c&&(a(".js-loyalty-pending-body").append(dpz.template.assembleLayout({component:"loyaltyHistoryList",tokens:{historyComponent:b.pendingHistory}})),a(".js-loyalty-pending-container").show().css("visibility","hidden"),f+=".js-loyalty-pending-container"),d&&(a(".js-loyalty-completed-body").append(dpz.template.assembleLayout({component:"loyaltyHistoryList",tokens:{historyComponent:b.completedHistory}})),a(".js-loyalty-completed-container").show().css("visibility","hidden"),f+=c?", .js-loyalty-completed-container":".js-loyalty-completed-container",e&&a(".js-history-load-more").show()),d||c||a(".js-loyalty-no-history").show(),a(".js-loyalty-history-error").hide(),a(".js-loyalty-history-container").addClass("has-history").slideDown(function(){a(f).hide().css("visibility","visible").fadeIn("slow")})},errorCallback:e})}else!dpz.loyalty.loyaltyIsOk()&&dpz.loyalty.isEnrolled()&&(e(),a(".js-loyalty-history-container").slideDown())};a(".loyalty-history").on("click",".loyalty-history--transaction--toggler",function(b){b.preventDefault();var c=a(this).parents(".loyalty-history--transaction").next(".loyalty-history--transaction--details");a(c).hasClass("is-hidden")?(a(this).text(jsDPZ.util.htmlUnEncode("&#9650")),a(c).removeClass("is-hidden")):(a(this).text(jsDPZ.util.htmlUnEncode("&#9660")),a(c).addClass("is-hidden")),site.trigger.onEvent({group:"Acount",subGroup:"Details Piece of the Pie Rewards Expand",title:"Account Details Piece of the Pie Rewards Expand",uri:"/Account/Details/PieceOfThePieRewardsExpand"})}),a(".loyalty-history-toggler, .alerts__history").on("click.fetchHistory",function(b){b.preventDefault(),a(".alerts__history, .loyalty-history-toggler").off("click.fetchHistory"),f()}),a(".loyalty-history-toggler").on("click",function(b){b.preventDefault(),a(".loyalty-history-toggle").toggle(),a(".js-loyalty-history-container.has-history").stop().slideToggle(),a(".js-loyalty-history-container").is(":visible")&&site.trigger.onEvent({group:"Loyalty",subGroup:"Details",title:"Loyalty Details",uri:"/Loyalty/Details"})}),site.trigger.onEvent({group:"Account",subGroup:"Details Piece of the Pie Rewards",title:"Account Details Piece of the Pie Rewards",uri:"/account/details/PieceOfThePieRewards"}),a(".js-history-load-more").on("click",function(b){b.preventDefault(),a(".loyalty-history--transaction-row.is-hidden").show(),a(".js-history-load-more").hide()}),jsDPZ.topic("loyalty.status.changed").subscribe(function(){dpz.loyalty.loyaltyIsOk()||b.controller.mRouteAndExecute("#/customer/rewards/")})}}})}),define("siteViews/loyalty_small_widget",["simplr"],function(b){b.view.mAddViews({loyalty_small_widget:{html:function(a){return dpz.template.assembleLayout({component:"loyaltySmallWidget",tokens:{}})},callback:function(b,c){dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.isEnrolled()&&(a(b).removeClass("is-hidden"),dpz.loyalty.updateWidgets(dpz.loyalty.getSmallWidgetRules()))}}})}),define("siteViews/loyalty_widget_alerts",["simplr"],function(b){b.view.mAddViews({loyalty_widget_alerts:{html:function(b){var c=a.extend(!0,{showWarning:!0},b);return dpz.template.assembleLayout({component:"loyaltyWidgetAlerts",tokens:{loyaltyIsOk:dpz.loyalty.loyaltyIsOk(),loyaltyIsSessionFail:dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.config.loyaltyIsOk,expireDate:moment(jsDPZ.app.customer.getCustomer().data.Loyalty.BasePointExpirationDate,"YYYY-MM-DD").format(dpz.market.marketConfig.date.format.DATE),showWarning:c.showWarning&&dpz.loyalty.isLastActivityInsideWarningTime(),alertClass:dpz.loyalty.isLastActivityInsideWarningTime()?"alert":""}})},callback:function(b,c){dpz.loyalty.isLastActivityInsideWarningTime()?(a(".lower-widgets").removeClass("is-hidden"),a(".upper-widgets").removeClass("single-row"),a(".upper-widgets").show()):dpz.loyalty.loyaltyIsOk()||(a(".lower-widgets").removeClass("is-hidden"),a(".upper-widgets").hide()),dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.config.loyaltyIsOk&&a(b).off("click",".js-loyaltyWidgetRefresh .btn").on("click",".js-loyaltyWidgetRefresh",function(a){a.preventDefault(),dpz.loyalty.refreshLoyaltyStatus()})}}})}),define("siteViews/loyalty_widget_balance",["simplr"],function(b){b.view.mAddViews({loyalty_widget_balance:{html:function(a){var b=dpz.loyalty.getCustomerPoints(),c=dpz.loyalty.getPointsRange(),d=b.PendingPoints>0;a&&a.modifierClass&&a.modifierClass;return dpz.template.assembleLayout({component:"loyaltyWidgetBalance",tokens:{pointsBase:c.BasePoints,pointsTotal:b.BalancePoints,pointsBalance:b.RemainderPoints,pointsPending:b.PendingPoints,pointsMessage:d,loyaltyIsOk:dpz.loyalty.loyaltyIsOk(),modifierClass:a&&a.modifierClass?a.modifierClass:"",customClass:a&&a.customClass?a.customClass:"",useFullTitle:!(!a||!a.useFullTitle)&&a.useFullTitle()}})},callback:function(b,c){if(dpz.loyalty.loyaltyIsOk()){var d=dpz.loyalty.getCustomerPoints(),e=d.HasEarnedNewPizza,f=c.animate,g=d.BalancePoints,h=d.RemainderPoints>0?d.RemainderPoints:e?dpz.loyalty.getPointsRange().BasePoints:0,i=dpz.loyalty.getPointsRange().BasePoints,j=dpz.loyalty.getBasePoints(),k=c.showFullPoints?c.showFullPoints:function(){return!1};try{var l=function(){t.beginPath(),t.arc(v,w,x-8,0,2*Math.PI,!1),t.fillStyle="#0f5475",t.fill(),t.strokeStyle="#03364e",t.lineWidth=4,t.stroke()},m=function(){if(i>0){var a=y;do{t.beginPath(),t.moveTo(v-x*Math.cos(n(a)),w-x*Math.sin(n(a))),t.lineTo(v+x*Math.cos(n(a)),w+x*Math.sin(n(a))),t.lineWidth=2,t.strokeStyle="#03364e",t.stroke(),a+=i}while(a<360)}},n=function(a){return a*(Math.PI/180)},o=function b(c,d){var c=null!==c?c:z/100,e=360*c,f=v+(x-13)*Math.cos(n(e-y)),h=w+(x-13)*Math.sin(n(e-y)),i=u.createLinearGradient(v,w-(x-12),v,w+(x-12));i.addColorStop("1.0","#0c7dea"),i.addColorStop("0","#cdfaff"),u.clearRect(0,0,200,200),u.beginPath(),u.arc(v,w,x-12,-C,B*c-C,!1),u.fillStyle="#3dceff",u.lineTo(v,w),u.fill(),c<1?g>0&&(u.moveTo(v,w-(x-12)),u.lineTo(v,w,x-12,-C,B*(z/100)-C,!1),u.lineWidth=5,u.strokeStyle=i,u.stroke(),u.beginPath(),u.moveTo(v,w),u.lineTo(v,w-(x-10)),u.strokeStyle="#2399f0",u.lineWidth=5,u.stroke(),u.beginPath(),u.moveTo(v,w),u.lineTo(f,h),u.strokeStyle=e<=180?"#0c7dea":"#95eeff",u.lineWidth=5,u.stroke()):p(i),d&&"undefined"!=typeof requestAnimationFrame&&(A=Math.round(a(".js-pointsBalance:visible").text()/60*100),A<z?requestAnimationFrame(function(){b(A/100,!0)}):A>=z&&requestAnimationFrame(function(){b(z/100,!1)}))},p=function(a){u.beginPath(),u.arc(v,w,x-12,0,2*Math.PI,!1),u.fillStyle="#3dceff",u.fill(),u.lineWidth=5,u.strokeStyle=a,u.stroke()},q=function(b){var c=a.Deferred(),d=b.action?b.action:"increment",e=b.startNum?b.startNum:0,f=void 0!==b.endNum?b.endNum:dpz.loyalty.getBasePoints();if(f!=e)var g=setInterval(function(){e<f&&"increment"===d?(e+=5,a(".js-pointsBalance").html(e)):e>f&&"decrement"===d?(e-=5,a(".js-pointsBalance").html(e)):(clearTimeout(g),a(".js-pointsBalance").html(f),c.resolve())},50);else a(".js-pointsBalance").html(f),c.resolve();return c},r=c.checkout?a("#myLoyaltyInCheckout .js-canvas--base")[0]:a(".js-canvas--base")[0],s=c.checkout?a("#myLoyaltyInCheckout .js-canvas--animation")[0]:a(".js-canvas--animation")[0],t=r.getContext("2d"),u=s.getContext("2d"),v=r.width/2,w=r.height/2,x=65,y=90,z=i>0?Math.round(h/i*100):0,A=0,B=2*Math.PI,C=Math.PI/2;m(),l(),a(".loyalty__widget--balance").attr("data-points",10*Math.round(h/10)),f?(site.func.isHandheld()&&a(".loyalty--widget-container--balance, .loyalty--widget-container--redemption").addClass("loyalty__widget--handheld"),q({action:"increment",startNum:0,endNum:e?dpz.loyalty.getBasePoints():h}).then(function(){e&&a(s).animate({width:"+=5",height:"+=5"},250,function(){q({action:"decrement",startNum:h,endNum:0}).then(function(){dpz.loyalty.continueAnimation(c.hideAfterAnimation())}),a(s).animate({width:0,height:0},{duration:550,queue:!1})})}),(!e||e&&k())&&o(null,!0)):(a(".js-pointsBalance").html(e&&k()?dpz.loyalty.getPointsRange().BasePoints:e?0:h),site.func.isHandheld()&&a(".loyalty--widget-container--balance, .loyalty--widget-container--redemption").addClass("loyalty__widget--handheld"),(k()||h<j&&h>0)&&o(null,!1))}catch(c){var D=j===h?0:h;a(b+" .js-pointsBalance").text(D),a(b).find(".loyalty__widget--balance").attr("data-points",D)}}}}})}),define("siteViews/loyalty_widget_pizza_counter",["simplr"],function(a){a.view.mAddViews({loyalty_widget_pizza_counter:{html:function(a){var b=a&&a.customerPoints?a.customerPoints:dpz.loyalty.getCustomerPoints(),c=Math.max(0,dpz.loyalty.getPizzaCount(b)),d=Math.max(0,c-1),e=0!==d&&a.willBeAnimated||!1;return dpz.template.assembleLayout({component:"loyaltyWidgetPizzaCounter",tokens:{loyaltyIsOk:dpz.loyalty.loyaltyIsOk(),pizzasEarned:c,previousPizzasEarned:d,modifierClass:a&&a.modifierClass?a.modifierClass:"",customClass:a&&a.customClass?a.customClass:"",singlePizzaEarned:1===c?"redemption-pizzas__title--one-pizza":"",willBeAnimated:e,pizzasEarmedClass:e?"pizzas-earned__text--new":""}})},callback:function(a,b){}}})}),define("siteViews/loyalty_widget_points",["simplr"],function(b){b.view.mAddViews({loyalty_widget_points:{html:function(b){var c=a.extend(!0,{showNextRewardPoints:!1,showPendingPoints:!0,showTotalPoints:!0},b),d=b&&b.customerPoints?b.customerPoints:dpz.loyalty.getCustomerPoints(),e=dpz.loyalty.getPointsRange();return dpz.template.assembleLayout({component:"loyaltyWidgetPoints",tokens:{loyaltyIsOk:dpz.loyalty.loyaltyIsOk(),pointsBase:e.BasePoints,pointsTotal:d.BalancePoints,pointsPending:d.PendingPoints,pointsRemainder:d.RemainderPoints,showNextRewardPoints:c.showNextRewardPoints,showPendingPoints:c.showPendingPoints&&d.PendingPoints>0,showTotalPoints:c.showTotalPoints}})},callback:function(){}}})}),define("siteViews/loyalty_widget_redemption",["simplr"],function(b){b.view.mAddViews({loyalty_widget_redemption:{html:function(a){var b=dpz.loyalty.getBaseCoupon(),c=b&&""!==b.CouponCode?b.LimitPerOrder:"1";a&&a.customerPoints?a.customerPoints:dpz.loyalty.getCustomerPoints(),a.willBeAnimated;return dpz.template.assembleLayout({component:"loyaltyWidgetRedemption",tokens:{loyaltyIsOk:dpz.loyalty.loyaltyIsOk(),loyaltyCouponCode:b.CouponCode,itemsPerOrder:c,modifierClass:a&&a.modifierClass?a.modifierClass:"",customClass:a&&a.customClass?a.customClass:"",ctaClass:a.willBeAnimated?"inactive":""}})},callback:function(c,d){a(".js-loyaltyRedeem").on("click",function(a){site.trigger.onEvent({title:"Loyalty Widget",group:"Redemption Button",subGroup:"Loyalty Redemption button",uri:""!=window.location.hash?window.location.hash:window.location.href})});dpz.loyalty.getCustomerPoints();dpz.loyalty.canRedeem()?(a(c).find(".redemption__cta .btn").hide(),a(c).find(".message--warning").hide(),a(c).find(".redemption__cta .btn").show(),a(c).off("click",".js-rewardsRedemption .btn"),a(c).on("click",".js-rewardsRedemption .btn",function(c){var e=dpz.loyalty.getBaseCoupon(),f=d.keepCoupons?a(this).data("redemption-product-url"):a(this).data("redemption-url");if(null!==e){var g=e.LimitPerOrder?parseInt(e.LimitPerOrder):0;jsDPZ.app.order.getOrder().filterCoupons({filterFailure:!0,successFilter:function(a,b){return b.isLoyaltyCoupon()}}).done(function(a){a.length>=g?site.func.overlayToggle(!0,"codeOverlay",{},{code:"eCouponDuplicate",label:g}):site.func.customerSemiLoggedIn()?site.func.showLoginPopup({successCommand:dpz.loyalty.config.commands.redeem,keepCoupons:d.keepCoupons,productUrl:f}):site.func.customerLoggedIn()&&(d.keepCoupons?b.controller.mRouteAndExecute(f):window.location=f)})}})):"SUSPENDED"===jsDPZ.app.customer.getCustomer().data.Loyalty.AccountStatus?a(c).find(".redemption__cta .btn").removeClass("is-hidden").addClass("inactive"):dpz.loyalty.store.isParticipating()&&dpz.loyalty.getPizzaCount()>0?(a(".message--participation").hide(),a(".js-rewardsRedemption .btn").on("click",function(a){a.preventDefault()}),d.hideRedemption()?a(c).find(".redemption__cta .btn").hide():a(c).find(".redemption__cta .btn").removeClass("is-hidden").addClass("inactive"),a(c).find(".message--warning").show()):d.hideRedemption()?a(c).find(".redemption__cta .btn").hide():a(c).find(".redemption__cta .btn").removeClass("is-hidden").addClass("inactive"),""===jsDPZ.app.store.getStore().data.StoreID||dpz.loyalty.store.isParticipating()||(a(c).find(".message--warning").hide(),dpz.loyalty.store.isParticipating()?a(c).find(".redemption__cta .btn").addClass("inactive"):a(c).find(".redemption__cta .btn").hide(),0===dpz.loyalty.getPizzaCount()&&a(c).find(".redemption__pizzas").hide(),a(".redemption__cta .message--participation").show())}}})}),define("siteViews/mainFooter",["simplr"],function(b){var c;b.view.mAddViews({mainFooter:{html:function(){return a.Deferred(function(b){var d=function(){var a=dpz.config.getMarketProperty("socialLinks"),d="",e="",f=window.location.pathname;~f.indexOf("menu.jsp")?d="have_you_ever_checked_out":~f.indexOf("coupon.jsp")?d="are_you_looking_for_coupons":~f.indexOf("#/locations/search/")?d="are_you_constantly_thinking":~f.indexOf("/en/pages/order/")?d="did_you_know":"/en/"===f&&""===window.location.hash&&(d="are_you_looking_for_dominos"),e=dpz.template.assembleLayout({component:"footer",tokens:{footerLinks:c,footerLegal:{component:"footerLegal",tokens:{}},socialLinks:{component:"socialLinks",tokens:a},promoLinks:{component:"promoLinks",tokens:{}},footerSEO:{component:"footerSEO",tokens:{seoFooter:d}}}}),b.resolve(e)},e=function(b){c||(c=a.merge(dpz.market.marketConfig.footer.footerLinks,b.footerLinks)),d()};killConfig.isMarketEnabled("wamActive")?require(["dpz.wam"],e,function(){e({footerLinks:[]})}):(c=dpz.config.getMarketProperty("footer").footerLinks,d())})},callback:function(b){a(".js-contentWrap").addClass("content-wrap"),site.func.setupTemplatePopups(b)}}})}),define("siteViews/mainLogo",["simplr"],function(a){a.view.mAddViews({mainLogo:{html:function(a){return dpz.template.assembleLayout({component:"logo",tokens:{logo_link:urlConfig.root+"/",logo_image:site.isHomepage&&!a.isContentPage&&~~window.location.hash.indexOf("#/content/")?"img-logo-home.png":"img-logo-sub.png"}})},callback:function(a,b){}}})}),define("siteViews/mainNavigation",["simplr"],function(b){b.view.mAddViews({mainNavigation:{html:function(b){var c=a.Deferred(),d=b.main||"",e=b.isContentPage;return require(["dpz.config"],function(a){var b=!!e&&(a.getMarketProperty("contentPages")||{}),f=e&&b&&b.pages?b.pages[d].mainNavigation:a.getNavigation(d)||{},g="";f.length&&(g=dpz.template.assembleLayout({component:"siteMainNavigation",tokens:{mainNavigation:f,hasGiftCards:killConfig.isMarketEnabled("giftCardsEnabled")?"site-nav--include-gift-cards":""}})),c.resolve(g)}),c},callback:function(c,d){var d,e=/(.*\/pages\/content.*)|(\/pages\/customer)/,f=null!==window.location.href.match(e);b.view.mRender({name:"mainLogo",data:{isContentPage:d.isContentPage},selector:".js-mainLogo"}),b.view.mRender({name:"mobileLogo",selector:".js-mobileLogo"}),function(){a("header[role='banner'] .site-nav__main a").add("header[role='banner'] .logo").on("click",function(b){var c=""!==a(b.target).text()?a(b.target).text():a(b.target).attr("alt"),d="/header/"+c.toLowerCase().replace(/ /g,"_").replace(/\./g,"");site.trigger.onEvent({title:"Header "+c,uri:d,group:"Header Buttons",subGroup:c})}),a(".js-navProfile").on("click",function(b){b.preventDefault(),site.func.customerSemiLoggedIn()?site.func.showLoginPopup({semiLoggedIn:!0}):0===this.className.indexOf("js-login")?(d={trigger:{title:"Account - Locator Sign In",uri:"/locations/account/signin"}},site.func.showLoginPopup(d)):window.location.href=a(this).attr("href")}),site.isHomepage&&!d.isContentPage&&~~window.location.hash.indexOf("#/content/")?a("body").addClass("body--homepage"):a("body").removeClass("body--homepage")}(),f&&site.func.notifyCartUpdate(),a(".js-couponPageNavigation").on("click",function(b){b.preventDefault(),require(["dpz.config","dpz.customer","dpz.home"],function(b,c,d){var e,f,g,h=killConfig.isMarketEnabled("wamActive");e=h?b.getMarketProperty("home").tileBlocks.profiled?d.getBlockConfigs(b.getMarketProperty("home").tileBlocks.profiled):void 0:b.getMarketProperty("home").tileBlocks.anonymous,h&&e&&(f=b.getMarketProperty("home").tiles,a.each(e,function(a){"coupon"!==f[e[a].tile].linkType&&delete e[a]})),e&&Object.keys(e).length?(g=jsDPZ.app.store.getStore().data.StoreID?a(".js-couponPageNavigation").attr("href"):urlConfig.root+"/pages/order/coupon.jsp",window.location=g):window.location.href=urlConfig.localRoot+"/pages/order/#/section/Coupons/category/All/"})}),"home"!==d.main&&a(".js-siteNavSub").addClass("site-nav__sub")}}})}),define("siteViews/main_sub_navigation",["simplr"],function(b){b.view.mAddViews({main_sub_navigation:{html:function(b){var c=a.Deferred(),d=b.main||"",e=b.isContentPage;return require(["dpz.config"],function(a){var b=!!e&&(a.getMarketProperty("contentPages")||{}),f=e&&b&&b.pages?b.pages[d].subNavigation:a.getSubNavigation(d)||{},g="";f.length&&(g=dpz.template.assembleLayout({component:"subNavigation",tokens:{subNavigation:f}})),c.resolve(g)}),c},callback:function(c,d){var e,f;site.func.isGroupOrderingAvailable()?a(".navigation-groupOrdering").parent().show():a(".navigation-groupOrdering").parent().hide(),site.data.navigation&&site.data.navigation.states&&(e=d.main===site.data.navigation.states.main.COUPONS?"Coupons":"Food",a("li",c).filter("[id*='csn-']").each(function(){var b,c,f=a(this).attr("id").split("-")[1];(killConfig.isMarketEnabled("entreesNavV2")&&!~["AllSides","AllDrinks","AllDesserts","AllPizzas"].indexOf(f)||!killConfig.isMarketEnabled("entreesNavV2"))&&(b=site.catalogTools.categoryExists({section:e,category:f}),c=b?jsDPZ.app.catalog.getCatalog().getCategoryData(e,f):{},"groupOrdering"!==d.main&&(!b||b&&0===c.Products.length&&0===c.Categories.length)&&(a(this).next(".divider").remove(),a(this).remove()))})),a(".js-siteMainNavigation").find("a.navigation-coupons").attr("href",a(".js-couponCategories a",c).first().attr("href")),f=!jsDPZ.util.empty(jsDPZ.app.store.getStore().data.StoreID),!~window.location.hash.indexOf("#/locations/")&&!~window.location.hash.indexOf("#/hotspots")||f?(a(".js-siteMainNavigation").find("a").not(".navigation-home").not(".navigation-change-market").removeClass("is-hidden"),a(".js-siteMainNavigation a").removeClass("active").filter(".navigation-"+d.main).addClass("active")):(a(".js-siteMainNavigation").find("a").not(".navigation-home").not(".navigation-change-market").addClass("is-hidden"),a(".js-siteMainNavigation a").removeClass("active").filter(".navigation-home").addClass("active")),a("a.navigation-"+d.sub,c).addClass("active"),a(".js-buildYourOwnPizza",c).click(function(c){c.preventDefault(),b.controller.mRouteAndExecute(site.func.buildURL({url:a(this).attr("href")}))}),a("#js-subNavigationPage").off("click.WebTrends","a"),a("#js-subNavigationPage").on("click.WebTrends","a",function(){var b=a(".site-nav__main a.active").text();site.trigger.onEvent({title:b+" Sub Nav "+a(this).text(),group:b,subGroup:"Sub Navigation"})}),a(".js-newTarget").attr("target","_blank")}}})}),define("siteViews/miniNav_view",["simplr"],function(b){b.view.mAddViews({miniNav_view:{html:function(){return a.Deferred(function(a){var b={component:"miniNav",tokens:{}};a.resolve(dpz.template.assembleLayout(b))})},callback:function(b,c){a(".js-login").on("click",function(a){a.preventDefault(),site.func.doLoginRedirectAndShowPopup(a,{})});var d=c.isContentPage||~window.location.hash.indexOf("#/content/");(site.func.customerLoggedIn()||site.func.customerSemiLoggedIn())&&(site.isHomepage&&!d?a(".js-headerContainer").addClass("homepage"):a(".js-headerContainer").removeClass("homepage")),site.isHomepage&&!d?a(".js-contentWrap").addClass("content-wrap--homepage"):a(".js-contentWrap").removeClass("content-wrap--homepage")}}})}),define("siteViews/missingProductsOverlay",["simplr"],function(b){b.view.mAddViews({missingProductsOverlay:{html:function(a){return dpz.template.assembleLayout({component:"missingProductsOverlay",tokens:{missingProductsText:{component:"missingProductsText",tokens:{}},allMissing:a.allMissing,recentItemMissing:a.recentItemMissing,hideAddItems:a.hideAddItems}})},callback:function(b,c){var d=function(){a.isFunction(c.onConfirm)&&c.onConfirm(),site.func.overlayToggle(!1,"missingProductsOverlay",{},{})};a(".js-missing-product--confirm").on("click",function(a){a.preventDefault(),site.trigger.onEvent({uri:"/home/eoreorder/discountinuedproduct/accept",title:"Discontinued Product Accept",group:"Reorder",subGroup:"Discontinued Product Accept"}),d()}),a(".js-missing-product--close").on("click",function(a){a.preventDefault(),site.trigger.onEvent({uri:"/home/eoreorder/discountinuedproduct/XtoClose",title:"Discontinued Product X to Close",group:"Reorder",subGroup:"Discontinued Product X to Close"}),d()}),c.recentItemMissing&&dpz.utag.fire.link(void 0,{event_name:"Unavailable products message shown",event_action:"error",event_category:"error"}),site.trigger.onEvent(a.extend({uri:"/error/discontinuedproduct/reorder",title:"Error or Alert Discontinued Product",group:"Error",subGroup:"Discontinued Product Reorder"},c.triggers.load))}}})}),define("siteViews/serviceMethodSwappedOverlay",["simplr"],function(b){b.view.mAddViews({serviceMethodSwappedOverlay:{html:function(){return dpz.template.assembleLayout({component:"serviceMethodSwappedOverlay",tokens:{}})},callback:function(b,c){a(".js-closeServiceMethodSwappedOverlay").on("click",function(a){a.preventDefault(),site.trigger.onEvent({uri:"/home/reorder/servicemethodswapped/XtoClose",title:"Service Method Swapped X to Close",group:"Reorder",subGroup:"Service Method Swapped X to Close"}),site.func.overlayToggle(!1)}),a(".js-continueServiceMethodSwappedOverlay").on("click",function(b){b.preventDefault(),site.trigger.onEvent({uri:"/home/reorder/servicemethodswapped/accept",title:"Service Method Swapped Accept",group:"Reorder",subGroup:"Service Method Swapped Accept"}),c.onConfirm&&a.isFunction(c.onConfirm)&&(c.onConfirm(),site.func.overlayToggle(!1))}),site.trigger.onEvent({uri:"/error/servicemethodswapped/order",title:"Error or Alert Service Method Swapped",group:"Error",subGroup:"Service Method Swapped Reorder"})}}})}),define("siteViews/productSwappedOverlay",["simplr"],function(b){b.view.mAddViews({productSwappedOverlay:{html:function(a){return dpz.template.assembleLayout({component:"productSwappedOverlay",tokens:{}})},callback:function(b,c){a(".js-productSwappedConfirm").on("click",function(a){a.preventDefault(),c.onConfirm(),site.func.overlayToggle(!1)})}}})}),define("siteViews/mobileLogo",["simplr"],function(a){a.view.mAddViews({mobileLogo:{html:function(){var a="img-logo-sub.png";return(site.isHomepage&&-1===window.location.hash.indexOf("/content/")||site.isHomepage&&(site.func.customerSemiLoggedIn()||site.func.customerLoggedIn()))&&(a="img-logo-home.png"),dpz.template.assembleLayout({component:"mobileLogo",tokens:{logo_link:urlConfig.root+"/",logo_image:a}})},callback:function(a,b){}}})}),define("siteViews/nameEasyOrder",["simplr"],function(b){b.view.mAddViews({nameEasyOrder:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"nameEasyOrder",tokens:{}}}})},callback:function(c,d){var e=jsDPZ.app.customer.getCustomer();Modernizr.input.placeholder?a("#Easy_Order_Nickname").focus():(a("#Easy_Order_Nickname").addClass("msie").val(a("#Easy_Order_Nickname").attr("placeholder")),a("#Easy_Order_Nickname").focus(function(){a(this).val()==a(this).attr("placeholder")&&a(this).val("")}).blur(function(){""==a(this).val()&&a(this).val(a(this).attr("placeholder"))})),"handheld"!==site.func.getCurrentBreakpoint()&&a(".card--overlay").css("width","400px"),a(".js-continue",c).on("click",function(f){f.preventDefault(),site.func.toggleLoading(!0),e.setEasyOrder({data:{orderID:d.orderID,easyOrderNickName:a("#Easy_Order_Nickname",c).val()==a("#Easy_Order_Nickname",c).attr("placeholder")?"":a("#Easy_Order_Nickname",c).val()},success:function(){dpz.util.cookies.removeItem("missingProducts"),site.trigger.onEvent({uri:"/account/saveeasyorder",title:"Account - Save Easy order",group:"Account",subGroup:"Save Easy Order"});var c=a("html").attr("lang")||"en";e.fetchOrderHistory({loggedIn:site.func.customerLoggedIn(),lang:c,loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),success:function(c){var d=c.customerOrders[0];a.each(c.customerOrders,function(a,b){if(b.easyOrder)return d=b,!1});var e=killConfig.isMarketEnabled("recentOrderItems")&&site.func.isHandheld();b.view.mRender({name:"order_history_view",data:{customerOrders:c,showRecentOrderItems:e},selector:"#orderHistory"})}})},complete:function(){site.func.toggleLoading(!1)}})}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:c})}}})}),define("siteViews/noCouponOverlay",["simplr"],function(b){b.view.mAddViews({noCouponOverlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"noCouponOverlay",tokens:{}}}})},callback:function(b,c){site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:b,callback:function(b){a(b).is(".js-continue")&&(window.location=a(b).attr("href"))}})}}})}),define("siteViews/page_not_found",["simplr"],function(b){b.view.mAddViews({page_not_found:{html:function(b){var c=a.Deferred();return require(["dpz.template"],function(a){var b=dpz.template.assembleLayout({component:"error404",tokens:{}});c.resolve(b)}),c}}})}),define("siteViews/pizzaCalculatorHelp",["simplr"],function(a){a.view.mAddViews({pizzaCalculatorHelp:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"pizzaCalculatorHelp",tokens:{}}}})},callback:function(a,b){site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:a})}}})}),define("siteViews/pizzaProfileCreateOverlay",["simplr"],function(b){b.view.mAddViews({pizzaProfileCreateOverlay:{html:function(){var b=a.Deferred();return require(["handlebars.runtime"],function(a){var c,d=jsDPZ.app.order.getOrder().data.Customer;a.registerPartial({contentPageTerms:dpz.template.getJST("contentPageTerms")}),c=dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"customerCreateProfile",tokens:{showLoyalty:dpz.loyalty.loyaltyIsActive()&&dpz.loyalty.canEnroll(),profileFields:{component:"customerProfileOverlayFields",tokens:{showLoyalty:dpz.loyalty.canEnroll(),loyaltyTermsBody:{component:"loyaltyTermsBody",tokens:{}},firstName:d.FirstName,lastName:d.LastName,email:d.Email,phone:d.Phone,extension:d.Extension,customClass:"grid__cell--4/5@desktop grid__cell--1"}},showEasyOrderCopy:"true"===jsDPZ.util.sessionStorage("save_eo_home")&&killConfig.isMarketEnabled("saveEasyOrderSetupModal")}},customClass:"card--overlay--create-profile"}}),b.resolve(c)}),b},callback:function(c,d){var e={},f={el:a("form",c),init:function(){var b,d,e;if(killConfig.isMarketEnabled("masksEnabled")){var g=dpz.config.getMarketProperty("mask");a(".js-phone",c).mask(g.phone.mask,g.phone.properties).val(g.phone.properties.defaultVal||null),killConfig.isMarketEnabled("phoneExtension")&&a(".js-extension",c).mask(g.extension.mask,g.extension.properties)}a(".js-emailOptIn",c).on("click",function(){a(this).is(":checked")?site.trigger.onEvent({group:"Account",subGroup:"Email Yes",title:"Account - Email Yes",uri:"/account/emailyes"}):site.trigger.onEvent({group:"Account",subGroup:"Email No",title:"Account - Email No",uri:"/account/emailno"})}).prop("checked",!killConfig.isMarketEnabled("optInNote")),b=this.el,d=this.validation,site.func.setupContentPopups(c),killConfig.isMarketEnabled("taxidEnabled")&&killConfig.isMarketEnabled("taxIDProfile")&&(e=a.Deferred(function(e){site.func.toggleLoading(!0),require(["marketmodules/taxIDprocessor"],function(g){f.validation.rules=g.addRules(f.validation.rules,"profile",c),g.bindEvents(c,f),a(".js-rncFormControl",c).on("change",function(){b.focusClass().validate(d),b.renderFields()}),e.resolve()})})),a.when(e).then(function(){site.func.toggleLoading(!1),b.focusClass().validate(d),b.renderFields()})},validation:{rules:{Profile_Email:{required:!0,email:!0},Profile_Confirm_Email:{required:!0,equalToCI:function(){return a(".js-email",c).val()}},Profile_Gender:{showOptional:!0},Profile_Create_Password:{required:!0,minlength:8},Profile_Confirm_Password:{required:!0,equalTo:"#Profile_Create_Password"},Profile_Callback_Phone:{phone:!0,required:!0},Profile_Remember_Me:{showOptional:!0},Profile_Save_Credit_Card_Name:{showOptional:!0},Profile_Save_Easy_Order_Name:{showOptional:!0},Profile_Enroll_Loyalty:{showOptional:!0},Opt_In_Out:{showOptional:!0,required:killConfig.isMarketEnabled("optInNote")}},messages:{Opt_In_Out:{required:dpz.template.translate(killConfig.isMarketEnabled("optInNote")?"errorsValidator.emailOptIn":"errorsValidator.required")}},submitHandler:function(c){var f,g,h=b.form.mGetValues(c),i="SAVE_NOW"===h.EasyOrderSaveType,j="SAVE_WHEN_PLACING_ORDER"===h.EasyOrderSaveType,k=h.PaymentType;switch(a.extend(h,d.data),h.RNC_Receipt_Type){case"C.C.":g=h.Cedula;break;case"RUC":g=h.RUC;break;case"Passport":g=h.Pasaporte;break;default:g=""}b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/profile/create",parameters:(f={FirstName:h.FirstName,LastName:h.LastName,Gender:h.Profile_Gender,Email:h.Profile_Email,Phone:h.Phone.replace(/[^0-9]/g,""),Extension:killConfig.isMarketEnabled("phoneExtension")?h.Extension.replace(/[^0-9]/g,""):"",Password:h.Profile_Create_Password,EmailOptIn:h.EmailOptIn,AgreeToTermsOfUse:h.AgreeToTermsOfUse,Age13OrOlder:h.AgreeToTermsOfUse,SaveEasyOrder:a("#Profile_Save_Easy_Order").is(":checked")||i||j,EasyOrderName:a("#Profile_Save_Easy_Order").is(":checked")?a("#Profile_Save_Easy_Order_Name").val():i||j?"My Domino's Favorite":"",SaveCreditCard:a("#Profile_Save_Credit_Card").is(":checked"),nickName:a("#Profile_Save_Credit_Card_Name").val(),RememberMe:a("#Profile_Remember_Me").is(":checked"),billingZip:e.billingZip,cardType:e.cardType,expirationMonth:e.expirationMonth,expirationYear:e.expirationYear,number:e.number,securityCode:e.securityCode,isDefault:!0,paymentsPage:!0,LoyaltyEnrollment:a(".js-loyalty_profile_enroll").is(":checked")},_defineProperty(f,"EmailOptIn",h.Opt_In_Out),_defineProperty(f,"EasyOrderSaveNow",i),_defineProperty(f,"EasyOrderSaveWhenPlacingOrder",j),_defineProperty(f,"PaymentType",k),_defineProperty(f,"TaxType",h.RNC_Receipt_Type),_defineProperty(f,"TaxID",g),f)}))}}};d.data.saveCreditCard?(e.billingZip=a("#Billing_Postal_Code").val(),e.cardType=a("#Credit_Card_Type").val(),e.expirationMonth=a("#Expiration_Month").val(),e.expirationYear=a("#Expiration_Year").val(),e.number=a("#Credit_Card_Number").val(),e.securityCode=a("#Credit_Card_Security_Code").val(),a(".js-profileSaveCreditCard").show()):a(".js-profileSaveCreditCard").hide(),a("#Email_Opt_In").is(":checked")?a("#Profile_Email_Opt_In").prop("checked",!0):a("#Profile_Email_Opt_In").prop("checked",!1),a("#Agree_To_Terms_Of_Use").is(":checked")?a("#Profile_Agree_To_Terms_Of_Use").prop("checked",!0):a("#Profile_Agree_To_Terms_Of_Use").prop("checked",!1),a(".js-confirmEmail, .js-confirmPassword").on("paste",function(a){a.preventDefault()}),f.init(),a(".js-easyOrderLegal").on("click",function(b){b.preventDefault(),a(".js-easyOrderLegalText").toggle()}),a(".js-emailEnroll").on("click",function(b){b.preventDefault(),a(".js-emailEnrollText").toggle()}),a(".js-loyalty-details-toggler").on("click",function(b){b.preventDefault(),a(".js-loyalty-details").toggle()}),a(".js-loyalty-terms-toggler").on("click",function(b){b.preventDefault(),a(".js-loyalty-terms-container").toggle()}),a(".js-rememberMeLegal").on("click",function(b){b.preventDefault(),a(".js-rememberMeLegalText").toggle()}),a(".js-termsOfUseOverlay").on("click",function(b){b.preventDefault(),a("#terms-of-use-container").toggle()}),a(".js-showSignIn").on("click",function(){site.func.overlayToggle(!0,"pizzaProfileLoginOverlay",{},{easyOrderSaveNow:"SAVE_NOW"===d.data.EasyOrderSaveType,easyOrderSaveWhenPlacingOrder:"SAVE_WHEN_PLACING_ORDER"===d.data.EasyOrderSaveType,easyOrderPaymentType:d.data.PaymentType,billingZip:a("#Billing_Postal_Code").val(),cardType:a("#Credit_Card_Type").val(),expirationMonth:a("#Expiration_Month").val(),expirationYear:a("#Expiration_Year").val(),number:a("#Credit_Card_Number").val(),securityCode:a("#Credit_Card_Security_Code").val()})}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:c,callback:function(){site.isPaymentPage&&a("#Pizza_Profile_Selection").prop("checked",!1)}})}}})}),define("siteViews/pizzaProfileCreateOverlayConfirmation",["simplr"],function(b){b.view.mAddViews({pizzaProfileCreateOverlayConfirmation:{html:function(b){var c=a.Deferred();return require(["handlebars.runtime"],function(a){var d=b.data;a.registerPartial({contentPageTerms:dpz.template.getJST("contentPageTerms")});var e=dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"customerCreateProfileConfirmation",tokens:{profileFields:{component:"customerProfileOverlayFields",tokens:{showLoyalty:dpz.loyalty.canEnroll(),loyaltyTermsBody:{component:"loyaltyTermsBody",tokens:{}},firstName:d.FirstName,lastName:d.LastName,email:d.Email,phone:d.Phone,extension:d.Extension}}}},customClass:"card--overlay--create-profile"}});return c.resolve(e)}),c},callback:function(c,d){a(".js-rememberMeLegal").on("click",function(b){b.preventDefault(),a(".js-rememberMeLegalText").toggle()}),a(".js-confirmEmail, .js-confirmPassword").on("paste",function(a){a.preventDefault()}),{el:a("form",c),init:function(){if(killConfig.isMarketEnabled("masksEnabled")){var b=dpz.config.getMarketProperty("mask");a(".js-phone",c).mask(b.phone.mask,b.phone.properties).val(b.phone.properties.defaultVal||null),killConfig.isMarketEnabled("phoneExtension")&&a(".js-extension",c).mask(b.extension.mask,b.extension.properties)}a(".js-emailOptIn",c).on("click",function(){a(this).is(":checked")?site.trigger.onEvent({group:"Account",subGroup:"Email Yes",title:"Account - Email Yes",uri:"/account/emailyes"}):site.trigger.onEvent({group:"Account",subGroup:"Email No",title:"Account - Email No",uri:"/account/emailno"})}).prop("checked",!0),site.func.setupContentPopups(c),this.el.focusClass().validate(this.validation),this.el.renderFields()},validation:{rules:{Profile_Email:{required:!0,email:!0},Profile_Confirm_Email:{required:!0,equalToCI:function(){return a(".js-email",c).val()}},Profile_Create_Password:{required:!0,minlength:8},Profile_Confirm_Password:{required:!0,equalTo:"#Profile_Create_Password"},Profile_Callback_Phone:{phone:!0,required:!0},Profile_Remember_Me:{showOptional:!0},Profile_Enroll_Loyalty:{showOptional:!0}},submitHandler:function(c){var e=b.form.mGetValues(c);a.extend(e,d.data),b.controller.mRouteAndExecute(site.func.buildURL({url:"#/customer/profile/create",parameters:{FirstName:e.FirstName,LastName:e.LastName,Email:e.Profile_Email,Phone:e.Phone.replace(/[^0-9]/g,""),Extension:killConfig.isMarketEnabled("phoneExtension")?e.Extension.replace(/[^0-9]/g,""):"",Password:e.Profile_Create_Password,AgreeToTermsOfUse:!0,Age13OrOlder:!0,RememberMe:a("#Profile_Remember_Me").is(":checked"),confirmationPage:!0,LoyaltyEnrollment:a(".js-loyalty_profile_enroll").is(":checked"),paymentPage:!!site.isPaymentPage||""}}))}}}.init(),a(".js-termsOfUseOverlay").on("click",function(b){b.preventDefault(),a("#terms-of-use-container").toggle()}),dpz.loyalty.canEnroll()&&(a(".js-loyalty-details-toggler").on("click",function(b){b.preventDefault(),a(".js-loyalty-details").toggle()}),a(".js-loyalty-terms-toggler").on("click",function(b){b.preventDefault(),a(".js-loyalty-terms-container").toggle()})),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:c,callback:function(){site.isPaymentPage&&a("#Pizza_Profile_Selection").prop("checked",!1)}})}}})}),define("siteViews/pizzaProfileLoginOverlay",["simplr","dpz.easyOrder"],function(b,c){b.view.mAddViews({pizzaProfileLoginOverlay:{html:function(a){var b=jsDPZ.app.customer.getCustomer().data,c={component:"genericOverlay",tokens:{overlayContent:{component:a&&a.overlay?a.overlay:"pizzaProfileLoginOverlay",tokens:{rememberMeChecked:site.func.isHandheld(),firstName:b.FirstName,email:b.Email,rememberMeLegalText:{component:"rememberMeLegalText",tokens:{}},claimRewards:a&&a.claimRewards&&"data-claim-rewards"!==a.claimRewards,isInEasyOrderFlow:a&&a.inEasyOrderFlow,loginClass:"remembered"===dpz.customer.getStatus()?"js-loginKeepLoggedIn":"js-loginOnce"}}}};return dpz.template.assembleLayout(c)},callback:function(d,e){if(site.trigger.onPage({group:"Profile Sign In",subGroup:"Sign In Overlay Popup",title:"Sign In To Your Pizza Profile"}),e.routeAfter){e.routeAfter=e.routeAfter;var f=a(d).find(".js-createProfile"),g=f.attr("href");f.attr("href",g+"?routeAfter="+encodeURIComponent(e.routeAfter))}var h=e.claimRewards?"600px":"550px";a(".js-sign-in--pop-up").hide(),"handheld"!==site.func.getCurrentBreakpoint()&&(a(".card--overlay").css("width",h),a("#genericOverlay").css("top","200px")),a(".js-loginKeepLoggedIn").click(function(){a("input#Remember_Me").prop("checked",!0)}),a(".js-loginOnce").click(function(){a("input#Remember_Me").prop("checked",!1)}),jsDPZ.app.customer.getCustomer().data.Session.abLoyaltyCheckbox&&"d"===jsDPZ.app.customer.getCustomer().data.Session.abLoyaltyCheckbox&&a(".js-loyaltyOptIn:checked").length>0&&a(".js-loyaltyOptIn:checked").trigger("click");var i={el:a("form",d),inputs:{Email:a(".js-email",d),Password:a(".js-password",d)},settings:{loginView:!0},init:function(){this.el.focusClass().validate(this.validation),this.el.renderFields(),site.func.customerSemiLoggedIn()?a(".js-anonymous",d).remove():a(".js-semiLoggedIn",d).remove(),e.paymentPage?a(".js-signout",d).remove():a(".js-payment",d).remove(),this.inputs.Email.val()&&this.inputs.Password.is(":visible")?this.inputs.Password.focus():this.inputs.Email.focus()},validation:{rules:{Email:{email:!0,required:function(){return!site.func.customerSemiLoggedIn()||!i.settings.loginView},persist:!0},Password:{required:function(){return i.settings.loginView}},Remember_Me:{showOptional:function(){return i.settings.loginView}}},submitHandler:function(a){var c=b.form.mGetValues(a);b.controller.mRouteAndExecute(site.func.buildURL({url:i.settings.loginView?"#/customer/login/create":"#/customer/reset-password/create",parameters:{email:c.Email,password:c.Password,semiLoggedIn:e.semiLoggedIn,creditCardCheckout:e.creditCardCheckout,setEasyOrder:e.setEasyOrder,setEasyOrderSelector:e.setEasyOrderSelector,enrollIntoLoyaltyAndContinue:e.enrollIntoLoyaltyAndContinue,selector:e.selector,removeEasyOrder:e.removeEasyOrder,paymentPage:e.paymentPage,successCommand:e.successCommand?e.successCommand:"",keepCoupons:!(!e.successCommand||!e.keepCoupons)&&e.keepCoupons,productUrl:e.successCommand&&e.productUrl?e.productUrl:"",routeAfter:e.routeAfter,routeAndExecute:e.routeAndExecute||"",easyOrderSaveNow:e.easyOrderSaveNow,easyOrderSaveWhenPlacingOrder:e.easyOrderSaveWhenPlacingOrder,easyOrderPaymentType:e.easyOrderPaymentType,billingZip:e.billingZip,cardType:e.cardType,expirationMonth:e.expirationMonth,expirationYear:e.expirationYear,number:e.number,securityCode:e.securityCode,claimRewards:e.claimRewards}})),site.func.overlayToggle(!1)}}};i.init(),a(".js-toggleLogin",d).on("click",function(b){b.preventDefault(),a(".js-formActions",d).children().toggle(),i.settings.loginView=!i.settings.loginView,i.el.renderFields(),a(".js-message",d).toggle(i.settings.loginView),i.inputs.Email.val()&&i.inputs.Password.is(":visible")?i.inputs.Password.focus():i.inputs.Email.focus()}),a(".js-loginSubmit",d).on("click",function(){site.trigger.onEvent({group:"Account",subGroup:"Sign In Submit",title:"Account - Sign In Submit",uri:"/account/signinsubmit"})}),a(".js-resetPassword",d).on("click",function(){site.trigger.onEvent({group:"Account",subGroup:"Reset Password",title:"Account - Reset Password",uri:"/account/resetpassword"})}),a(".js-createProfile",d).on("click",function(){site.trigger.onEvent({group:"Account",subGroup:"Create Profile",title:"Account - Create Profile",uri:"/account/createprofile"}),site.func.overlayToggle(!1)}),a(".js-signout",d).on("click",function(){b.controller.mRouteAndExecute("/customer/logout/")}),a(".js-payment",d).on("click",function(){jsDPZ.app.customer.getCustomer().data.Session.OrderModified=null,site.sessionTools.save().then(function(){b.controller.mRouteAndExecute("/customer/guest-checkout/")})}),a(".js-rememberMeLegal").on("click",function(b){b.preventDefault(),a(".js-rememberMeLegalText").toggle()}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton",layerSelector:d,callback:function(){e.loyaltyButton&&a("#Loyalty_Enrollment_No").click(),delete jsDPZ.app.customer.getCustomer().data.Session.authRequired,jsDPZ.app.customer.getCustomer().data.Session.easyOrderDeepLink=!1,site.sessionTools.save(),e.paymentPage&&(a("input[name='Payment_Type'][value='Credit']").is(":checked")&&a(".js-creditCardSelection").val()>=0&&a("input[name='Credit_Card_Selection'][value='-1']").click(),a("#Easy_Order_Selection").is(":checked")&&(a("#Easy_Order_Selection").prop("checked",!1),a(".js-easyOrderLabel, #Easy_Order_Name").hide(),a("#Easy_Order_Name").val("")),a(".js-saveEasyOrderSelection").is(":checked")&&a(".js-saveEasyOrderSelection").prop("checked",!1),e.deselectOption&&a(e.deselectOption).prop("checked",!1)),c.removeFromEasyOrderFlow().then(function(){a(".js-search-cta")&&a(".js-search-cta").removeClass("btn--create-easy-order")})}})}}})}),define("siteViews/holdOutsRemovalWarning",["simplr"],function(b){b.view.mAddViews({holdOutsRemovalWarning:{html:function(){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"holdOutsRemovalWarning",tokens:{}}}})},callback:function(){a(".js-continue, .js-closeButton").on("click",function(a){a.preventDefault(),site.func.overlayToggle(!1)}),dpz.utag.fire.link(void 0,{event_name:"TwistHoldEmailError",event_action:"Error",event_category:"Error",event_label:"ErrorCode"})}}})}),define("siteViews/removeEasyOrder",["simplr"],function(b){b.view.mAddViews({removeEasyOrder:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"removeEasyOrder",tokens:{easyOrderNickname:a.easyOrderNickname}}}})},callback:function(c,d){var e=jsDPZ.app.customer.getCustomer();"handheld"!==site.func.getCurrentBreakpoint()&&a(".card--overlay").css("width","400px"),a(".js-continue",c).on("click",function(c){c.preventDefault(),a(".js-easyOrder").hide(),site.func.toggleLoading(!0),e.removeEasyOrder({data:{orderID:d.orderID},success:function(){delete jsDPZ.app.customer.getCustomer().data.Session.EasyOrder,site.sessionTools.save(),site.trigger.onEvent({uri:"/account/removeeasyorder",title:"Account - Remove Easy order",group:"Account",subGroup:"Remove Easy Order"});var c=a("html").attr("lang")||"en";e.fetchOrderHistory({loggedIn:site.func.customerLoggedIn(),loyaltyIsActive:dpz.loyalty.loyaltyIsOk(),lang:c,success:function(c){var d=c.customerOrders[0];a.each(c.customerOrders,function(a,b){if(b.easyOrder)return d=b,!1});var e=killConfig.isMarketEnabled("recentOrderItems")&&site.func.isHandheld();b.view.mRender({name:"order_history_view",data:{customerOrders:c,showRecentOrderItems:e},selector:"#orderHistory"})}})},complete:function(){site.func.toggleLoading(!1)}})}),site.func.setupLayerCloseEvents({closeSelector:".js-closeButton, .js-continue",layerSelector:c})}}})}),define("siteViews/smsTracker",["simplr"],function(b){b.view.mAddViews({smsTracker:{html:function(a){return dpz.template.assembleLayout({component:"driverTrackingSmsComponent",tokens:{}})},callback:function(b,c){var d=a(".js-smsTrackerForm",b);killConfig.isMarketEnabled("smsOptInRecaptcha")&&dpz.recaptcha.ready.then(function(){return dpz.recaptcha.insert("js-recaptcha","6LeVRg4UAAAAAIZshloMr5zM13LbvDEaxPbMsF5u")}).then(function(){dpz.recaptcha.hideError("js-recaptcha")});var e=dpz.config.getMarketProperty("mask");a(".js-phone",b).val(e.phone.properties.defaultVal||null).mask(e.phone.mask,e.phone.properties),d.validate({rules:{phone:{required:!0,phone:!0}},submitHandler:function(b,d){var e=a.extend(!0,{CustomerID:"",Notifications:{OptIn:!0,SmsPhoneNumber:""},OrderID:"",StoreID:"",StoreOrderID:"",GRecaptchaResponse:killConfig.isMarketEnabled("smsOptInRecaptcha")?b["g-recaptcha-response"].value:""},c,{Notifications:{SmsPhoneNumber:b.phone.value}});d.preventDefault(),!killConfig.isMarketEnabled("smsOptInRecaptcha")||e.GRecaptchaResponse?jsDPZ.ajax.pushSmsOptIn({data:e}).then(function(){a(".js-smsOptInContainer, .js-smsOptInCfm").toggleClass("is-hidden")}).fail(site.func.powerCommunicationError):dpz.recaptcha.showError("js-recaptcha")}}),d.renderFields()}}})}),define("siteViews/saveEasyOrderOverlay",["simplr"],function(b){b.view.mAddViews({saveEasyOrderOverlay:{html:function(a){return dpz.template.assembleLayout({component:"genericOverlay",tokens:{overlayContent:{component:"saveEasyOrderOverlay",tokens:{}},customClass:"save-easy-order-overlay"}})},callback:function(b,c){a(".js-closeButton, .btn",b).click(function(a){a.preventDefault(),site.func.overlayToggle(!1)})}}})}),define("siteViews/upsellProductOverlayTriple",["simplr"],function(b){b.view.mAddViews({upsellProductOverlayTriple:{html:function(b){var c=a.Deferred(),d=[{variantName:"Meatzza Feast &trade;",productCode:"S_MX",variantCode:"12SCMEATZA",productImage:"couponwizard/images/S_MX",variantDescription:dpz.template.translate("home.upsell_triple_s_mx_description"),upsellCoupon:b.upsellCoupon,quid:"triple-specialty-upsell-meatzza",sizeCode:"12",hasUpsell:b.hasUpsell},{variantName:"Extravaganzza Feast &trade;",productCode:"S_ZZ",variantCode:"12SCEXTRAV",productImage:"couponwizard/images/S_ZZ",variantDescription:dpz.template.translate("home.upsell_triple_s_zz_description"),upsellCoupon:b.upsellCoupon,quid:"triple-specialty-upsell-extravaganzza",sizeCode:"12",hasUpsell:b.hasUpsell},{variantName:"Pacific Veggie",productCode:"S_PIZPV",variantCode:"P12ITHPV",productImage:"couponwizard/images/S_PIZPV",variantDescription:dpz.template.translate("home.upsell_triple_s_pizpv_description"),upsellCoupon:b.upsellCoupon,quid:"triple-specialty-upsell-pacific-veggie",sizeCode:"12",hasUpsell:b.hasUpsell}],e={component:"genericOverlay",tokens:{overlayContent:{component:"upsellProductOverlayTripleSpecialty",tokens:{panelNumber:b.panelNumber,panelName:b.panelName,defaultCoupon:b.defaultCoupon,upsellCoupon:b.upsellCoupon,couponPrice:dpz.template.translateMoney(b.couponPrice),productName:b.variantName,productImage:b.productImage,hasUpsellOrDefault:b.hasUpsell||b.hasDefault,upsellProducts:{component:"upsellProductOverlayTripleSpecialtyItem",tokens:d}}}}};return site.trigger.onPage({title:"Triple Upsell Overlay",savePreviousState:!0}),c.resolve(dpz.template.assembleLayout(e)),c},callback:function(c,d){site.trigger.onEvent({group:"Upsell",subGroup:"Triple Specialty Upsell 2 dollar",title:"Upsell - Triple Specialty Pizza Upsell 2 dollar",uri:"/upsell/triplespecialtypizzaupselltwodollar"});var e=a(".js-nothanks",c).attr("href");a(".card--overlay").addClass("card--overlay--large"),site.func.setupLayerCloseEvents({layerSelector:c,closeSelector:".js-closeButton, .js-nothanks, .js-continue",callback:function(c){function f(){d.hasUpsell||d.hasDefault?site.isHomepage&&(window.location.href=urlConfig.root+"/pages/order/#/section/Food/category/AllEntrees/"):h?~window.location.hash.indexOf("AllEntrees/")?b.controller.mRouteAndExecute("/order/coupons/new?code="+d.defaultCoupon+"&qty=1"):(jsDPZ.app.customer.getCustomer().data.Session.addCouponOnEntreesPage=d.defaultCoupon,site.sessionTools.save().then(function(){window.location.href=urlConfig.root+"/pages/order/#/section/Food/category/AllEntrees/"})):window.location.href=e}var g=d.couponPrice.charAt(0),h=jsDPZ.app.order.getOrder().data.Details.StoreID;a(c).is(".js-nothanks")?(site.trigger.onEvent({group:"Upsell",subGroup:"Triple Specialty Pizza Upsell "+g+" dollar reject",title:"Upsell - Triple Specialty Pizza Upsell "+g+" dollar reject",uri:"/upsell/triplespecialtypizzaupsell"+g+"dollarreject"}),d.toutAddCoupon||f()):a(c).is(".js-continue")?(site.trigger.onEvent({group:"Upsell",subGroup:"Triple Specialty Pizza Upsell "+g+" dollar accept",title:"Upsell - Triple Specialty Pizza Upsell "+g+" dollar accept",uri:"/upsell/triplespecialtypizzaupsell"+g+"dollaraccept"}),d.toutAddCoupon||(window.location.href=a(c).attr("href"))):a(c).is(".js-closeButton")&&(site.trigger.onEvent({group:"Upsell",subGroup:"Triple Specialty Pizza Upsell "+g+" dollar X to Close",title:"Upsell - Triple Specialty Pizza Upsell "+g+" dollar X to Close",uri:"/upsell/triplespecialtypizzaupsell"+g+"dollarXtoclose"}),d.toutAddCoupon?b.controller.mRouteAndExecute(site.func.buildURL({url:e})):f())}})}}})}),define("siteViews/visualPizzaBubbleOverlay",["simplr"],function(b){b.view.mAddViews({visualPizzaBubbleOverlay:{html:function(b){var c=a.extend({feeds:"",size:""},b),d=void 0;return/\d/.test(b.feeds)||(d=c.feeds),dpz.template.assembleLayout({component:"visualPizzaOverlay",tokens:{feeds:c.feeds,size:c.size,altFeedsText:d}})},callback:function(b,c){var d=a(b).text().split(" ").length/2*1e3;clearTimeout(site.data.visualPizzaBubbleOverlay),site.data.visualPizzaBubbleOverlay=setTimeout(function(){site.func.visualPizzaBubbleOverlayToggle(!1)},d)}}})}),define("siteViews/x",["simplr"],function(a){a.view.mAddViews({x:""})}),define("siteViews",["siteViews/BogoWeekPopup","siteViews/CosWeekPopup","siteViews/Week50OffPopup","siteViews/addressChangeOverlay","siteViews/address_predictions","siteViews/bubbleCodeOverlay","siteViews/claimRewardsOrderDetailsInfo","siteViews/codeOverlay","siteViews/confirmOverlay","siteViews/contentOverlay","siteViews/content_page","siteViews/cookieBanner","siteViews/couponUpsellOverlay","siteViews/customerPasswordUpdated","siteViews/customerResponsiveLogin","siteViews/deliveryTrackerPromotion","siteViews/domChatButton","siteViews/eRoutingCouponOverlay","siteViews/easyOrderInstructions","siteViews/featuredCoupon","siteViews/glutenFreeDisclaimer","siteViews/groupOrderingInfo","siteViews/header","siteViews/headerProfile","siteViews/hotspotsFYIOverlay","siteViews/hotspotsLocationAccessOverlay","siteViews/hotspotsLocationErrorOverlay","siteViews/hotspotsRingRingOverlay","siteViews/homeStartYourOrder","siteViews/iFrameOverlay","siteViews/ipadSplash","siteViews/lighterOptionsOverlay","siteViews/loyaltyOptOut","siteViews/loyaltyTermsBody","siteViews/loyalty_checkout_activate","siteViews/loyalty_checkout_signin","siteViews/loyalty_details_overlay","siteViews/loyalty_enrollment_details","siteViews/loyalty_rewards_details","siteViews/loyalty_small_widget","siteViews/loyalty_widget_alerts","siteViews/loyalty_widget_balance","siteViews/loyalty_widget_pizza_counter","siteViews/loyalty_widget_points","siteViews/loyalty_widget_redemption","siteViews/mainFooter","siteViews/mainLogo","siteViews/mainNavigation","siteViews/main_sub_navigation","siteViews/miniNav_view","siteViews/missingProductsOverlay","siteViews/serviceMethodSwappedOverlay","siteViews/productSwappedOverlay","siteViews/mobileLogo","siteViews/nameEasyOrder","siteViews/noCouponOverlay","siteViews/page_not_found","siteViews/pizzaCalculatorHelp","siteViews/pizzaProfileCreateOverlay","siteViews/pizzaProfileCreateOverlayConfirmation","siteViews/pizzaProfileLoginOverlay","siteViews/holdOutsRemovalWarning","siteViews/removeEasyOrder","siteViews/smsTracker","siteViews/saveEasyOrderOverlay","siteViews/upsellProductOverlayTriple","siteViews/visualPizzaBubbleOverlay"],function(){});var b=document.title,c=" - ";window.useDynamicTitleTags=!1,require(["simplr","dpz.template"],function(d,e){function f(){setTimeout(function(){var b=setInterval(function(){var c;a("#genericOverlay").length||a(".is-handheld-nav-visible").length||a(".js-kioskInactivityTimeoutOverlay").length||(clearInterval(b),(c=dpz.util.cookies.getItem("routePast"))&&site.trigger.onPage(jsDPZ.dataConversion.JSONStringToObject(c)))},100)},500)}d.trigger.mAddServices({"Title Tags":{data:{environmentIDs:{localhost:!0,"nolo-us-dev1":!0,"nolo-us-dev2":!0,"nolo-us-dev3":!0,"nolo-us-dev4":!0,"nolo-us-qa1":!0,"nolo-us-qa2":!0,"nolo-us-qa3":!0,"nolo-us-qa4":!0,"nolo-us-preprod":!0,"nolo-us-prod":!0,"golo-dev1":!0,"golo-dev2":!0,"golo-dev3":!0,"golo-dev4":!0,"golo-qa1":!0,"golo-qa2":!0,"golo-qa3":!0,"golo-qa4":!0,"golo-preprod":!0,"golo-prod1":!0,"golo-prod2":!0,"golo-va-prod1":!0,"golo-va-prod2":!0,"golo-de-prod1":!0,"golo-de-prod2":!0}},onPage:function(d){var g,h,i="",j="",k=dpz.market.marketConfig.seo.hyphenatedExceptions,l=!1,m=!1,n=d.route.resources,o=function(a,b){var c,d,f;return a?(c=b+"."+a,d=e.translate(c)||c,f=new RegExp("^"+b+"\\."),d.replace(f,"")):""};return site.sessionTools.resetTimeout(),g=o(b,"titles"),d.title&&d.titleIsKey?g=e.transformAndTranslate("titles",d.title,{}):"section"in n&&"category"in n?(g=o(n.section+n.category,"titles")+c+g,dpz.util.cookies.setItem("routePast",jsDPZ.dataConversion.JSONObjectToString(d))):(h=jsDPZ.app.catalog.getCatalog(),a.each(n,function(a,b){var c,d,e;switch(i+=a,a.toLowerCase()){case"product":c=h.getProduct(n.product).data,j=jsDPZ.util.htmlUnEncode(c.Name),c.Name!==c.ProductType&&(j="Wings"===c.ProductType?"Chicken "+j:"GSalad"===c.ProductType?"Salad "+j:"Sides"===c.ProductType?"Extras "+j:c.ProductType+" "+j),j+=" ";break;case"upsell":m=!0,i+=b;break;case"builder":case"fulfiller":l=!0;break;case"order":case"storeid":case"location":break;case"variant":d=jsDPZ.app.order.getOrder().getItemData({ID:n.variant}),e=h.getVariant(d.Code).data.ProductCode,c=h.getProduct(e).data,j=c.Name,j!==c.ProductType&&(j=c.ProductType+" "+j),j+=" ",l=!0;break;default:i+=b}}),i&&(g=k.indexOf(i)>-1?o(i,"titles"):j+o(i,"titles")+c+g),l||m||d.savePreviousState?(l||d.savePreviousState)&&(f(),l=!1,a(".js-kioskInactivityTimeoutOverlay").length||(dpz.kiosk.inactivityTimeoutRoutePast=d)):dpz.util.cookies.setItem("routePast",jsDPZ.dataConversion.JSONObjectToString(d))),g=jsDPZ.util.htmlUnEncode(g),a(document).trigger("documentTitleSet",[g]),killConfig.isMarketEnabled("bypassTitleTag")?g:document.title=g}}})})}(jQuery);