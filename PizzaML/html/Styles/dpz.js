define("dpz.easyOrder",[],function(){return{easyOrderReferrerIsValid:function(a){return"app"===a||"microsite"===a},isInEasyOrderFlow:function(){return killConfig.isMarketEnabled("createEasyOrderEnabled")&&jsDPZ.app.customer.getCustomer().data.Session.CreateEasyOrder},placeInEasyOrderFlow:function(){return jsDPZ.app.customer.getCustomer().data.Session.CreateEasyOrder=!0,site.sessionTools.save()},removeFromEasyOrderFlow:function(){var a=jsDPZ.app.customer.getCustomer().data;return a.Session.CreateEasyOrder=!1,a.Session.EasyOrderReferrer="",site.sessionTools.save()},createEasyOrder:function(a){var b=function(a){return jsDPZ.ajax.setEasyOrderExpress({data:JSON.stringify(a)})};site.func.toggleLoading(!0),site.func.getOrderForPowerData().then(function(a){return jsDPZ.ajax.priceOrder({data:a})}).then(function(b){var c={order:b.Order};c.easyOrder=!0,c.easyOrderNickName=a.Easy_Order_Name||"My Domino's Favorite";var d={Type:"Cash"===a.Payment_Type?"Cash":"CreditCard",Amount:jsDPZ.app.order.getOrder().data.Details.Amounts.Customer};return $.Deferred(function(b){"Credit"===a.Payment_Type?a.Save_Credit_Card?jsDPZ.app.customer.getCustomer().saveCreditCard({data:{billingZip:a.Billing_Postal_Code,cardType:a.Credit_Card_Type,expirationMonth:a.Expiration_Month,expirationYear:a.Expiration_Year,nickName:a.Credit_Card_Nickname,number:a.Credit_Card_Number,securityCode:a.Credit_Card_Security_Code,isDefault:a.Is_Default_CC},success:function(a){$.extend(d,{CardID:a.id,CardType:a.cardType,Expiration:("0"+a.expirationMonth).slice(-2)+String(a.expirationYear).substr(2,2),Number:a.lastFour,PostalCode:a.billingZip}),c.order.Payments.push(d),b.resolve(c)},error:function(a){var b=a.responseText.error,c="powerCustomerGenericError";b.length&&"CardOnFileLimitExceeded"===b[0].code&&(c="powerCustomerMaxCreditCards"),site.func.overlayToggle(!0,"codeOverlay",{},{code:c})}}):(a.Credit_Card_Selection>=0?$.extend(d,{CardID:jsDPZ.app.customer.getCustomer().data.CreditCards[a.Credit_Card_Selection].id}):$.extend(d,{billingZip:a.Billing_Postal_Code,cardType:a.Credit_Card_Type,expirationMonth:a.Expiration_Month,expirationYear:a.Expiration_Year,nickName:a.Credit_Card_Nickname,number:a.Credit_Card_Number,saveAndPlaceOrder:!1,securityCode:a.Credit_Card_Security_Code,gpmPaymentType:$(".js-paymentType:checked").data("gpm-payment-type")}),c.order.Payments.push(d),b.resolve(c)):(c.order.Payments.push(d),b.resolve(c))})}).then(function(a){return b(a)}).then(function(){return jsDPZ.app.customer.getCustomer().data.Session.createdEasyOrderConfirm=!0,site.sessionTools.save()}).then(function(){window.location.href="/en/"}).catch(function(){site.func.overlayToggle(!0,"codeOverlay",{},{code:"powerCustomerGenericError"})}).always(function(){site.func.toggleLoading(!1)})}}});